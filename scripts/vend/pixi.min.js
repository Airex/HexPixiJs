(function(){var f=this,n=n||{},t;n.WEBGL_RENDERER=0,n.CANVAS_RENDERER=1,n.VERSION="v1.6.1",n.blendModes={NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},n.scaleModes={DEFAULT:0,LINEAR:0,NEAREST:1},n._UID=0,"undefined"!=typeof Float32Array?(n.Float32Array=Float32Array,n.Uint16Array=Uint16Array):(n.Float32Array=Array,n.Uint16Array=Array),n.INTERACTION_FREQUENCY=30,n.AUTO_PREVENT_DEFAULT=!0,n.RAD_TO_DEG=180/Math.PI,n.DEG_TO_RAD=Math.PI/180,n.dontSayHello=!1,n.sayHello=function(t){if(!n.dontSayHello){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var i=["%c %c %c Pixi.js "+n.VERSION+" - "+t+"  %c  %c  http://www.pixijs.com/  %c %c ♥%c♥%c♥ ","background: #ff66a5","background: #ff66a5","color: #ff66a5; background: #030307;","background: #ff66a5","background: #ffc3dc","background: #ff66a5","color: #ff2424; background: #fff","color: #ff2424; background: #fff","color: #ff2424; background: #fff"];console.log.apply(console,i)}else window.console&&console.log("Pixi.js "+n.VERSION+" - http://www.pixijs.com/");n.dontSayHello=!0}},n.Point=function(n,t){this.x=n||0,this.y=t||0},n.Point.prototype.clone=function(){return new n.Point(this.x,this.y)},n.Point.prototype.set=function(n,t){this.x=n||0,this.y=t||(0!==t?this.x:0)},n.Point.prototype.constructor=n.Point,n.Rectangle=function(n,t,i,r){this.x=n||0,this.y=t||0,this.width=i||0,this.height=r||0},n.Rectangle.prototype.clone=function(){return new n.Rectangle(this.x,this.y,this.width,this.height)},n.Rectangle.prototype.contains=function(n,t){var i,r;return this.width<=0||this.height<=0?!1:(i=this.x,n>=i&&n<=i+this.width&&(r=this.y,t>=r&&t<=r+this.height))?!0:!1},n.Rectangle.prototype.constructor=n.Rectangle,n.EmptyRectangle=new n.Rectangle(0,0,0,0),n.Polygon=function(t){if(t instanceof Array||(t=Array.prototype.slice.call(arguments)),"number"==typeof t[0]){for(var r=[],i=0,u=t.length;u>i;i+=2)r.push(new n.Point(t[i],t[i+1]));t=r}this.points=t},n.Polygon.prototype.clone=function(){for(var i=[],t=0;t<this.points.length;t++)i.push(this.points[t].clone());return new n.Polygon(i)},n.Polygon.prototype.contains=function(n,t){for(var r=!1,i=0,u=this.points.length-1;i<this.points.length;u=i++){var e=this.points[i].x,f=this.points[i].y,s=this.points[u].x,o=this.points[u].y,h=f>t!=o>t&&(s-e)*(t-f)/(o-f)+e>n;h&&(r=!r)}return r},n.Polygon.prototype.constructor=n.Polygon,n.Circle=function(n,t,i){this.x=n||0,this.y=t||0,this.radius=i||0},n.Circle.prototype.clone=function(){return new n.Circle(this.x,this.y,this.radius)},n.Circle.prototype.contains=function(n,t){if(this.radius<=0)return!1;var i=this.x-n,r=this.y-t,u=this.radius*this.radius;return i*=i,r*=r,u>=i+r},n.Circle.prototype.getBounds=function(){return new n.Rectangle(this.x-this.radius,this.y-this.radius,this.width,this.height)},n.Circle.prototype.constructor=n.Circle,n.Ellipse=function(n,t,i,r){this.x=n||0,this.y=t||0,this.width=i||0,this.height=r||0},n.Ellipse.prototype.clone=function(){return new n.Ellipse(this.x,this.y,this.width,this.height)},n.Ellipse.prototype.contains=function(n,t){if(this.width<=0||this.height<=0)return!1;var i=(n-this.x)/this.width,r=(t-this.y)/this.height;return i*=i,r*=r,1>=i+r},n.Ellipse.prototype.getBounds=function(){return new n.Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)},n.Ellipse.prototype.constructor=n.Ellipse,n.Matrix=function(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0},n.Matrix.prototype.fromArray=function(n){this.a=n[0],this.b=n[1],this.c=n[3],this.d=n[4],this.tx=n[2],this.ty=n[5]},n.Matrix.prototype.toArray=function(n){this.array||(this.array=new Float32Array(9));var t=this.array;return n?(t[0]=this.a,t[1]=this.c,t[2]=0,t[3]=this.b,t[4]=this.d,t[5]=0,t[6]=this.tx,t[7]=this.ty,t[8]=1):(t[0]=this.a,t[1]=this.b,t[2]=this.tx,t[3]=this.c,t[4]=this.d,t[5]=this.ty,t[6]=0,t[7]=0,t[8]=1),t},n.identityMatrix=new n.Matrix,n.determineMatrixArrayType=function(){return"undefined"!=typeof Float32Array?Float32Array:Array},n.Matrix2=n.determineMatrixArrayType(),n.DisplayObject=function(){this.position=new n.Point,this.scale=new n.Point(1,1),this.pivot=new n.Point(0,0),this.rotation=0,this.alpha=1,this.visible=!0,this.hitArea=null,this.buttonMode=!1,this.renderable=!1,this.parent=null,this.stage=null,this.worldAlpha=1,this._interactive=!1,this.defaultCursor="pointer",this.worldTransform=new n.Matrix,this.color=[],this.dynamic=!0,this._sr=0,this._cr=1,this.filterArea=null,this._bounds=new n.Rectangle(0,0,1,1),this._currentBounds=null,this._mask=null,this._cacheAsBitmap=!1,this._cacheIsDirty=!1},n.DisplayObject.prototype.constructor=n.DisplayObject,n.DisplayObject.prototype.setInteractive=function(n){this.interactive=n},Object.defineProperty(n.DisplayObject.prototype,"interactive",{get:function(){return this._interactive},set:function(n){this._interactive=n,this.stage&&(this.stage.dirty=!0)}}),Object.defineProperty(n.DisplayObject.prototype,"worldVisible",{get:function(){var n=this;do{if(!n.visible)return!1;n=n.parent}while(n);return!0}}),Object.defineProperty(n.DisplayObject.prototype,"mask",{get:function(){return this._mask},set:function(n){this._mask&&(this._mask.isMask=!1),this._mask=n,this._mask&&(this._mask.isMask=!0)}}),Object.defineProperty(n.DisplayObject.prototype,"filters",{get:function(){return this._filters},set:function(n){var r,t,u,i;if(n){for(r=[],t=0;t<n.length;t++)for(u=n[t].passes,i=0;i<u.length;i++)r.push(u[i]);this._filterBlock={target:this,filterPasses:r}}this._filters=n}}),Object.defineProperty(n.DisplayObject.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(n){this._cacheAsBitmap!==n&&(n?this._generateCachedSprite():this._destroyCachedSprite(),this._cacheAsBitmap=n)}}),n.DisplayObject.prototype.updateTransform=function(){this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation));var n=this.parent.worldTransform,t=this.worldTransform,c=this.pivot.x,l=this.pivot.y,i=this._cr*this.scale.x,r=-this._sr*this.scale.y,u=this._sr*this.scale.x,f=this._cr*this.scale.y,a=this.position.x-i*c-l*r,v=this.position.y-f*l-c*u,e=n.a,o=n.b,s=n.c,h=n.d;t.a=e*i+o*u,t.b=e*r+o*f,t.tx=e*a+o*v+n.tx,t.c=s*i+h*u,t.d=s*r+h*f,t.ty=s*a+h*v+n.ty,this.worldAlpha=this.alpha*this.parent.worldAlpha},n.DisplayObject.prototype.getBounds=function(t){return t=t,n.EmptyRectangle},n.DisplayObject.prototype.getLocalBounds=function(){return this.getBounds(n.identityMatrix)},n.DisplayObject.prototype.setStageReference=function(n){this.stage=n,this._interactive&&(this.stage.dirty=!0)},n.DisplayObject.prototype.generateTexture=function(t){var i=this.getLocalBounds(),r=new n.RenderTexture(0|i.width,0|i.height,t);return r.render(this,new n.Point(-i.x,-i.y)),r},n.DisplayObject.prototype.updateCache=function(){this._generateCachedSprite()},n.DisplayObject.prototype._renderCachedSprite=function(t){this._cachedSprite.worldAlpha=this.worldAlpha,t.gl?n.Sprite.prototype._renderWebGL.call(this._cachedSprite,t):n.Sprite.prototype._renderCanvas.call(this._cachedSprite,t)},n.DisplayObject.prototype._generateCachedSprite=function(){var t,r,i;this._cacheAsBitmap=!1,t=this.getLocalBounds(),this._cachedSprite?this._cachedSprite.texture.resize(0|t.width,0|t.height):(r=new n.RenderTexture(0|t.width,0|t.height),this._cachedSprite=new n.Sprite(r),this._cachedSprite.worldTransform=this.worldTransform),i=this._filters,this._filters=null,this._cachedSprite.filters=i,this._cachedSprite.texture.render(this,new n.Point(-t.x,-t.y)),this._cachedSprite.anchor.x=-(t.x/t.width),this._cachedSprite.anchor.y=-(t.y/t.height),this._filters=i,this._cacheAsBitmap=!0},n.DisplayObject.prototype._destroyCachedSprite=function(){this._cachedSprite&&(this._cachedSprite.texture.destroy(!0),this._cachedSprite=null)},n.DisplayObject.prototype._renderWebGL=function(n){n=n},n.DisplayObject.prototype._renderCanvas=function(n){n=n},Object.defineProperty(n.DisplayObject.prototype,"x",{get:function(){return this.position.x},set:function(n){this.position.x=n}}),Object.defineProperty(n.DisplayObject.prototype,"y",{get:function(){return this.position.y},set:function(n){this.position.y=n}}),n.DisplayObjectContainer=function(){n.DisplayObject.call(this),this.children=[]},n.DisplayObjectContainer.prototype=Object.create(n.DisplayObject.prototype),n.DisplayObjectContainer.prototype.constructor=n.DisplayObjectContainer,Object.defineProperty(n.DisplayObjectContainer.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(n){var t=this.getLocalBounds().width;this.scale.x=0!==t?n/(t/this.scale.x):1,this._width=n}}),Object.defineProperty(n.DisplayObjectContainer.prototype,"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(n){var t=this.getLocalBounds().height;this.scale.y=0!==t?n/(t/this.scale.y):1,this._height=n}}),n.DisplayObjectContainer.prototype.addChild=function(n){return this.addChildAt(n,this.children.length)},n.DisplayObjectContainer.prototype.addChildAt=function(n,t){if(t>=0&&t<=this.children.length)return n.parent&&n.parent.removeChild(n),n.parent=this,this.children.splice(t,0,n),this.stage&&n.setStageReference(this.stage),n;throw new Error(n+" The index "+t+" supplied is out of bounds "+this.children.length);},n.DisplayObjectContainer.prototype.swapChildren=function(n,t){if(n!==t){var i=this.children.indexOf(n),r=this.children.indexOf(t);if(0>i||0>r)throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.");this.children[i]=t,this.children[r]=n}},n.DisplayObjectContainer.prototype.getChildAt=function(n){if(n>=0&&n<this.children.length)return this.children[n];throw new Error("Supplied index does not exist in the child list, or the supplied DisplayObject must be a child of the caller");},n.DisplayObjectContainer.prototype.removeChild=function(n){return this.removeChildAt(this.children.indexOf(n))},n.DisplayObjectContainer.prototype.removeChildAt=function(n){var t=this.getChildAt(n);return this.stage&&t.removeStageReference(),t.parent=void 0,this.children.splice(n,1),t},n.DisplayObjectContainer.prototype.removeChildren=function(n,t){var e=n||0,o="number"==typeof t?t:this.children.length,u=o-e,i,r,f;if(u>0&&o>=u){for(i=this.children.splice(e,u),r=0;r<i.length;r++)f=i[r],this.stage&&f.removeStageReference(),f.parent=void 0;return i}throw new Error("Range Error, numeric values are outside the acceptable range");},n.DisplayObjectContainer.prototype.updateTransform=function(){if(this.visible&&(n.DisplayObject.prototype.updateTransform.call(this),!this._cacheAsBitmap))for(var t=0,i=this.children.length;i>t;t++)this.children[t].updateTransform()},n.DisplayObjectContainer.prototype.getBounds=function(t){var l,v,r;if(0===this.children.length)return n.EmptyRectangle;t&&(l=this.worldTransform,this.worldTransform=t,this.updateTransform(),this.worldTransform=l);for(var i,h,c,u=1/0,f=1/0,e=-1/0,o=-1/0,a=!1,s=0,y=this.children.length;y>s;s++)v=this.children[s],v.visible&&(a=!0,i=this.children[s].getBounds(t),u=u<i.x?u:i.x,f=f<i.y?f:i.y,h=i.width+i.x,c=i.height+i.y,e=e>h?e:h,o=o>c?o:c);return a?(r=this._bounds,r.x=u,r.y=f,r.width=e-u,r.height=o-f,r):n.EmptyRectangle},n.DisplayObjectContainer.prototype.getLocalBounds=function(){var u=this.worldTransform,t,i,r;for(this.worldTransform=n.identityMatrix,t=0,i=this.children.length;i>t;t++)this.children[t].updateTransform();return r=this.getBounds(),this.worldTransform=u,r},n.DisplayObjectContainer.prototype.setStageReference=function(n){var t,i,r;for(this.stage=n,this._interactive&&(this.stage.dirty=!0),t=0,i=this.children.length;i>t;t++)r=this.children[t],r.setStageReference(n)},n.DisplayObjectContainer.prototype.removeStageReference=function(){for(var i,n=0,t=this.children.length;t>n;n++)i=this.children[n],i.removeStageReference();this._interactive&&(this.stage.dirty=!0),this.stage=null},n.DisplayObjectContainer.prototype._renderWebGL=function(n){if(this.visible&&!(this.alpha<=0)){if(this._cacheAsBitmap)return this._renderCachedSprite(n),void 0;var t,i;if(this._mask||this._filters){for(this._filters&&(n.spriteBatch.flush(),n.filterManager.pushFilter(this._filterBlock)),this._mask&&(n.spriteBatch.stop(),n.maskManager.pushMask(this.mask,n),n.spriteBatch.start()),t=0,i=this.children.length;i>t;t++)this.children[t]._renderWebGL(n);n.spriteBatch.stop(),this._mask&&n.maskManager.popMask(this._mask,n),this._filters&&n.filterManager.popFilter(),n.spriteBatch.start()}else for(t=0,i=this.children.length;i>t;t++)this.children[t]._renderWebGL(n)}},n.DisplayObjectContainer.prototype._renderCanvas=function(n){var t,i,r;if(this.visible!==!1&&0!==this.alpha){if(this._cacheAsBitmap)return this._renderCachedSprite(n),void 0;for(this._mask&&n.maskManager.pushMask(this._mask,n.context),t=0,i=this.children.length;i>t;t++)r=this.children[t],r._renderCanvas(n);this._mask&&n.maskManager.popMask(n.context)}},n.Sprite=function(t){n.DisplayObjectContainer.call(this),this.anchor=new n.Point,this.texture=t,this._width=0,this._height=0,this.tint=16777215,this.blendMode=n.blendModes.NORMAL,t.baseTexture.hasLoaded?this.onTextureUpdate():(this.onTextureUpdateBind=this.onTextureUpdate.bind(this),this.texture.addEventListener("update",this.onTextureUpdateBind)),this.renderable=!0},n.Sprite.prototype=Object.create(n.DisplayObjectContainer.prototype),n.Sprite.prototype.constructor=n.Sprite,Object.defineProperty(n.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(n){this.scale.x=n/this.texture.frame.width,this._width=n}}),Object.defineProperty(n.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(n){this.scale.y=n/this.texture.frame.height,this._height=n}}),n.Sprite.prototype.setTexture=function(n){this.texture=n,this.cachedTint=16777215},n.Sprite.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width),this._height&&(this.scale.y=this._height/this.texture.frame.height)},n.Sprite.prototype.getBounds=function(n){var ft=this.texture.frame.width,ut=this.texture.frame.height,s=ft*(1-this.anchor.x),b=ft*-this.anchor.x,y=ut*(1-this.anchor.y),o=ut*-this.anchor.y,e=n||this.worldTransform,tt=e.a,nt=e.c,g=e.b,d=e.d,k=e.tx,rt=e.ty,w=tt*b+g*o+k,it=d*o+nt*b+rt,p=tt*s+g*o+k,v=d*o+nt*s+rt,a=tt*s+g*y+k,l=d*y+nt*s+rt,c=tt*b+g*y+k,h=d*y+nt*b+rt,u=-1/0,r=-1/0,t=1/0,i=1/0,f;return t=t>w?w:t,t=t>p?p:t,t=t>a?a:t,t=t>c?c:t,i=i>it?it:i,i=i>v?v:i,i=i>l?l:i,i=i>h?h:i,u=w>u?w:u,u=p>u?p:u,u=a>u?a:u,u=c>u?c:u,r=it>r?it:r,r=v>r?v:r,r=l>r?l:r,r=h>r?h:r,f=this._bounds,f.x=t,f.width=u-t,f.y=i,f.height=r-i,this._currentBounds=f,f},n.Sprite.prototype._renderWebGL=function(n){var t,r,i;if(this.visible&&!(this.alpha<=0))if(this._mask||this._filters){for(i=n.spriteBatch,this._filters&&(i.flush(),n.filterManager.pushFilter(this._filterBlock)),this._mask&&(i.stop(),n.maskManager.pushMask(this.mask,n),i.start()),i.render(this),t=0,r=this.children.length;r>t;t++)this.children[t]._renderWebGL(n);i.stop(),this._mask&&n.maskManager.popMask(this._mask,n),this._filters&&n.filterManager.popFilter(),i.start()}else for(n.spriteBatch.render(this),t=0,r=this.children.length;r>t;t++)this.children[t]._renderWebGL(n)},n.Sprite.prototype._renderCanvas=function(t){var r,u,i,f;if(this.visible!==!1&&0!==this.alpha){for((this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,t.context.globalCompositeOperation=n.blendModesCanvas[t.currentBlendMode]),this._mask&&t.maskManager.pushMask(this._mask,t.context),this.texture.valid)&&(t.context.globalAlpha=this.worldAlpha,t.roundPixels?t.context.setTransform(this.worldTransform.a,this.worldTransform.c,this.worldTransform.b,this.worldTransform.d,0|this.worldTransform.tx,0|this.worldTransform.ty):t.context.setTransform(this.worldTransform.a,this.worldTransform.c,this.worldTransform.b,this.worldTransform.d,this.worldTransform.tx,this.worldTransform.ty),t.smoothProperty&&t.scaleMode!==this.texture.baseTexture.scaleMode&&(t.scaleMode=this.texture.baseTexture.scaleMode,t.context[t.smoothProperty]=t.scaleMode===n.scaleModes.LINEAR),r=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,u=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height,16777215!==this.tint?(this.cachedTint!==this.tint&&(this.cachedTint=this.tint,this.tintedTexture=n.CanvasTinter.getTintedTexture(this,this.tint)),t.context.drawImage(this.tintedTexture,0,0,this.texture.crop.width,this.texture.crop.height,r,u,this.texture.crop.width,this.texture.crop.height)):t.context.drawImage(this.texture.baseTexture.source,this.texture.crop.x,this.texture.crop.y,this.texture.crop.width,this.texture.crop.height,r,u,this.texture.crop.width,this.texture.crop.height)),i=0,f=this.children.length;f>i;i++)this.children[i]._renderCanvas(t);this._mask&&t.maskManager.popMask(t.context)}},n.Sprite.fromFrame=function(t){var i=n.TextureCache[t];if(!i)throw new Error('The frameId "'+t+'" does not exist in the texture cache'+this);return new n.Sprite(i)},n.Sprite.fromImage=function(t,i,r){var u=n.Texture.fromImage(t,i,r);return new n.Sprite(u)},n.SpriteBatch=function(t){n.DisplayObjectContainer.call(this),this.textureThing=t,this.ready=!1},n.SpriteBatch.prototype=Object.create(n.DisplayObjectContainer.prototype),n.SpriteBatch.constructor=n.SpriteBatch,n.SpriteBatch.prototype.initWebGL=function(t){this.fastSpriteBatch=new n.WebGLFastSpriteBatch(t),this.ready=!0},n.SpriteBatch.prototype.updateTransform=function(){n.DisplayObject.prototype.updateTransform.call(this)},n.SpriteBatch.prototype._renderWebGL=function(n){!this.visible||this.alpha<=0||!this.children.length||(this.ready||this.initWebGL(n.gl),n.spriteBatch.stop(),n.shaderManager.setShader(n.shaderManager.fastShader),this.fastSpriteBatch.begin(this,n),this.fastSpriteBatch.render(this),n.spriteBatch.start())},n.SpriteBatch.prototype._renderCanvas=function(t){var f=t.context,i,s,r,u;f.globalAlpha=this.worldAlpha,n.DisplayObject.prototype.updateTransform.call(this);for(var e=this.worldTransform,o=!0,h=0;h<this.children.length;h++)i=this.children[h],i.visible&&(s=i.texture,r=s.frame,(f.globalAlpha=this.worldAlpha*i.alpha,i.rotation%(2*Math.PI)==0)?(o&&(f.setTransform(e.a,e.c,e.b,e.d,e.tx,e.ty),o=!1),f.drawImage(s.baseTexture.source,r.x,r.y,r.width,r.height,i.anchor.x*-r.width*i.scale.x+i.position.x+.5|0,i.anchor.y*-r.height*i.scale.y+i.position.y+.5|0,r.width*i.scale.x,r.height*i.scale.y)):(o||(o=!0),n.DisplayObject.prototype.updateTransform.call(i),u=i.worldTransform,t.roundPixels?f.setTransform(u.a,u.c,u.b,u.d,0|u.tx,0|u.ty):f.setTransform(u.a,u.c,u.b,u.d,u.tx,u.ty),f.drawImage(s.baseTexture.source,r.x,r.y,r.width,r.height,i.anchor.x*-r.width+.5|0,i.anchor.y*-r.height+.5|0,r.width,r.height)))},n.MovieClip=function(t){n.Sprite.call(this,t[0]),this.textures=t,this.animationSpeed=1,this.loop=!0,this.onComplete=null,this.currentFrame=0,this.playing=!1},n.MovieClip.prototype=Object.create(n.Sprite.prototype),n.MovieClip.prototype.constructor=n.MovieClip,Object.defineProperty(n.MovieClip.prototype,"totalFrames",{get:function(){return this.textures.length}}),n.MovieClip.prototype.stop=function(){this.playing=!1},n.MovieClip.prototype.play=function(){this.playing=!0},n.MovieClip.prototype.gotoAndStop=function(n){this.playing=!1,this.currentFrame=n;var t=this.currentFrame+.5|0;this.setTexture(this.textures[t%this.textures.length])},n.MovieClip.prototype.gotoAndPlay=function(n){this.currentFrame=n,this.playing=!0},n.MovieClip.prototype.updateTransform=function(){if(n.Sprite.prototype.updateTransform.call(this),this.playing){this.currentFrame+=this.animationSpeed;var t=this.currentFrame+.5|0;this.currentFrame=this.currentFrame%this.textures.length,this.loop||t<this.textures.length?this.setTexture(this.textures[t%this.textures.length]):t>=this.textures.length&&(this.gotoAndStop(this.textures.length-1),this.onComplete&&this.onComplete())}},n.MovieClip.fromFrames=function(t){for(var r=[],i=0;i<t.length;i++)r.push(new n.Texture.fromFrame(t[i]));return new n.MovieClip(r)},n.MovieClip.fromImages=function(t){for(var r=[],i=0;i<t.length;i++)r.push(new n.Texture.fromImage(t[i]));return new n.MovieClip(r)},n.FilterBlock=function(){this.visible=!0,this.renderable=!0},n.Text=function(t,i){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),n.Sprite.call(this,n.Texture.fromCanvas(this.canvas)),this.setText(t),this.setStyle(i)},n.Text.prototype=Object.create(n.Sprite.prototype),n.Text.prototype.constructor=n.Text,Object.defineProperty(n.Text.prototype,"width",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.x*this.texture.frame.width},set:function(n){this.scale.x=n/this.texture.frame.width,this._width=n}}),Object.defineProperty(n.Text.prototype,"height",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.y*this.texture.frame.height},set:function(n){this.scale.y=n/this.texture.frame.height,this._height=n}}),n.Text.prototype.setStyle=function(n){n=n||{},n.font=n.font||"bold 20pt Arial",n.fill=n.fill||"black",n.align=n.align||"left",n.stroke=n.stroke||"black",n.strokeThickness=n.strokeThickness||0,n.wordWrap=n.wordWrap||!1,n.wordWrapWidth=n.wordWrapWidth||100,n.wordWrapWidth=n.wordWrapWidth||100,n.dropShadow=n.dropShadow||!1,n.dropShadowAngle=n.dropShadowAngle||Math.PI/6,n.dropShadowDistance=n.dropShadowDistance||4,n.dropShadowColor=n.dropShadowColor||"black",this.style=n,this.dirty=!0},n.Text.prototype.setText=function(n){this.text=n.toString()||" ",this.dirty=!0},n.Text.prototype.updateText=function(){var o,s,h,e,c,t,f,l,a;this.context.font=this.style.font,o=this.text,this.style.wordWrap&&(o=this.wordWrap(this.text));for(var i=o.split(/(?:\r\n|\r|\n)/),u=[],r=0,n=0;n<i.length;n++)s=this.context.measureText(i[n]).width,u[n]=s,r=Math.max(r,s);if(h=r+this.style.strokeThickness,this.style.dropShadow&&(h+=this.style.dropShadowDistance),this.canvas.width=h+this.context.lineWidth,e=this.determineFontHeight("font: "+this.style.font+";")+this.style.strokeThickness,c=e*i.length,this.style.dropShadow&&(c+=this.style.dropShadowDistance),this.canvas.height=c,navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.lineWidth=this.style.strokeThickness,this.context.textBaseline="top",this.style.dropShadow)for(this.context.fillStyle=this.style.dropShadowColor,l=Math.sin(this.style.dropShadowAngle)*this.style.dropShadowDistance,a=Math.cos(this.style.dropShadowAngle)*this.style.dropShadowDistance,n=0;n<i.length;n++)t=this.style.strokeThickness/2,f=this.style.strokeThickness/2+n*e,"right"===this.style.align?t+=r-u[n]:"center"===this.style.align&&(t+=(r-u[n])/2),this.style.fill&&this.context.fillText(i[n],t+l,f+a);for(this.context.fillStyle=this.style.fill,n=0;n<i.length;n++)t=this.style.strokeThickness/2,f=this.style.strokeThickness/2+n*e,"right"===this.style.align?t+=r-u[n]:"center"===this.style.align&&(t+=(r-u[n])/2),this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(i[n],t,f),this.style.fill&&this.context.fillText(i[n],t,f);this.updateTexture()},n.Text.prototype.updateTexture=function(){this.texture.baseTexture.width=this.canvas.width,this.texture.baseTexture.height=this.canvas.height,this.texture.crop.width=this.texture.frame.width=this.canvas.width,this.texture.crop.height=this.texture.frame.height=this.canvas.height,this._width=this.canvas.width,this._height=this.canvas.height,this.requiresUpdate=!0},n.Text.prototype._renderWebGL=function(t){this.requiresUpdate&&(this.requiresUpdate=!1,n.updateWebGLTexture(this.texture.baseTexture,t.gl)),n.Sprite.prototype._renderWebGL.call(this,t)},n.Text.prototype.updateTransform=function(){this.dirty&&(this.updateText(),this.dirty=!1),n.Sprite.prototype.updateTransform.call(this)},n.Text.prototype.determineFontHeight=function(t){var r=n.Text.heightCache[t];if(!r){var u=document.getElementsByTagName("body")[0],i=document.createElement("div"),f=document.createTextNode("M");i.appendChild(f),i.setAttribute("style",t+";position:absolute;top:0;left:0"),u.appendChild(i),r=i.offsetHeight,n.Text.heightCache[t]=r,u.removeChild(i)}return r},n.Text.prototype.wordWrap=function(n){for(var o,s,i="",f=n.split("\n"),r=0;r<f.length;r++){for(var e=this.style.wordWrapWidth,u=f[r].split(" "),t=0;t<u.length;t++)o=this.context.measureText(u[t]).width,s=o+this.context.measureText(" ").width,0===t||s>e?(t>0&&(i+="\n"),i+=u[t],e=this.style.wordWrapWidth-o):(e-=s,i+=" "+u[t]);r<f.length-1&&(i+="\n")}return i},n.Text.prototype.destroy=function(n){this.context=null,this.canvas=null,this.texture.destroy(void 0===n?!0:n)},n.Text.heightCache={},n.BitmapText=function(t,i){n.DisplayObjectContainer.call(this),this._pool=[],this.setText(t),this.setStyle(i),this.updateText(),this.dirty=!1},n.BitmapText.prototype=Object.create(n.DisplayObjectContainer.prototype),n.BitmapText.prototype.constructor=n.BitmapText,n.BitmapText.prototype.setText=function(n){this.text=n||" ",this.dirty=!0},n.BitmapText.prototype.setStyle=function(t){t=t||{},t.align=t.align||"left",this.style=t;var i=t.font.split(" ");this.fontName=i[i.length-1],this.fontSize=i.length>=2?parseInt(i[i.length-2],10):n.BitmapText.fonts[this.fontName].size,this.dirty=!0,this.tint=t.tint},n.BitmapText.prototype.updateText=function(){for(var a,u,y,h,r,p,c=n.BitmapText.fonts[this.fontName],i=new n.Point,o=null,f=[],e=0,l=[],v=0,s=this.fontSize/c.size,t=0;t<this.text.length;t++)a=this.text.charCodeAt(t),/(?:\r\n|\r|\n)/.test(this.text.charAt(t))?(l.push(i.x),e=Math.max(e,i.x),v++,i.x=0,i.y+=c.lineHeight,o=null):(u=c.chars[a],u&&(o&&u[o]&&(i.x+=u.kerning[o]),f.push({texture:u.texture,line:v,charCode:a,position:new n.Point(i.x+u.xOffset,i.y+u.yOffset)}),i.x+=u.xAdvance,o=a));for(l.push(i.x),e=Math.max(e,i.x),y=[],t=0;v>=t;t++)h=0,"right"===this.style.align?h=e-l[t]:"center"===this.style.align&&(h=(e-l[t])/2),y.push(h);var b=this.children.length,w=f.length,k=this.tint||16777215;for(t=0;w>t;t++)r=b>t?this.children[t]:this._pool.pop(),r?r.setTexture(f[t].texture):r=new n.Sprite(f[t].texture),r.position.x=(f[t].position.x+y[f[t].line])*s,r.position.y=f[t].position.y*s,r.scale.x=r.scale.y=s,r.tint=k,r.parent||this.addChild(r);for(;this.children.length>w;)p=this.getChildAt(this.children.length-1),this._pool.push(p),this.removeChild(p);this.textWidth=e*s,this.textHeight=(i.y+c.lineHeight)*s},n.BitmapText.prototype.updateTransform=function(){this.dirty&&(this.updateText(),this.dirty=!1),n.DisplayObjectContainer.prototype.updateTransform.call(this)},n.BitmapText.fonts={},n.InteractionData=function(){this.global=new n.Point,this.target=null,this.originalEvent=null},n.InteractionData.prototype.getLocalPosition=function(t){var i=t.worldTransform,u=this.global,f=i.a,e=i.b,h=i.tx,o=i.c,s=i.d,c=i.ty,r=1/(f*s+e*-o);return new n.Point(s*r*u.x+-e*r*u.y+(c*e-h*s)*r,f*r*u.y+-o*r*u.x+(-c*f+h*o)*r)},n.InteractionData.prototype.constructor=n.InteractionData,n.InteractionManager=function(t){this.stage=t,this.mouse=new n.InteractionData,this.touchs={},this.tempPoint=new n.Point,this.mouseoverEnabled=!0,this.pool=[],this.interactiveItems=[],this.interactionDOMElement=null,this.onMouseMove=this.onMouseMove.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseOut=this.onMouseOut.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.last=0,this.currentCursorStyle="inherit",this.mouseOut=!1},n.InteractionManager.prototype.constructor=n.InteractionManager,n.InteractionManager.prototype.collectInteractiveSprite=function(n,t){for(var i,u=n.children,f=u.length,r=f-1;r>=0;r--)i=u[r],i._interactive?(t.interactiveChildren=!0,this.interactiveItems.push(i),i.children.length>0&&this.collectInteractiveSprite(i,i)):(i.__iParent=null,i.children.length>0&&this.collectInteractiveSprite(i,t))},n.InteractionManager.prototype.setTarget=function(n){this.target=n,null===this.interactionDOMElement&&this.setTargetDomElement(n.view)},n.InteractionManager.prototype.setTargetDomElement=function(n){this.removeEvents(),window.navigator.msPointerEnabled&&(n.style["-ms-content-zooming"]="none",n.style["-ms-touch-action"]="none"),this.interactionDOMElement=n,n.addEventListener("mousemove",this.onMouseMove,!0),n.addEventListener("mousedown",this.onMouseDown,!0),n.addEventListener("mouseout",this.onMouseOut,!0),n.addEventListener("touchstart",this.onTouchStart,!0),n.addEventListener("touchend",this.onTouchEnd,!0),n.addEventListener("touchmove",this.onTouchMove,!0),window.addEventListener("mouseup",this.onMouseUp,!0)},n.InteractionManager.prototype.removeEvents=function(){this.interactionDOMElement&&(this.interactionDOMElement.style["-ms-content-zooming"]="",this.interactionDOMElement.style["-ms-touch-action"]="",this.interactionDOMElement.removeEventListener("mousemove",this.onMouseMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onMouseDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onMouseOut,!0),this.interactionDOMElement.removeEventListener("touchstart",this.onTouchStart,!0),this.interactionDOMElement.removeEventListener("touchend",this.onTouchEnd,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onTouchMove,!0),this.interactionDOMElement=null,window.removeEventListener("mouseup",this.onMouseUp,!0))},n.InteractionManager.prototype.update=function(){var f,r,i,t;if(this.target&&(f=Date.now(),r=f-this.last,r=r*n.INTERACTION_FREQUENCY/1e3,!(1>r))){this.last=f,i=0,this.dirty&&this.rebuildInteractiveGraph();var o=this.interactiveItems.length,u="inherit",e=!1;for(i=0;o>i;i++)t=this.interactiveItems[i],t.__hit=this.hitTest(t,this.mouse),this.mouse.target=t,t.__hit&&!e?(t.buttonMode&&(u=t.defaultCursor),t.interactiveChildren||(e=!0),t.__isOver||(t.mouseover&&t.mouseover(this.mouse),t.__isOver=!0)):t.__isOver&&(t.mouseout&&t.mouseout(this.mouse),t.__isOver=!1);this.currentCursorStyle!==u&&(this.currentCursorStyle=u,this.interactionDOMElement.style.cursor=u)}},n.InteractionManager.prototype.rebuildInteractiveGraph=function(){this.dirty=!1;for(var t=this.interactiveItems.length,n=0;t>n;n++)this.interactiveItems[n].interactiveChildren=!1;this.interactiveItems=[],this.stage.interactive&&this.interactiveItems.push(this.stage),this.collectInteractiveSprite(this.stage,this.stage)},n.InteractionManager.prototype.onMouseMove=function(n){var t,u,i,r;for(this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=n||window.event,t=this.interactionDOMElement.getBoundingClientRect(),this.mouse.global.x=(n.clientX-t.left)*(this.target.width/t.width),this.mouse.global.y=(n.clientY-t.top)*(this.target.height/t.height),u=this.interactiveItems.length,i=0;u>i;i++)r=this.interactiveItems[i],r.mousemove&&r.mousemove(this.mouse)},n.InteractionManager.prototype.onMouseDown=function(t){var u,r,i;for(this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=t||window.event,n.AUTO_PREVENT_DEFAULT&&this.mouse.originalEvent.preventDefault(),u=this.interactiveItems.length,r=0;u>r;r++)if(i=this.interactiveItems[r],(i.mousedown||i.click)&&(i.__mouseIsDown=!0,i.__hit=this.hitTest(i,this.mouse),i.__hit&&(i.mousedown&&i.mousedown(this.mouse),i.__isDown=!0,!i.interactiveChildren)))break},n.InteractionManager.prototype.onMouseOut=function(){var i,t,n;for(this.dirty&&this.rebuildInteractiveGraph(),i=this.interactiveItems.length,this.interactionDOMElement.style.cursor="inherit",t=0;i>t;t++)n=this.interactiveItems[t],n.__isOver&&(this.mouse.target=n,n.mouseout&&n.mouseout(this.mouse),n.__isOver=!1);this.mouseOut=!0,this.mouse.global.x=-1e4,this.mouse.global.y=-1e4},n.InteractionManager.prototype.onMouseUp=function(n){var t;this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=n||window.event;for(var u=this.interactiveItems.length,r=!1,i=0;u>i;i++)t=this.interactiveItems[i],t.__hit=this.hitTest(t,this.mouse),t.__hit&&!r?(t.mouseup&&t.mouseup(this.mouse),t.__isDown&&t.click&&t.click(this.mouse),t.interactiveChildren||(r=!0)):t.__isDown&&t.mouseupoutside&&t.mouseupoutside(this.mouse),t.__isDown=!1},n.InteractionManager.prototype.hitTest=function(t,i){var f=i.global,y,e,k,nt;if(!t.worldVisible)return!1;var tt=t instanceof n.Sprite,r=t.worldTransform,o=r.a,s=r.b,d=r.tx,h=r.c,c=r.d,b=r.ty,u=1/(o*c+s*-h),l=c*u*f.x+-s*u*f.y+(b*s-d*c)*u,a=o*u*f.y+-h*u*f.x+(-b*o+d*h)*u;if(i.target=t,t.hitArea&&t.hitArea.contains)return t.hitArea.contains(l,a)?(i.target=t,!0):!1;if(tt){var v,g=t.texture.frame.width,w=t.texture.frame.height,p=-g*t.anchor.x;if(l>p&&p+g>l&&(v=-w*t.anchor.y,a>v&&v+w>a))return i.target=t,!0}for(y=t.children.length,e=0;y>e;e++)if(k=t.children[e],nt=this.hitTest(k,i),nt)return i.target=t,!0;return!1},n.InteractionManager.prototype.onTouchMove=function(n){var i,e,r;this.dirty&&this.rebuildInteractiveGraph();for(var t,u=this.interactionDOMElement.getBoundingClientRect(),o=n.changedTouches,f=0,f=0;f<o.length;f++)for(i=o[f],t=this.touchs[i.identifier],t.originalEvent=n||window.event,t.global.x=(i.clientX-u.left)*(this.target.width/u.width),t.global.y=(i.clientY-u.top)*(this.target.height/u.height),navigator.isCocoonJS&&(t.global.x=i.clientX,t.global.y=i.clientY),e=0;e<this.interactiveItems.length;e++)r=this.interactiveItems[e],r.touchmove&&r.__touchData&&r.__touchData[i.identifier]&&r.touchmove(t)},n.InteractionManager.prototype.onTouchStart=function(t){var f,s,e,u,r,h,o,i;for(this.dirty&&this.rebuildInteractiveGraph(),f=this.interactionDOMElement.getBoundingClientRect(),n.AUTO_PREVENT_DEFAULT&&t.preventDefault(),s=t.changedTouches,e=0;e<s.length;e++)for(u=s[e],r=this.pool.pop(),r||(r=new n.InteractionData),r.originalEvent=t||window.event,this.touchs[u.identifier]=r,r.global.x=(u.clientX-f.left)*(this.target.width/f.width),r.global.y=(u.clientY-f.top)*(this.target.height/f.height),navigator.isCocoonJS&&(r.global.x=u.clientX,r.global.y=u.clientY),h=this.interactiveItems.length,o=0;h>o;o++)if(i=this.interactiveItems[o],(i.touchstart||i.tap)&&(i.__hit=this.hitTest(i,r),i.__hit&&(i.touchstart&&i.touchstart(r),i.__isDown=!0,i.__touchData=i.__touchData||{},i.__touchData[u.identifier]=r,!i.interactiveChildren)))break},n.InteractionManager.prototype.onTouchEnd=function(n){var h,f,t;this.dirty&&this.rebuildInteractiveGraph();for(var u=this.interactionDOMElement.getBoundingClientRect(),o=n.changedTouches,e=0;e<o.length;e++){var i=o[e],r=this.touchs[i.identifier],s=!1;for(r.global.x=(i.clientX-u.left)*(this.target.width/u.width),r.global.y=(i.clientY-u.top)*(this.target.height/u.height),navigator.isCocoonJS&&(r.global.x=i.clientX,r.global.y=i.clientY),h=this.interactiveItems.length,f=0;h>f;f++)t=this.interactiveItems[f],t.__touchData&&t.__touchData[i.identifier]&&(t.__hit=this.hitTest(t,t.__touchData[i.identifier]),r.originalEvent=n||window.event,(t.touchend||t.tap)&&(t.__hit&&!s?(t.touchend&&t.touchend(r),t.__isDown&&t.tap&&t.tap(r),t.interactiveChildren||(s=!0)):t.__isDown&&t.touchendoutside&&t.touchendoutside(r),t.__isDown=!1),t.__touchData[i.identifier]=null);this.pool.push(r),this.touchs[i.identifier]=null}},n.Stage=function(t){n.DisplayObjectContainer.call(this),this.worldTransform=new n.Matrix,this.interactive=!0,this.interactionManager=new n.InteractionManager(this),this.dirty=!0,this.stage=this,this.stage.hitArea=new n.Rectangle(0,0,1e5,1e5),this.setBackgroundColor(t)},n.Stage.prototype=Object.create(n.DisplayObjectContainer.prototype),n.Stage.prototype.constructor=n.Stage,n.Stage.prototype.setInteractionDelegate=function(n){this.interactionManager.setTargetDomElement(n)},n.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var n=0,t=this.children.length;t>n;n++)this.children[n].updateTransform();this.dirty&&(this.dirty=!1,this.interactionManager.dirty=!0),this.interactive&&this.interactionManager.update()},n.Stage.prototype.setBackgroundColor=function(t){this.backgroundColor=t||0,this.backgroundColorSplit=n.hex2rgb(this.backgroundColor);var i=this.backgroundColor.toString(16);i="000000".substr(0,6-i.length)+i,this.backgroundColorString="#"+i},n.Stage.prototype.getMousePosition=function(){return this.interactionManager.mouse.global};for(var u=0,r=["ms","moz","webkit","o"],i=0;i<r.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[r[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[r[i]+"CancelAnimationFrame"]||window[r[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(n){var t=+new Date,i=Math.max(0,16-(t-u)),r=window.setTimeout(function(){n(t+i)},i);return u=t+i,r}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(n){clearTimeout(n)}),window.requestAnimFrame=window.requestAnimationFrame,n.hex2rgb=function(n){return[(n>>16&255)/255,(n>>8&255)/255,(255&n)/255]},n.rgb2hex=function(n){return(255*n[0]<<16)+(255*n[1]<<8)+255*n[2]},"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(){var n=Array.prototype.slice;return function(t){function i(){var u=f.concat(n.call(arguments));r.apply(this instanceof i?this:t,u)}var r=this,f=n.call(arguments,1);if("function"!=typeof r)throw new TypeError;return i.prototype=function u(n){return n&&(u.prototype=n),this instanceof u?void 0:new u}(r.prototype),i}}()),n.AjaxRequest=function(){var t=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"],n;if(!window.ActiveXObject)return window.XMLHttpRequest?new window.XMLHttpRequest:!1;for(n=0;n<t.length;n++)try{return new window.ActiveXObject(t[n])}catch(i){}},n.canUseNewCanvasBlendModes=function(){var t=document.createElement("canvas"),n;return t.width=1,t.height=1,n=t.getContext("2d"),n.fillStyle="#000",n.fillRect(0,0,1,1),n.globalCompositeOperation="multiply",n.fillStyle="#fff",n.fillRect(0,0,1,1),0===n.getImageData(0,0,1,1).data[0]},n.getNextPowerOfTwo=function(n){if(n>0&&0==(n&n-1))return n;for(var t=1;n>t;)t<<=1;return t},n.EventTarget=function(){var n={};this.addEventListener=this.on=function(t,i){void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(i)&&n[t].unshift(i)},this.dispatchEvent=this.emit=function(t){if(n[t.type]&&n[t.type].length)for(var i=n[t.type].length-1;i>=0;i--)n[t.type][i](t)},this.removeEventListener=this.off=function(t,i){if(void 0!==n[t]){var r=n[t].indexOf(i);-1!==r&&n[t].splice(r,1)}},this.removeAllEventListeners=function(t){var i=n[t];i&&(i.length=0)}},n.autoDetectRenderer=function(t,i,r,u,f){t||(t=800),i||(i=600);var e=function(){try{var n=document.createElement("canvas");return!!window.WebGLRenderingContext&&(n.getContext("webgl")||n.getContext("experimental-webgl"))}catch(t){return!1}}();return e?new n.WebGLRenderer(t,i,r,u,f):new n.CanvasRenderer(t,i,r,u)},n.autoDetectRecommendedRenderer=function(t,i,r,u,f){t||(t=800),i||(i=600);var e=function(){try{var n=document.createElement("canvas");return!!window.WebGLRenderingContext&&(n.getContext("webgl")||n.getContext("experimental-webgl"))}catch(t){return!1}}(),o=/Android/i.test(navigator.userAgent);return e&&!o?new n.WebGLRenderer(t,i,r,u,f):new n.CanvasRenderer(t,i,r,u)},n.PolyK={},n.PolyK.Triangulate=function(t){var a=!0,e=t.length>>1,u,h,f;if(3>e)return[];for(var c=[],r=[],i=0;e>i;i++)r.push(i);for(i=0,u=e;u>3;){var o=r[(i+0)%u],s=r[(i+1)%u],l=r[(i+2)%u],y=t[2*o],p=t[2*o+1],w=t[2*s],b=t[2*s+1],k=t[2*l],d=t[2*l+1],v=!1;if(n.PolyK._convex(y,p,w,b,k,d,a))for(v=!0,h=0;u>h;h++)if(f=r[h],f!==o&&f!==s&&f!==l&&n.PolyK._PointInTriangle(t[2*f],t[2*f+1],y,p,w,b,k,d)){v=!1;break}if(v)c.push(o,s,l),r.splice((i+1)%u,1),u--,i=0;else if(i++>3*u){if(!a)return window.console.log("PIXI Warning: shape too complex to fill"),[];for(c=[],r=[],i=0;e>i;i++)r.push(i);i=0,u=e,a=!1}}return c.push(r[0],r[1],r[2]),c},n.PolyK._PointInTriangle=function(n,t,i,r,u,f,e,o){var a=e-i,l=o-r,c=u-i,h=f-r,v=n-i,y=t-r,p=a*a+l*l,s=a*c+l*h,w=a*v+l*y,b=c*c+h*h,k=c*v+h*y,d=1/(p*b-s*s),g=(b*w-s*k)*d,nt=(p*k-s*w)*d;return g>=0&&nt>=0&&1>g+nt},n.PolyK._convex=function(n,t,i,r,u,f,e){return(t-r)*(u-i)+(i-n)*(f-r)>=0===e},n.initDefaultShaders=function(){},n.CompileVertexShader=function(t,i){return n._CompileShader(t,i,t.VERTEX_SHADER)},n.CompileFragmentShader=function(t,i){return n._CompileShader(t,i,t.FRAGMENT_SHADER)},n._CompileShader=function(n,t,i){var u=t.join("\n"),r=n.createShader(i);return n.shaderSource(r,u),n.compileShader(r),n.getShaderParameter(r,n.COMPILE_STATUS)?r:(window.console.log(n.getShaderInfoLog(r)),null)},n.compileProgram=function(t,i,r){var f=n.CompileFragmentShader(t,r),e=n.CompileVertexShader(t,i),u=t.createProgram();return t.attachShader(u,e),t.attachShader(u,f),t.linkProgram(u),t.getProgramParameter(u,t.LINK_STATUS)||window.console.log("Could not initialise shaders"),u},n.PixiShader=function(t){this._UID=n._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.textureCount=0,this.attributes=[],this.init()},n.PixiShader.prototype.init=function(){var t=this.gl,i=n.compileProgram(t,this.vertexSrc||n.PixiShader.defaultVertexSrc,this.fragmentSrc),r;t.useProgram(i),this.uSampler=t.getUniformLocation(i,"uSampler"),this.projectionVector=t.getUniformLocation(i,"projectionVector"),this.offsetVector=t.getUniformLocation(i,"offsetVector"),this.dimensions=t.getUniformLocation(i,"dimensions"),this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition"),this.aTextureCoord=t.getAttribLocation(i,"aTextureCoord"),this.colorAttribute=t.getAttribLocation(i,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute];for(r in this.uniforms)this.uniforms[r].uniformLocation=t.getUniformLocation(i,r);this.initUniforms(),this.program=i},n.PixiShader.prototype.initUniforms=function(){var t,i,r,n;this.textureCount=1,i=this.gl;for(r in this.uniforms)t=this.uniforms[r],n=t.type,"sampler2D"===n?(t._init=!1,null!==t.value&&this.initSampler2D(t)):"mat2"===n||"mat3"===n||"mat4"===n?(t.glMatrix=!0,t.glValueLength=1,"mat2"===n?t.glFunc=i.uniformMatrix2fv:"mat3"===n?t.glFunc=i.uniformMatrix3fv:"mat4"===n&&(t.glFunc=i.uniformMatrix4fv)):(t.glFunc=i["uniform"+n],t.glValueLength="2f"===n||"2i"===n?2:"3f"===n||"3i"===n?3:"4f"===n||"4i"===n?4:1)},n.PixiShader.prototype.initSampler2D=function(n){var t;if(n.value&&n.value.baseTexture&&n.value.baseTexture.hasLoaded){if(t=this.gl,t.activeTexture(t["TEXTURE"+this.textureCount]),t.bindTexture(t.TEXTURE_2D,n.value.baseTexture._glTextures[t.id]),n.textureData){var i=n.textureData,e=i.magFilter?i.magFilter:t.LINEAR,o=i.minFilter?i.minFilter:t.LINEAR,u=i.wrapS?i.wrapS:t.CLAMP_TO_EDGE,f=i.wrapT?i.wrapT:t.CLAMP_TO_EDGE,r=i.luminance?t.LUMINANCE:t.RGBA;if(i.repeat&&(u=t.REPEAT,f=t.REPEAT),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!!i.flipY),i.width){var s=i.width?i.width:512,h=i.height?i.height:2,c=i.border?i.border:0;t.texImage2D(t.TEXTURE_2D,0,r,s,h,c,r,t.UNSIGNED_BYTE,null)}else t.texImage2D(t.TEXTURE_2D,0,r,t.RGBA,t.UNSIGNED_BYTE,n.value.baseTexture.source);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,o),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,u),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,f)}t.uniform1i(n.uniformLocation,this.textureCount),n._init=!0,this.textureCount++}},n.PixiShader.prototype.syncUniforms=function(){var t,i,r;this.textureCount=1,i=this.gl;for(r in this.uniforms)t=this.uniforms[r],1===t.glValueLength?t.glMatrix===!0?t.glFunc.call(i,t.uniformLocation,t.transpose,t.value):t.glFunc.call(i,t.uniformLocation,t.value):2===t.glValueLength?t.glFunc.call(i,t.uniformLocation,t.value.x,t.value.y):3===t.glValueLength?t.glFunc.call(i,t.uniformLocation,t.value.x,t.value.y,t.value.z):4===t.glValueLength?t.glFunc.call(i,t.uniformLocation,t.value.x,t.value.y,t.value.z,t.value.w):"sampler2D"===t.type&&(t._init?(i.activeTexture(i["TEXTURE"+this.textureCount]),i.bindTexture(i.TEXTURE_2D,t.value.baseTexture._glTextures[i.id]||n.createWebGLTexture(t.value.baseTexture,i)),i.uniform1i(t.uniformLocation,this.textureCount),this.textureCount++):this.initSampler2D(t))},n.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},n.PixiShader.defaultVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec2 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vec3 color = mod(vec3(aColor.y/65536.0, aColor.y/256.0, aColor.y), 256.0) / 256.0;","   vColor = vec4(color * aColor.x, aColor.x);","}"],n.PixiFastShader=function(t){this._UID=n._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform mat3 uMatrix;","varying vec2 vTextureCoord;","varying float vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 v;","   vec2 sv = aVertexPosition * aScale;","   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);","   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);","   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;","   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"],this.textureCount=0,this.init()},n.PixiFastShader.prototype.init=function(){var t=this.gl,i=n.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(i),this.uSampler=t.getUniformLocation(i,"uSampler"),this.projectionVector=t.getUniformLocation(i,"projectionVector"),this.offsetVector=t.getUniformLocation(i,"offsetVector"),this.dimensions=t.getUniformLocation(i,"dimensions"),this.uMatrix=t.getUniformLocation(i,"uMatrix"),this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition"),this.aPositionCoord=t.getAttribLocation(i,"aPositionCoord"),this.aScale=t.getAttribLocation(i,"aScale"),this.aRotation=t.getAttribLocation(i,"aRotation"),this.aTextureCoord=t.getAttribLocation(i,"aTextureCoord"),this.colorAttribute=t.getAttribLocation(i,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,this.aTextureCoord,this.colorAttribute],this.program=i},n.PixiFastShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},n.StripShader=function(t){this._UID=n._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y));","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","}"],this.init()},n.StripShader.prototype.init=function(){var t=this.gl,i=n.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(i),this.uSampler=t.getUniformLocation(i,"uSampler"),this.projectionVector=t.getUniformLocation(i,"projectionVector"),this.offsetVector=t.getUniformLocation(i,"offsetVector"),this.colorAttribute=t.getAttribLocation(i,"aColor"),this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition"),this.aTextureCoord=t.getAttribLocation(i,"aTextureCoord"),this.attributes=[this.aVertexPosition,this.aTextureCoord],this.translationMatrix=t.getUniformLocation(i,"translationMatrix"),this.alpha=t.getUniformLocation(i,"alpha"),this.program=i},n.PrimitiveShader=function(t){this._UID=n._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"],this.init()},n.PrimitiveShader.prototype.init=function(){var t=this.gl,i=n.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(i),this.projectionVector=t.getUniformLocation(i,"projectionVector"),this.offsetVector=t.getUniformLocation(i,"offsetVector"),this.tintColor=t.getUniformLocation(i,"tint"),this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition"),this.colorAttribute=t.getAttribLocation(i,"aColor"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=t.getUniformLocation(i,"translationMatrix"),this.alpha=t.getUniformLocation(i,"alpha"),this.program=i},n.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},n.ComplexPrimitiveShader=function(t){this._UID=n._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vColor = vec4(color * alpha * tint, alpha);","}"],this.init()},n.ComplexPrimitiveShader.prototype.init=function(){var t=this.gl,i=n.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(i),this.projectionVector=t.getUniformLocation(i,"projectionVector"),this.offsetVector=t.getUniformLocation(i,"offsetVector"),this.tintColor=t.getUniformLocation(i,"tint"),this.color=t.getUniformLocation(i,"color"),this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=t.getUniformLocation(i,"translationMatrix"),this.alpha=t.getUniformLocation(i,"alpha"),this.program=i},n.ComplexPrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},n.WebGLGraphics=function(){},n.WebGLGraphics.renderGraphics=function(t,i){var u,r=i.gl,s=i.projection,h=i.offset,f=i.shaderManager.primitiveShader,o,e;for(t.dirty&&n.WebGLGraphics.updateGraphics(t,r),o=t._webGL[r.id],e=0;e<o.data.length;e++)1===o.data[e].mode?(u=o.data[e],i.stencilManager.pushStencil(t,u,i),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,2*(u.indices.length-4)),i.stencilManager.popStencil(t,u,i),this.last=u.mode):(u=o.data[e],i.shaderManager.setShader(f),f=i.shaderManager.primitiveShader,r.uniformMatrix3fv(f.translationMatrix,!1,t.worldTransform.toArray(!0)),r.uniform2f(f.projectionVector,s.x,-s.y),r.uniform2f(f.offsetVector,-h.x,-h.y),r.uniform3fv(f.tintColor,n.hex2rgb(t.tint)),r.uniform1f(f.alpha,t.worldAlpha),r.bindBuffer(r.ARRAY_BUFFER,u.buffer),r.vertexAttribPointer(f.aVertexPosition,2,r.FLOAT,!1,24,0),r.vertexAttribPointer(f.colorAttribute,4,r.FLOAT,!1,24,8),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,u.indexBuffer),r.drawElements(r.TRIANGLE_STRIP,u.indices.length,r.UNSIGNED_SHORT,0))},n.WebGLGraphics.updateGraphics=function(t,i){var u=t._webGL[i.id],e,o,f,r;if(u||(u=t._webGL[i.id]={lastIndex:0,data:[],gl:i}),t.dirty=!1,t.clearDirty){for(t.clearDirty=!1,e=0;e<u.data.length;e++)o=u.data[e],o.reset(),n.WebGLGraphics.graphicsDataPool.push(o);u.data=[],u.lastIndex=0}for(e=u.lastIndex;e<t.graphicsData.length;e++)r=t.graphicsData[e],r.type===n.Graphics.POLY?(r.fill&&r.points.length>6&&(r.points.length>10?(f=n.WebGLGraphics.switchMode(u,1),n.WebGLGraphics.buildComplexPoly(r,f)):(f=n.WebGLGraphics.switchMode(u,0),n.WebGLGraphics.buildPoly(r,f))),r.lineWidth>0&&(f=n.WebGLGraphics.switchMode(u,0),n.WebGLGraphics.buildLine(r,f))):(f=n.WebGLGraphics.switchMode(u,0),r.type===n.Graphics.RECT?n.WebGLGraphics.buildRectangle(r,f):r.type===n.Graphics.CIRC||r.type===n.Graphics.ELIP?n.WebGLGraphics.buildCircle(r,f):r.type===n.Graphics.RREC&&n.WebGLGraphics.buildRoundedRectangle(r,f)),u.lastIndex++;for(e=0;e<u.data.length;e++)f=u.data[e],f.dirty&&f.upload()},n.WebGLGraphics.switchMode=function(t,i){var r;return t.data.length?(r=t.data[t.data.length-1],(r.mode!==i||1===i)&&(r=n.WebGLGraphics.graphicsDataPool.pop()||new n.WebGLGraphicsData(t.gl),r.mode=i,t.data.push(r))):(r=n.WebGLGraphics.graphicsDataPool.pop()||new n.WebGLGraphicsData(t.gl),r.mode=i,t.data.push(r)),r.dirty=!0,r},n.WebGLGraphics.buildRectangle=function(t,i){var s=t.points,r=s[0],u=s[1],h=s[2],c=s[3],p;if(t.fill){var y=n.hex2rgb(t.fillColor),e=t.fillAlpha,l=y[0]*e,a=y[1]*e,v=y[2]*e,f=i.points,w=i.indices,o=f.length/6;f.push(r,u),f.push(l,a,v,e),f.push(r+h,u),f.push(l,a,v,e),f.push(r,u+c),f.push(l,a,v,e),f.push(r+h,u+c),f.push(l,a,v,e),w.push(o,o,o+1,o+2,o+3,o+3)}t.lineWidth&&(p=t.points,t.points=[r,u,r+h,u,r+h,u+c,r,u+c,r,u],n.WebGLGraphics.buildLine(t,i),t.points=p)},n.WebGLGraphics.buildRoundedRectangle=function(t,i){var l=t.points,u=l[0],f=l[1],s=l[2],h=l[3],o=l[4],r=[],b;if(r.push(u,f+o),r=r.concat(n.WebGLGraphics.quadraticBezierCurve(u,f+h-o,u,f+h,u+o,f+h)),r=r.concat(n.WebGLGraphics.quadraticBezierCurve(u+s-o,f+h,u+s,f+h,u+s,f+h-o)),r=r.concat(n.WebGLGraphics.quadraticBezierCurve(u+s,f+o,u+s,f,u+s-o,f)),r=r.concat(n.WebGLGraphics.quadraticBezierCurve(u+o,f,u,f,u,f+o)),t.fill){for(var p=n.hex2rgb(t.fillColor),y=t.fillAlpha,g=p[0]*y,d=p[1]*y,k=p[2]*y,w=i.points,v=i.indices,a=w.length/6,c=n.PolyK.Triangulate(r),e=0,e=0;e<c.length;e+=3)v.push(c[e]+a),v.push(c[e]+a),v.push(c[e+1]+a),v.push(c[e+2]+a),v.push(c[e+2]+a);for(e=0;e<r.length;e++)w.push(r[e],r[++e],g,d,k,y)}t.lineWidth&&(b=t.points,t.points=r,n.WebGLGraphics.buildLine(t,i),t.points=b)},n.WebGLGraphics.quadraticBezierCurve=function(n,t,i,r,u,f){function o(n,t,i){var r=t-n;return n+r*i}for(var p,w,h,c,l,a,v=20,y=[],e=0,s=0;v>=s;s++)e=s/v,p=o(n,i,e),w=o(t,r,e),h=o(i,u,e),c=o(r,f,e),l=o(p,h,e),a=o(w,c,e),y.push(l,a);return y},n.WebGLGraphics.buildCircle=function(t,i){var o=t.points,s=o[0],h=o[1],y=o[2],p=o[3],c=40,f=2*Math.PI/c,r=0,d;if(t.fill){var l=n.hex2rgb(t.fillColor),u=t.fillAlpha,w=l[0]*u,b=l[1]*u,k=l[2]*u,a=i.points,v=i.indices,e=a.length/6;for(v.push(e),r=0;c+1>r;r++)a.push(s,h,w,b,k,u),a.push(s+Math.sin(f*r)*y,h+Math.cos(f*r)*p,w,b,k,u),v.push(e++,e++);v.push(e-1)}if(t.lineWidth){for(d=t.points,t.points=[],r=0;c+1>r;r++)t.points.push(s+Math.sin(f*r)*y,h+Math.cos(f*r)*p);n.WebGLGraphics.buildLine(t,i),t.points=d}},n.WebGLGraphics.buildLine=function(t,i){var h=0,r=t.points,it,tt,lt,ct;if(0!==r.length){if(t.lineWidth%2)for(h=0;h<r.length;h++)r[h]+=.5;it=new n.Point(r[0],r[1]),tt=new n.Point(r[r.length-2],r[r.length-1]),it.x===tt.x&&it.y===tt.y&&(r=r.slice(),r.pop(),r.pop(),tt=new n.Point(r[r.length-2],r[r.length-1]),lt=tt.x+.5*(it.x-tt.x),ct=tt.y+.5*(it.y-tt.y),r.unshift(lt,ct),r.push(lt,ct));var ut,rt,p,d,o,e,ot,st,f,u,w,b,g,nt,bt,pt,vt,ht,kt,dt,et,gt,c,s=i.points,at=i.indices,ft=r.length/2,ni=r.length,yt=s.length/6,k=t.lineWidth/2,wt=n.hex2rgb(t.lineColor),l=t.lineAlpha,a=wt[0]*l,v=wt[1]*l,y=wt[2]*l;for(p=r[0],d=r[1],o=r[2],e=r[3],f=-(d-e),u=p-o,c=Math.sqrt(f*f+u*u),f/=c,u/=c,f*=k,u*=k,s.push(p-f,d-u,a,v,y,l),s.push(p+f,d+u,a,v,y,l),h=1;ft-1>h;h++)p=r[2*(h-1)],d=r[2*(h-1)+1],o=r[2*h],e=r[2*h+1],ot=r[2*(h+1)],st=r[2*(h+1)+1],f=-(d-e),u=p-o,c=Math.sqrt(f*f+u*u),f/=c,u/=c,f*=k,u*=k,w=-(e-st),b=o-ot,c=Math.sqrt(w*w+b*b),w/=c,b/=c,w*=k,b*=k,bt=-u+d-(-u+e),pt=-f+o-(-f+p),vt=(-f+p)*(-u+e)-(-f+o)*(-u+d),ht=-b+st-(-b+e),kt=-w+o-(-w+ot),dt=(-w+ot)*(-b+e)-(-w+o)*(-b+st),et=bt*kt-ht*pt,Math.abs(et)<.1?(et+=10.1,s.push(o-f,e-u,a,v,y,l),s.push(o+f,e+u,a,v,y,l)):(ut=(pt*dt-kt*vt)/et,rt=(ht*vt-bt*dt)/et,gt=(ut-o)*(ut-o)+(rt-e)+(rt-e),gt>19600?(g=f-w,nt=u-b,c=Math.sqrt(g*g+nt*nt),g/=c,nt/=c,g*=k,nt*=k,s.push(o-g,e-nt),s.push(a,v,y,l),s.push(o+g,e+nt),s.push(a,v,y,l),s.push(o-g,e-nt),s.push(a,v,y,l),ni++):(s.push(ut,rt),s.push(a,v,y,l),s.push(o-(ut-o),e-(rt-e)),s.push(a,v,y,l)));for(p=r[2*(ft-2)],d=r[2*(ft-2)+1],o=r[2*(ft-1)],e=r[2*(ft-1)+1],f=-(d-e),u=p-o,c=Math.sqrt(f*f+u*u),f/=c,u/=c,f*=k,u*=k,s.push(o-f,e-u),s.push(a,v,y,l),s.push(o+f,e+u),s.push(a,v,y,l),at.push(yt),h=0;ni>h;h++)at.push(yt++);at.push(yt-1)}},n.WebGLGraphics.buildComplexPoly=function(t,i){var u=t.points.slice(),l,a;if(!(u.length<6)){l=i.indices,i.points=u,i.alpha=t.fillAlpha,i.color=n.hex2rgb(t.fillColor);for(var f,e,o=1/0,s=-1/0,h=1/0,c=-1/0,r=0;r<u.length;r+=2)f=u[r],e=u[r+1],o=o>f?f:o,s=f>s?f:s,h=h>e?e:h,c=e>c?e:c;for(u.push(o,h,s,h,s,c,o,c),a=u.length/2,r=0;a>r;r++)l.push(r)}},n.WebGLGraphics.buildPoly=function(t,i){var f=t.points;if(!(f.length<6)){for(var c=i.points,e=i.indices,l=f.length/2,h=n.hex2rgb(t.fillColor),s=t.fillAlpha,a=h[0]*s,v=h[1]*s,y=h[2]*s,u=n.PolyK.Triangulate(f),o=c.length/6,r=0,r=0;r<u.length;r+=3)e.push(u[r]+o),e.push(u[r]+o),e.push(u[r+1]+o),e.push(u[r+2]+o),e.push(u[r+2]+o);for(r=0;l>r;r++)c.push(f[2*r],f[2*r+1],a,v,y,s)}},n.WebGLGraphics.graphicsDataPool=[],n.WebGLGraphicsData=function(n){this.gl=n,this.color=[0,0,0],this.points=[],this.indices=[],this.lastIndex=0,this.buffer=n.createBuffer(),this.indexBuffer=n.createBuffer(),this.mode=1,this.alpha=1,this.dirty=!0},n.WebGLGraphicsData.prototype.reset=function(){this.points=[],this.indices=[],this.lastIndex=0},n.WebGLGraphicsData.prototype.upload=function(){var n=this.gl;this.glPoints=new Float32Array(this.points),n.bindBuffer(n.ARRAY_BUFFER,this.buffer),n.bufferData(n.ARRAY_BUFFER,this.glPoints,n.STATIC_DRAW),this.glIndicies=new Uint16Array(this.indices),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,this.glIndicies,n.STATIC_DRAW),this.dirty=!1},n.glContexts=[],n.WebGLRenderer=function(t,i,r,u,f,e){n.defaultRenderer||(n.sayHello("webGL"),n.defaultRenderer=this),this.type=n.WEBGL_RENDERER,this.transparent=!!u,this.preserveDrawingBuffer=e,this.width=t||800,this.height=i||600,this.view=r||document.createElement("canvas"),this.view.width=this.width,this.view.height=this.height,this.contextLost=this.handleContextLost.bind(this),this.contextRestoredLost=this.handleContextRestored.bind(this),this.view.addEventListener("webglcontextlost",this.contextLost,!1),this.view.addEventListener("webglcontextrestored",this.contextRestoredLost,!1),this.options={alpha:this.transparent,antialias:!!f,premultipliedAlpha:!!u,stencil:!0,preserveDrawingBuffer:e};var o=null;if(["experimental-webgl","webgl"].forEach(function(n){try{o=o||this.view.getContext(n,this.options)}catch(t){}},this),!o)throw new Error("This browser does not support webGL. Try using the canvas renderer"+this);this.gl=o,this.glContextId=o.id=n.WebGLRenderer.glContextId++,n.glContexts[this.glContextId]=o,n.blendModesWebGL||(n.blendModesWebGL=[],n.blendModesWebGL[n.blendModes.NORMAL]=[o.ONE,o.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.ADD]=[o.SRC_ALPHA,o.DST_ALPHA],n.blendModesWebGL[n.blendModes.MULTIPLY]=[o.DST_COLOR,o.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.SCREEN]=[o.SRC_ALPHA,o.ONE],n.blendModesWebGL[n.blendModes.OVERLAY]=[o.ONE,o.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.DARKEN]=[o.ONE,o.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.LIGHTEN]=[o.ONE,o.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.COLOR_DODGE]=[o.ONE,o.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.COLOR_BURN]=[o.ONE,o.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.HARD_LIGHT]=[o.ONE,o.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.SOFT_LIGHT]=[o.ONE,o.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.DIFFERENCE]=[o.ONE,o.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.EXCLUSION]=[o.ONE,o.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.HUE]=[o.ONE,o.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.SATURATION]=[o.ONE,o.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.COLOR]=[o.ONE,o.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.LUMINOSITY]=[o.ONE,o.ONE_MINUS_SRC_ALPHA]),this.projection=new n.Point,this.projection.x=this.width/2,this.projection.y=-this.height/2,this.offset=new n.Point(0,0),this.resize(this.width,this.height),this.contextLost=!1,this.shaderManager=new n.WebGLShaderManager(o),this.spriteBatch=new n.WebGLSpriteBatch(o),this.maskManager=new n.WebGLMaskManager(o),this.filterManager=new n.WebGLFilterManager(o,this.transparent),this.stencilManager=new n.WebGLStencilManager(o),this.blendModeManager=new n.WebGLBlendModeManager(o),this.renderSession={},this.renderSession.gl=this.gl,this.renderSession.drawCount=0,this.renderSession.shaderManager=this.shaderManager,this.renderSession.maskManager=this.maskManager,this.renderSession.filterManager=this.filterManager,this.renderSession.blendModeManager=this.blendModeManager,this.renderSession.spriteBatch=this.spriteBatch,this.renderSession.stencilManager=this.stencilManager,this.renderSession.renderer=this,o.useProgram(this.shaderManager.defaultShader.program),o.disable(o.DEPTH_TEST),o.disable(o.CULL_FACE),o.enable(o.BLEND),o.colorMask(!0,!0,!0,this.transparent)},n.WebGLRenderer.prototype.constructor=n.WebGLRenderer,n.WebGLRenderer.prototype.render=function(t){if(!this.contextLost){this.__stage!==t&&(t.interactive&&t.interactionManager.removeEvents(),this.__stage=t),n.WebGLRenderer.updateTextures(),t.updateTransform(),t._interactive&&(t._interactiveEventsAdded||(t._interactiveEventsAdded=!0,t.interactionManager.setTarget(this)));var i=this.gl;i.viewport(0,0,this.width,this.height),i.bindFramebuffer(i.FRAMEBUFFER,null),this.transparent?i.clearColor(0,0,0,0):i.clearColor(t.backgroundColorSplit[0],t.backgroundColorSplit[1],t.backgroundColorSplit[2],1),i.clear(i.COLOR_BUFFER_BIT),this.renderDisplayObject(t,this.projection),t.interactive?t._interactiveEventsAdded||(t._interactiveEventsAdded=!0,t.interactionManager.setTarget(this)):t._interactiveEventsAdded&&(t._interactiveEventsAdded=!1,t.interactionManager.setTarget(this))}},n.WebGLRenderer.prototype.renderDisplayObject=function(t,i,r){this.renderSession.blendModeManager.setBlendMode(n.blendModes.NORMAL),this.renderSession.drawCount=0,this.renderSession.currentBlendMode=9999,this.renderSession.projection=i,this.renderSession.offset=this.offset,this.spriteBatch.begin(this.renderSession),this.filterManager.begin(this.renderSession,r),t._renderWebGL(this.renderSession),this.spriteBatch.end()},n.WebGLRenderer.updateTextures=function(){for(var t=0,t=0;t<n.Texture.frameUpdates.length;t++)n.WebGLRenderer.updateTextureFrame(n.Texture.frameUpdates[t]);for(t=0;t<n.texturesToDestroy.length;t++)n.WebGLRenderer.destroyTexture(n.texturesToDestroy[t]);n.texturesToUpdate.length=0,n.texturesToDestroy.length=0,n.Texture.frameUpdates.length=0},n.WebGLRenderer.destroyTexture=function(t){for(var r,u,i=t._glTextures.length-1;i>=0;i--)r=t._glTextures[i],u=n.glContexts[i],u&&r&&u.deleteTexture(r);t._glTextures.length=0},n.WebGLRenderer.updateTextureFrame=function(n){n._updateWebGLuvs()},n.WebGLRenderer.prototype.resize=function(n,t){this.width=n,this.height=t,this.view.width=n,this.view.height=t,this.gl.viewport(0,0,this.width,this.height),this.projection.x=this.width/2,this.projection.y=-this.height/2},n.createWebGLTexture=function(t,i){return t.hasLoaded&&(t._glTextures[i.id]=i.createTexture(),i.bindTexture(i.TEXTURE_2D,t._glTextures[i.id]),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultipliedAlpha),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t.source),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,t.scaleMode===n.scaleModes.LINEAR?i.LINEAR:i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,t.scaleMode===n.scaleModes.LINEAR?i.LINEAR:i.NEAREST),t._powerOf2?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.REPEAT)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE)),i.bindTexture(i.TEXTURE_2D,null),t._dirty[i.id]=!1),t._glTextures[i.id]},n.updateWebGLTexture=function(t,i){t._glTextures[i.id]&&(i.bindTexture(i.TEXTURE_2D,t._glTextures[i.id]),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultipliedAlpha),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t.source),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,t.scaleMode===n.scaleModes.LINEAR?i.LINEAR:i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,t.scaleMode===n.scaleModes.LINEAR?i.LINEAR:i.NEAREST),t._powerOf2?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.REPEAT)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE)),t._dirty[i.id]=!1)},n.WebGLRenderer.prototype.handleContextLost=function(n){n.preventDefault(),this.contextLost=!0},n.WebGLRenderer.prototype.handleContextRestored=function(){var t,i,r;try{this.gl=this.view.getContext("experimental-webgl",this.options)}catch(u){try{this.gl=this.view.getContext("webgl",this.options)}catch(f){throw new Error(" This browser does not support webGL. Try using the canvas renderer"+this);}}t=this.gl,t.id=n.WebGLRenderer.glContextId++,this.shaderManager.setContext(t),this.spriteBatch.setContext(t),this.primitiveBatch.setContext(t),this.maskManager.setContext(t),this.filterManager.setContext(t),this.renderSession.gl=this.gl,t.disable(t.DEPTH_TEST),t.disable(t.CULL_FACE),t.enable(t.BLEND),t.colorMask(!0,!0,!0,this.transparent),this.gl.viewport(0,0,this.width,this.height);for(i in n.TextureCache)r=n.TextureCache[i].baseTexture,r._glTextures=[];this.contextLost=!1},n.WebGLRenderer.prototype.destroy=function(){this.view.removeEventListener("webglcontextlost",this.contextLost),this.view.removeEventListener("webglcontextrestored",this.contextRestoredLost),n.glContexts[this.glContextId]=null,this.projection=null,this.offset=null,this.shaderManager.destroy(),this.spriteBatch.destroy(),this.primitiveBatch.destroy(),this.maskManager.destroy(),this.filterManager.destroy(),this.shaderManager=null,this.spriteBatch=null,this.maskManager=null,this.filterManager=null,this.gl=null,this.renderSession=null},n.WebGLRenderer.glContextId=0,n.WebGLBlendModeManager=function(n){this.gl=n,this.currentBlendMode=99999},n.WebGLBlendModeManager.prototype.setBlendMode=function(t){if(this.currentBlendMode===t)return!1;this.currentBlendMode=t;var i=n.blendModesWebGL[this.currentBlendMode];return this.gl.blendFunc(i[0],i[1]),!0},n.WebGLBlendModeManager.prototype.destroy=function(){this.gl=null},n.WebGLMaskManager=function(n){this.maskStack=[],this.maskPosition=0,this.setContext(n),this.reverse=!1,this.count=0},n.WebGLMaskManager.prototype.setContext=function(n){this.gl=n},n.WebGLMaskManager.prototype.pushMask=function(t,i){var r=i.gl;t.dirty&&n.WebGLGraphics.updateGraphics(t,r),t._webGL[r.id].data.length&&i.stencilManager.pushStencil(t,t._webGL[r.id].data[0],i)},n.WebGLMaskManager.prototype.popMask=function(n,t){var i=this.gl;t.stencilManager.popStencil(n,n._webGL[i.id].data[0],t)},n.WebGLMaskManager.prototype.destroy=function(){this.maskStack=null,this.gl=null},n.WebGLStencilManager=function(n){this.stencilStack=[],this.setContext(n),this.reverse=!0,this.count=0},n.WebGLStencilManager.prototype.setContext=function(n){this.gl=n},n.WebGLStencilManager.prototype.pushStencil=function(n,t,i){var r=this.gl,u;this.bindGraphics(n,t,i),0===this.stencilStack.length&&(r.enable(r.STENCIL_TEST),r.clear(r.STENCIL_BUFFER_BIT),this.reverse=!0,this.count=0),this.stencilStack.push(t),u=this.count,r.colorMask(!1,!1,!1,!1),r.stencilFunc(r.ALWAYS,0,255),r.stencilOp(r.KEEP,r.KEEP,r.INVERT),1===t.mode?(r.drawElements(r.TRIANGLE_FAN,t.indices.length-4,r.UNSIGNED_SHORT,0),this.reverse?(r.stencilFunc(r.EQUAL,255-u,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)):(r.stencilFunc(r.EQUAL,u,255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,2*(t.indices.length-4)),this.reverse?r.stencilFunc(r.EQUAL,255-(u+1),255):r.stencilFunc(r.EQUAL,u+1,255),this.reverse=!this.reverse):(this.reverse?(r.stencilFunc(r.EQUAL,u,255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)):(r.stencilFunc(r.EQUAL,255-u,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)),r.drawElements(r.TRIANGLE_STRIP,t.indices.length,r.UNSIGNED_SHORT,0),this.reverse?r.stencilFunc(r.EQUAL,u+1,255):r.stencilFunc(r.EQUAL,255-(u+1),255)),r.colorMask(!0,!0,!0,!0),r.stencilOp(r.KEEP,r.KEEP,r.KEEP),this.count++},n.WebGLStencilManager.prototype.bindGraphics=function(t,i,r){this._currentGraphics=t;var f,u=this.gl,e=r.projection,o=r.offset;1===i.mode?(f=r.shaderManager.complexPrimativeShader,r.shaderManager.setShader(f),u.uniformMatrix3fv(f.translationMatrix,!1,t.worldTransform.toArray(!0)),u.uniform2f(f.projectionVector,e.x,-e.y),u.uniform2f(f.offsetVector,-o.x,-o.y),u.uniform3fv(f.tintColor,n.hex2rgb(t.tint)),u.uniform3fv(f.color,i.color),u.uniform1f(f.alpha,t.worldAlpha*i.alpha),u.bindBuffer(u.ARRAY_BUFFER,i.buffer),u.vertexAttribPointer(f.aVertexPosition,2,u.FLOAT,!1,8,0),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,i.indexBuffer)):(f=r.shaderManager.primitiveShader,r.shaderManager.setShader(f),u.uniformMatrix3fv(f.translationMatrix,!1,t.worldTransform.toArray(!0)),u.uniform2f(f.projectionVector,e.x,-e.y),u.uniform2f(f.offsetVector,-o.x,-o.y),u.uniform3fv(f.tintColor,n.hex2rgb(t.tint)),u.uniform1f(f.alpha,t.worldAlpha),u.bindBuffer(u.ARRAY_BUFFER,i.buffer),u.vertexAttribPointer(f.aVertexPosition,2,u.FLOAT,!1,24,0),u.vertexAttribPointer(f.colorAttribute,4,u.FLOAT,!1,24,8),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,i.indexBuffer))},n.WebGLStencilManager.prototype.popStencil=function(n,t,i){var r=this.gl,u;(this.stencilStack.pop(),this.count--,0===this.stencilStack.length)?r.disable(r.STENCIL_TEST):(u=this.count,this.bindGraphics(n,t,i),r.colorMask(!1,!1,!1,!1),1===t.mode?(this.reverse=!this.reverse,this.reverse?(r.stencilFunc(r.EQUAL,255-(u+1),255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)):(r.stencilFunc(r.EQUAL,u+1,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,2*(t.indices.length-4)),r.stencilFunc(r.ALWAYS,0,255),r.stencilOp(r.KEEP,r.KEEP,r.INVERT),r.drawElements(r.TRIANGLE_FAN,t.indices.length-4,r.UNSIGNED_SHORT,0),this.reverse?r.stencilFunc(r.EQUAL,u,255):r.stencilFunc(r.EQUAL,255-u,255)):(this.reverse?(r.stencilFunc(r.EQUAL,u+1,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)):(r.stencilFunc(r.EQUAL,255-(u+1),255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)),r.drawElements(r.TRIANGLE_STRIP,t.indices.length,r.UNSIGNED_SHORT,0),this.reverse?r.stencilFunc(r.EQUAL,u,255):r.stencilFunc(r.EQUAL,255-u,255)),r.colorMask(!0,!0,!0,!0),r.stencilOp(r.KEEP,r.KEEP,r.KEEP))},n.WebGLStencilManager.prototype.destroy=function(){this.maskStack=null,this.gl=null},n.WebGLShaderManager=function(n){this.maxAttibs=10,this.attribState=[],this.tempAttribState=[],this.shaderMap=[];for(var t=0;t<this.maxAttibs;t++)this.attribState[t]=!1;this.setContext(n)},n.WebGLShaderManager.prototype.setContext=function(t){this.gl=t,this.primitiveShader=new n.PrimitiveShader(t),this.complexPrimativeShader=new n.ComplexPrimitiveShader(t),this.defaultShader=new n.PixiShader(t),this.fastShader=new n.PixiFastShader(t),this.stripShader=new n.StripShader(t),this.setShader(this.defaultShader)},n.WebGLShaderManager.prototype.setAttribs=function(n){for(var r,i,t=0;t<this.tempAttribState.length;t++)this.tempAttribState[t]=!1;for(t=0;t<n.length;t++)r=n[t],this.tempAttribState[r]=!0;for(i=this.gl,t=0;t<this.attribState.length;t++)this.attribState[t]!==this.tempAttribState[t]&&(this.attribState[t]=this.tempAttribState[t],this.tempAttribState[t]?i.enableVertexAttribArray(t):i.disableVertexAttribArray(t))},n.WebGLShaderManager.prototype.setShader=function(n){return this._currentId===n._UID?!1:(this._currentId=n._UID,this.currentShader=n,this.gl.useProgram(n.program),this.setAttribs(n.attributes),!0)},n.WebGLShaderManager.prototype.destroy=function(){this.attribState=null,this.tempAttribState=null,this.primitiveShader.destroy(),this.defaultShader.destroy(),this.fastShader.destroy(),this.stripShader.destroy(),this.gl=null},n.WebGLSpriteBatch=function(n){var u,r,t,i;for(this.vertSize=6,this.size=2e3,u=4*this.size*this.vertSize,r=6*this.size,this.vertices=new Float32Array(u),this.indices=new Uint16Array(r),this.lastIndexCount=0,t=0,i=0;r>t;t+=6,i+=4)this.indices[t+0]=i+0,this.indices[t+1]=i+1,this.indices[t+2]=i+2,this.indices[t+3]=i+0,this.indices[t+4]=i+2,this.indices[t+5]=i+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.setContext(n),this.dirty=!0,this.textures=[],this.blendModes=[]},n.WebGLSpriteBatch.prototype.setContext=function(n){this.gl=n,this.vertexBuffer=n.createBuffer(),this.indexBuffer=n.createBuffer(),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,this.indices,n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer),n.bufferData(n.ARRAY_BUFFER,this.vertices,n.DYNAMIC_DRAW),this.currentBlendMode=99999},n.WebGLSpriteBatch.prototype.begin=function(n){this.renderSession=n,this.shader=this.renderSession.shaderManager.defaultShader,this.start()},n.WebGLSpriteBatch.prototype.end=function(){this.flush()},n.WebGLSpriteBatch.prototype.render=function(n){var r=n.texture,u,c;if(this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=r.baseTexture),u=r._uvs,u){var o,f,s,e,k=n.worldAlpha,b=n.tint,t=this.vertices,g=n.anchor.x,d=n.anchor.y;r.trim?(c=r.trim,f=c.x-g*c.width,o=f+r.crop.width,e=c.y-d*c.height,s=e+r.crop.height):(o=r.frame.width*(1-g),f=r.frame.width*-g,s=r.frame.height*(1-d),e=r.frame.height*-d);var i=4*this.currentBatchSize*this.vertSize,h=n.worldTransform,y=h.a,v=h.c,a=h.b,l=h.d,w=h.tx,p=h.ty;t[i++]=y*f+a*e+w,t[i++]=l*e+v*f+p,t[i++]=u.x0,t[i++]=u.y0,t[i++]=k,t[i++]=b,t[i++]=y*o+a*e+w,t[i++]=l*e+v*o+p,t[i++]=u.x1,t[i++]=u.y1,t[i++]=k,t[i++]=b,t[i++]=y*o+a*s+w,t[i++]=l*s+v*o+p,t[i++]=u.x2,t[i++]=u.y2,t[i++]=k,t[i++]=b,t[i++]=y*f+a*s+w,t[i++]=l*s+v*f+p,t[i++]=u.x3,t[i++]=u.y3,t[i++]=k,t[i++]=b,this.textures[this.currentBatchSize]=n.texture.baseTexture,this.blendModes[this.currentBatchSize]=n.blendMode,this.currentBatchSize++}},n.WebGLSpriteBatch.prototype.renderTilingSprite=function(t){var f=t.tilingTexture,u;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=f.baseTexture),t._uvs||(t._uvs=new n.TextureUvs),u=t._uvs,t.tilePosition.x%=f.baseTexture.width*t.tileScaleOffset.x,t.tilePosition.y%=f.baseTexture.height*t.tileScaleOffset.y;var g=t.tilePosition.x/(f.baseTexture.width*t.tileScaleOffset.x),d=t.tilePosition.y/(f.baseTexture.height*t.tileScaleOffset.y),rt=t.width/f.baseTexture.width/(t.tileScale.x*t.tileScaleOffset.x),it=t.height/f.baseTexture.height/(t.tileScale.y*t.tileScaleOffset.y);u.x0=0-g,u.y0=0-d,u.x1=1*rt-g,u.y1=0-d,u.x2=1*rt-g,u.y2=1*it-d,u.x3=0-g,u.y3=1*it-d;var k=t.worldAlpha,b=t.tint,r=this.vertices,tt=t.width,nt=t.height,ft=t.anchor.x,ut=t.anchor.y,y=tt*(1-ft),v=tt*-ft,a=nt*(1-ut),l=nt*-ut,i=4*this.currentBatchSize*this.vertSize,e=t.worldTransform,c=e.a,h=e.c,s=e.b,o=e.d,w=e.tx,p=e.ty;r[i++]=c*v+s*l+w,r[i++]=o*l+h*v+p,r[i++]=u.x0,r[i++]=u.y0,r[i++]=k,r[i++]=b,r[i++]=c*y+s*l+w,r[i++]=o*l+h*y+p,r[i++]=u.x1,r[i++]=u.y1,r[i++]=k,r[i++]=b,r[i++]=c*y+s*a+w,r[i++]=o*a+h*y+p,r[i++]=u.x2,r[i++]=u.y2,r[i++]=k,r[i++]=b,r[i++]=c*v+s*a+w,r[i++]=o*a+h*v+p,r[i++]=u.x3,r[i++]=u.y3,r[i++]=k,r[i++]=b,this.textures[this.currentBatchSize]=f.baseTexture,this.blendModes[this.currentBatchSize]=t.blendMode,this.currentBatchSize++},n.WebGLSpriteBatch.prototype.flush=function(){var n,f,i,c;if(0!==this.currentBatchSize){n=this.gl,(this.renderSession.shaderManager.setShader(this.renderSession.shaderManager.defaultShader),this.dirty)&&(this.dirty=!1,n.activeTexture(n.TEXTURE0),n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer),f=this.renderSession.projection,n.uniform2f(this.shader.projectionVector,f.x,f.y),i=4*this.vertSize,n.vertexAttribPointer(this.shader.aVertexPosition,2,n.FLOAT,!1,i,0),n.vertexAttribPointer(this.shader.aTextureCoord,2,n.FLOAT,!1,i,8),n.vertexAttribPointer(this.shader.colorAttribute,2,n.FLOAT,!1,i,16)),this.currentBatchSize>.5*this.size?n.bufferSubData(n.ARRAY_BUFFER,0,this.vertices):(c=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize),n.bufferSubData(n.ARRAY_BUFFER,0,c));for(var e,o,r=0,s=0,u=null,h=this.renderSession.blendModeManager.currentBlendMode,t=0,l=this.currentBatchSize;l>t;t++)e=this.textures[t],o=this.blendModes[t],(u!==e||h!==o)&&(this.renderBatch(u,r,s),s=t,r=0,u=e,h=o,this.renderSession.blendModeManager.setBlendMode(h)),r++;this.renderBatch(u,r,s),this.currentBatchSize=0}},n.WebGLSpriteBatch.prototype.renderBatch=function(t,i,r){if(0!==i){var u=this.gl;u.bindTexture(u.TEXTURE_2D,t._glTextures[u.id]||n.createWebGLTexture(t,u)),t._dirty[u.id]&&n.updateWebGLTexture(this.currentBaseTexture,u),u.drawElements(u.TRIANGLES,6*i,u.UNSIGNED_SHORT,12*r),this.renderSession.drawCount++}},n.WebGLSpriteBatch.prototype.stop=function(){this.flush()},n.WebGLSpriteBatch.prototype.start=function(){this.dirty=!0},n.WebGLSpriteBatch.prototype.destroy=function(){this.vertices=null,this.indices=null,this.gl.deleteBuffer(this.vertexBuffer),this.gl.deleteBuffer(this.indexBuffer),this.currentBaseTexture=null,this.gl=null},n.WebGLFastSpriteBatch=function(n){var u,r,t,i;for(this.vertSize=10,this.maxSize=6e3,this.size=this.maxSize,u=4*this.size*this.vertSize,r=6*this.maxSize,this.vertices=new Float32Array(u),this.indices=new Uint16Array(r),this.vertexBuffer=null,this.indexBuffer=null,this.lastIndexCount=0,t=0,i=0;r>t;t+=6,i+=4)this.indices[t+0]=i+0,this.indices[t+1]=i+1,this.indices[t+2]=i+2,this.indices[t+3]=i+0,this.indices[t+4]=i+2,this.indices[t+5]=i+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.currentBlendMode=0,this.renderSession=null,this.shader=null,this.matrix=null,this.setContext(n)},n.WebGLFastSpriteBatch.prototype.setContext=function(n){this.gl=n,this.vertexBuffer=n.createBuffer(),this.indexBuffer=n.createBuffer(),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,this.indices,n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer),n.bufferData(n.ARRAY_BUFFER,this.vertices,n.DYNAMIC_DRAW)},n.WebGLFastSpriteBatch.prototype.begin=function(n,t){this.renderSession=t,this.shader=this.renderSession.shaderManager.fastShader,this.matrix=n.worldTransform.toArray(!0),this.start()},n.WebGLFastSpriteBatch.prototype.end=function(){this.flush()},n.WebGLFastSpriteBatch.prototype.render=function(n){var r=n.children,t=r[0],i,u;if(t.texture._uvs){for(this.currentBaseTexture=t.texture.baseTexture,t.blendMode!==this.renderSession.blendModeManager.currentBlendMode&&(this.flush(),this.renderSession.blendModeManager.setBlendMode(t.blendMode)),i=0,u=r.length;u>i;i++)this.renderSprite(r[i]);this.flush()}},n.WebGLFastSpriteBatch.prototype.renderSprite=function(n){var r,h,c,o,u,s,f,t,i,e;n.visible&&(n.texture.baseTexture===this.currentBaseTexture||(this.flush(),this.currentBaseTexture=n.texture.baseTexture,n.texture._uvs))&&(i=this.vertices,(r=n.texture._uvs,h=n.texture.frame.width,c=n.texture.frame.height,n.texture.trim)?(e=n.texture.trim,u=e.x-n.anchor.x*e.width,o=u+n.texture.crop.width,f=e.y-n.anchor.y*e.height,s=f+n.texture.crop.height):(o=n.texture.frame.width*(1-n.anchor.x),u=n.texture.frame.width*-n.anchor.x,s=n.texture.frame.height*(1-n.anchor.y),f=n.texture.frame.height*-n.anchor.y),t=4*this.currentBatchSize*this.vertSize,i[t++]=u,i[t++]=f,i[t++]=n.position.x,i[t++]=n.position.y,i[t++]=n.scale.x,i[t++]=n.scale.y,i[t++]=n.rotation,i[t++]=r.x0,i[t++]=r.y1,i[t++]=n.alpha,i[t++]=o,i[t++]=f,i[t++]=n.position.x,i[t++]=n.position.y,i[t++]=n.scale.x,i[t++]=n.scale.y,i[t++]=n.rotation,i[t++]=r.x1,i[t++]=r.y1,i[t++]=n.alpha,i[t++]=o,i[t++]=s,i[t++]=n.position.x,i[t++]=n.position.y,i[t++]=n.scale.x,i[t++]=n.scale.y,i[t++]=n.rotation,i[t++]=r.x2,i[t++]=r.y2,i[t++]=n.alpha,i[t++]=u,i[t++]=s,i[t++]=n.position.x,i[t++]=n.position.y,i[t++]=n.scale.x,i[t++]=n.scale.y,i[t++]=n.rotation,i[t++]=r.x3,i[t++]=r.y3,i[t++]=n.alpha,this.currentBatchSize++,this.currentBatchSize>=this.size&&this.flush())},n.WebGLFastSpriteBatch.prototype.flush=function(){var t,i;0!==this.currentBatchSize&&(t=this.gl,(this.currentBaseTexture._glTextures[t.id]||n.createWebGLTexture(this.currentBaseTexture,t),t.bindTexture(t.TEXTURE_2D,this.currentBaseTexture._glTextures[t.id]),this.currentBatchSize>.5*this.size)?t.bufferSubData(t.ARRAY_BUFFER,0,this.vertices):(i=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize),t.bufferSubData(t.ARRAY_BUFFER,0,i)),t.drawElements(t.TRIANGLES,6*this.currentBatchSize,t.UNSIGNED_SHORT,0),this.currentBatchSize=0,this.renderSession.drawCount++)},n.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()},n.WebGLFastSpriteBatch.prototype.start=function(){var n=this.gl,i,t;n.activeTexture(n.TEXTURE0),n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer),i=this.renderSession.projection,n.uniform2f(this.shader.projectionVector,i.x,i.y),n.uniformMatrix3fv(this.shader.uMatrix,!1,this.matrix),t=4*this.vertSize,n.vertexAttribPointer(this.shader.aVertexPosition,2,n.FLOAT,!1,t,0),n.vertexAttribPointer(this.shader.aPositionCoord,2,n.FLOAT,!1,t,8),n.vertexAttribPointer(this.shader.aScale,2,n.FLOAT,!1,t,16),n.vertexAttribPointer(this.shader.aRotation,1,n.FLOAT,!1,t,24),n.vertexAttribPointer(this.shader.aTextureCoord,2,n.FLOAT,!1,t,28),n.vertexAttribPointer(this.shader.colorAttribute,1,n.FLOAT,!1,t,36)},n.WebGLFilterManager=function(n,t){this.transparent=t,this.filterStack=[],this.offsetX=0,this.offsetY=0,this.setContext(n)},n.WebGLFilterManager.prototype.setContext=function(n){this.gl=n,this.texturePool=[],this.initShaderBuffers()},n.WebGLFilterManager.prototype.begin=function(n,t){this.renderSession=n,this.defaultShader=n.shaderManager.defaultShader;var i=this.renderSession.projection;this.width=2*i.x,this.height=2*-i.y,this.buffer=t},n.WebGLFilterManager.prototype.pushFilter=function(t){var r=this.gl,e=this.renderSession.projection,o=this.renderSession.offset,s,u,i,f;t._filterArea=t.target.filterArea||t.target.getBounds(),this.filterStack.push(t),s=t.filterPasses[0],this.offsetX+=t._filterArea.x,this.offsetY+=t._filterArea.y,u=this.texturePool.pop(),u?u.resize(this.width,this.height):u=new n.FilterTexture(this.gl,this.width,this.height),r.bindTexture(r.TEXTURE_2D,u.texture),i=t._filterArea,f=s.padding,i.x-=f,i.y-=f,i.width+=2*f,i.height+=2*f,i.x<0&&(i.x=0),i.width>this.width&&(i.width=this.width),i.y<0&&(i.y=0),i.height>this.height&&(i.height=this.height),r.bindFramebuffer(r.FRAMEBUFFER,u.frameBuffer),r.viewport(0,0,i.width,i.height),e.x=i.width/2,e.y=-i.height/2,o.x=-i.x,o.y=-i.y,this.renderSession.shaderManager.setShader(this.defaultShader),r.uniform2f(this.defaultShader.projectionVector,i.width/2,-i.height/2),r.uniform2f(this.defaultShader.offsetVector,-i.x,-i.y),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),t._glFilterTexture=u},n.WebGLFilterManager.prototype.popFilter=function(){var t=this.gl,r=this.filterStack.pop(),i=r._filterArea,l=r._glFilterTexture,k=this.renderSession.projection,p=this.renderSession.offset,h,u,c,g,w,b,y,o,s;if(r.filterPasses.length>1){for(t.viewport(0,0,i.width,i.height),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=0,this.vertexArray[1]=i.height,this.vertexArray[2]=i.width,this.vertexArray[3]=i.height,this.vertexArray[4]=0,this.vertexArray[5]=0,this.vertexArray[6]=i.width,this.vertexArray[7]=0,t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=i.width/this.width,this.uvArray[5]=i.height/this.height,this.uvArray[6]=i.width/this.width,this.uvArray[7]=i.height/this.height,t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray),h=l,u=this.texturePool.pop(),u||(u=new n.FilterTexture(this.gl,this.width,this.height)),u.resize(this.width,this.height),t.bindFramebuffer(t.FRAMEBUFFER,u.frameBuffer),t.clear(t.COLOR_BUFFER_BIT),t.disable(t.BLEND),c=0;c<r.filterPasses.length-1;c++)g=r.filterPasses[c],t.bindFramebuffer(t.FRAMEBUFFER,u.frameBuffer),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,h.texture),this.applyFilterPass(g,i,i.width,i.height),w=h,h=u,u=w;t.enable(t.BLEND),l=h,this.texturePool.push(u)}b=r.filterPasses[r.filterPasses.length-1],this.offsetX-=i.x,this.offsetY-=i.y;var e=this.width,f=this.height,a=0,v=0,d=this.buffer;0===this.filterStack.length?t.colorMask(!0,!0,!0,!0):(y=this.filterStack[this.filterStack.length-1],i=y._filterArea,e=i.width,f=i.height,a=i.x,v=i.y,d=y._glFilterTexture.frameBuffer),k.x=e/2,k.y=-f/2,p.x=a,p.y=v,i=r._filterArea,o=i.x-a,s=i.y-v,t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=o,this.vertexArray[1]=s+i.height,this.vertexArray[2]=o+i.width,this.vertexArray[3]=s+i.height,this.vertexArray[4]=o,this.vertexArray[5]=s,this.vertexArray[6]=o+i.width,this.vertexArray[7]=s,t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=i.width/this.width,this.uvArray[5]=i.height/this.height,this.uvArray[6]=i.width/this.width,this.uvArray[7]=i.height/this.height,t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray),t.viewport(0,0,e,f),t.bindFramebuffer(t.FRAMEBUFFER,d),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,l.texture),this.applyFilterPass(b,i,e,f),this.renderSession.shaderManager.setShader(this.defaultShader),t.uniform2f(this.defaultShader.projectionVector,e/2,-f/2),t.uniform2f(this.defaultShader.offsetVector,-a,-v),this.texturePool.push(l),r._glFilterTexture=null},n.WebGLFilterManager.prototype.applyFilterPass=function(t,i,r,u){var f=this.gl,e=t.shaders[f.id];e||(e=new n.PixiShader(f),e.fragmentSrc=t.fragmentSrc,e.uniforms=t.uniforms,e.init(),t.shaders[f.id]=e),this.renderSession.shaderManager.setShader(e),f.uniform2f(e.projectionVector,r/2,-u/2),f.uniform2f(e.offsetVector,0,0),t.uniforms.dimensions&&(t.uniforms.dimensions.value[0]=this.width,t.uniforms.dimensions.value[1]=this.height,t.uniforms.dimensions.value[2]=this.vertexArray[0],t.uniforms.dimensions.value[3]=this.vertexArray[5]),e.syncUniforms(),f.bindBuffer(f.ARRAY_BUFFER,this.vertexBuffer),f.vertexAttribPointer(e.aVertexPosition,2,f.FLOAT,!1,0,0),f.bindBuffer(f.ARRAY_BUFFER,this.uvBuffer),f.vertexAttribPointer(e.aTextureCoord,2,f.FLOAT,!1,0,0),f.bindBuffer(f.ARRAY_BUFFER,this.colorBuffer),f.vertexAttribPointer(e.colorAttribute,2,f.FLOAT,!1,0,0),f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,this.indexBuffer),f.drawElements(f.TRIANGLES,6,f.UNSIGNED_SHORT,0),this.renderSession.drawCount++},n.WebGLFilterManager.prototype.initShaderBuffers=function(){var n=this.gl;this.vertexBuffer=n.createBuffer(),this.uvBuffer=n.createBuffer(),this.colorBuffer=n.createBuffer(),this.indexBuffer=n.createBuffer(),this.vertexArray=new Float32Array([0,0,1,0,0,1,1,1]),n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer),n.bufferData(n.ARRAY_BUFFER,this.vertexArray,n.STATIC_DRAW),this.uvArray=new Float32Array([0,0,1,0,0,1,1,1]),n.bindBuffer(n.ARRAY_BUFFER,this.uvBuffer),n.bufferData(n.ARRAY_BUFFER,this.uvArray,n.STATIC_DRAW),this.colorArray=new Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]),n.bindBuffer(n.ARRAY_BUFFER,this.colorBuffer),n.bufferData(n.ARRAY_BUFFER,this.colorArray,n.STATIC_DRAW),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),n.STATIC_DRAW)},n.WebGLFilterManager.prototype.destroy=function(){var n=this.gl,t;for(this.filterStack=null,this.offsetX=0,this.offsetY=0,t=0;t<this.texturePool.length;t++)this.texturePool[t].destroy();this.texturePool=null,n.deleteBuffer(this.vertexBuffer),n.deleteBuffer(this.uvBuffer),n.deleteBuffer(this.colorBuffer),n.deleteBuffer(this.indexBuffer)},n.FilterTexture=function(t,i,r,u){this.gl=t,this.frameBuffer=t.createFramebuffer(),this.texture=t.createTexture(),u=u||n.scaleModes.DEFAULT,t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,u===n.scaleModes.LINEAR?t.LINEAR:t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,u===n.scaleModes.LINEAR?t.LINEAR:t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer),t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture,0),this.renderBuffer=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this.renderBuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.renderBuffer),this.resize(i,r)},n.FilterTexture.prototype.clear=function(){var n=this.gl;n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT)},n.FilterTexture.prototype.resize=function(n,t){if(this.width!==n||this.height!==t){this.width=n,this.height=t;var i=this.gl;i.bindTexture(i.TEXTURE_2D,this.texture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,n,t,0,i.RGBA,i.UNSIGNED_BYTE,null),i.bindRenderbuffer(i.RENDERBUFFER,this.renderBuffer),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,n,t)}},n.FilterTexture.prototype.destroy=function(){var n=this.gl;n.deleteFramebuffer(this.frameBuffer),n.deleteTexture(this.texture),this.frameBuffer=null,this.texture=null},n.CanvasMaskManager=function(){},n.CanvasMaskManager.prototype.pushMask=function(t,i){i.save();var u=t.alpha,r=t.worldTransform;i.setTransform(r.a,r.c,r.b,r.d,r.tx,r.ty),n.CanvasGraphics.renderGraphicsMask(t,i),i.clip(),t.worldAlpha=u},n.CanvasMaskManager.prototype.popMask=function(n){n.restore()},n.CanvasTinter=function(){},n.CanvasTinter.getTintedTexture=function(t,i){var r=t.texture,u,f,e;return(i=n.CanvasTinter.roundColor(i),u="#"+("00000"+(0|i).toString(16)).substr(-6),r.tintCache=r.tintCache||{},r.tintCache[u])?r.tintCache[u]:(f=n.CanvasTinter.canvas||document.createElement("canvas"),(n.CanvasTinter.tintMethod(r,i,f),n.CanvasTinter.convertTintToImage)?(e=new Image,e.src=f.toDataURL(),r.tintCache[u]=e):(r.tintCache[u]=f,n.CanvasTinter.canvas=null),f)},n.CanvasTinter.tintWithMultiply=function(n,t,i){var u=i.getContext("2d"),r=n.frame;i.width=r.width,i.height=r.height,u.fillStyle="#"+("00000"+(0|t).toString(16)).substr(-6),u.fillRect(0,0,r.width,r.height),u.globalCompositeOperation="multiply",u.drawImage(n.baseTexture.source,r.x,r.y,r.width,r.height,0,0,r.width,r.height),u.globalCompositeOperation="destination-atop",u.drawImage(n.baseTexture.source,r.x,r.y,r.width,r.height,0,0,r.width,r.height)},n.CanvasTinter.tintWithOverlay=function(n,t,i){var u=i.getContext("2d"),r=n.frame;i.width=r.width,i.height=r.height,u.globalCompositeOperation="copy",u.fillStyle="#"+("00000"+(0|t).toString(16)).substr(-6),u.fillRect(0,0,r.width,r.height),u.globalCompositeOperation="destination-atop",u.drawImage(n.baseTexture.source,r.x,r.y,r.width,r.height,0,0,r.width,r.height)},n.CanvasTinter.tintWithPerPixel=function(t,i,r){var e=r.getContext("2d"),u=t.frame;r.width=u.width,r.height=u.height,e.globalCompositeOperation="copy",e.drawImage(t.baseTexture.source,u.x,u.y,u.width,u.height,0,0,u.width,u.height);for(var s=n.hex2rgb(i),c=s[0],l=s[1],a=s[2],h=e.getImageData(0,0,u.width,u.height),o=h.data,f=0;f<o.length;f+=4)o[f+0]*=c,o[f+1]*=l,o[f+2]*=a;e.putImageData(h,0,0)},n.CanvasTinter.roundColor=function(t){var r=n.CanvasTinter.cacheStepsPerColorChannel,i=n.hex2rgb(t);return i[0]=Math.min(255,i[0]/r*r),i[1]=Math.min(255,i[1]/r*r),i[2]=Math.min(255,i[2]/r*r),n.rgb2hex(i)},n.CanvasTinter.cacheStepsPerColorChannel=8,n.CanvasTinter.convertTintToImage=!1,n.CanvasTinter.canUseMultiply=n.canUseNewCanvasBlendModes(),n.CanvasTinter.tintMethod=n.CanvasTinter.canUseMultiply?n.CanvasTinter.tintWithMultiply:n.CanvasTinter.tintWithPerPixel,n.CanvasRenderer=function(t,i,r,u){n.defaultRenderer||(n.sayHello("Canvas"),n.defaultRenderer=this),this.type=n.CANVAS_RENDERER,this.clearBeforeRender=!0,this.transparent=!!u,n.blendModesCanvas||(n.blendModesCanvas=[],n.canUseNewCanvasBlendModes()?(n.blendModesCanvas[n.blendModes.NORMAL]="source-over",n.blendModesCanvas[n.blendModes.ADD]="lighter",n.blendModesCanvas[n.blendModes.MULTIPLY]="multiply",n.blendModesCanvas[n.blendModes.SCREEN]="screen",n.blendModesCanvas[n.blendModes.OVERLAY]="overlay",n.blendModesCanvas[n.blendModes.DARKEN]="darken",n.blendModesCanvas[n.blendModes.LIGHTEN]="lighten",n.blendModesCanvas[n.blendModes.COLOR_DODGE]="color-dodge",n.blendModesCanvas[n.blendModes.COLOR_BURN]="color-burn",n.blendModesCanvas[n.blendModes.HARD_LIGHT]="hard-light",n.blendModesCanvas[n.blendModes.SOFT_LIGHT]="soft-light",n.blendModesCanvas[n.blendModes.DIFFERENCE]="difference",n.blendModesCanvas[n.blendModes.EXCLUSION]="exclusion",n.blendModesCanvas[n.blendModes.HUE]="hue",n.blendModesCanvas[n.blendModes.SATURATION]="saturation",n.blendModesCanvas[n.blendModes.COLOR]="color",n.blendModesCanvas[n.blendModes.LUMINOSITY]="luminosity"):(n.blendModesCanvas[n.blendModes.NORMAL]="source-over",n.blendModesCanvas[n.blendModes.ADD]="lighter",n.blendModesCanvas[n.blendModes.MULTIPLY]="source-over",n.blendModesCanvas[n.blendModes.SCREEN]="source-over",n.blendModesCanvas[n.blendModes.OVERLAY]="source-over",n.blendModesCanvas[n.blendModes.DARKEN]="source-over",n.blendModesCanvas[n.blendModes.LIGHTEN]="source-over",n.blendModesCanvas[n.blendModes.COLOR_DODGE]="source-over",n.blendModesCanvas[n.blendModes.COLOR_BURN]="source-over",n.blendModesCanvas[n.blendModes.HARD_LIGHT]="source-over",n.blendModesCanvas[n.blendModes.SOFT_LIGHT]="source-over",n.blendModesCanvas[n.blendModes.DIFFERENCE]="source-over",n.blendModesCanvas[n.blendModes.EXCLUSION]="source-over",n.blendModesCanvas[n.blendModes.HUE]="source-over",n.blendModesCanvas[n.blendModes.SATURATION]="source-over",n.blendModesCanvas[n.blendModes.COLOR]="source-over",n.blendModesCanvas[n.blendModes.LUMINOSITY]="source-over")),this.width=t||800,this.height=i||600,this.view=r||document.createElement("canvas"),this.context=this.view.getContext("2d",{alpha:this.transparent}),this.refresh=!0,this.view.width=this.width,this.view.height=this.height,this.count=0,this.maskManager=new n.CanvasMaskManager,this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:null,roundPixels:!1},"imageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="imageSmoothingEnabled":"webkitImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="webkitImageSmoothingEnabled":"mozImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="mozImageSmoothingEnabled":"oImageSmoothingEnabled"in this.context&&(this.renderSession.smoothProperty="oImageSmoothingEnabled")},n.CanvasRenderer.prototype.constructor=n.CanvasRenderer,n.CanvasRenderer.prototype.render=function(t){n.texturesToUpdate.length=0,n.texturesToDestroy.length=0,t.updateTransform(),this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1,navigator.isCocoonJS&&this.view.screencanvas&&(this.context.fillStyle="black",this.context.clear()),!this.transparent&&this.clearBeforeRender?(this.context.fillStyle=t.backgroundColorString,this.context.fillRect(0,0,this.width,this.height)):this.transparent&&this.clearBeforeRender&&this.context.clearRect(0,0,this.width,this.height),this.renderDisplayObject(t),t.interactive&&(t._interactiveEventsAdded||(t._interactiveEventsAdded=!0,t.interactionManager.setTarget(this))),n.Texture.frameUpdates.length>0&&(n.Texture.frameUpdates.length=0)},n.CanvasRenderer.prototype.resize=function(n,t){this.width=n,this.height=t,this.view.width=n,this.view.height=t},n.CanvasRenderer.prototype.renderDisplayObject=function(n,t){this.renderSession.context=t||this.context,n._renderCanvas(this.renderSession)},n.CanvasRenderer.prototype.renderStripFlat=function(n){var t=this.context,i=n.verticies,f=i.length/2,u;for(this.count++,t.beginPath(),u=1;f-2>u;u++){var r=2*u,e=i[r],o=i[r+2],s=i[r+4],h=i[r+1],c=i[r+3],l=i[r+5];t.moveTo(e,h),t.lineTo(o,c),t.lineTo(s,l)}t.fillStyle="#FF0000",t.fill(),t.closePath()},n.CanvasRenderer.prototype.renderStrip=function(n){var i=this.context,y=n.verticies,w=n.uvs,g=y.length/2,k;for(this.count++,k=1;g-2>k;k++){var t=2*k,v=y[t],a=y[t+2],l=y[t+4],p=y[t+1],h=y[t+3],c=y[t+5],s=w[t]*n.texture.width,o=w[t+2]*n.texture.width,e=w[t+4]*n.texture.width,f=w[t+1]*n.texture.height,u=w[t+3]*n.texture.height,r=w[t+5]*n.texture.height;i.save(),i.beginPath(),i.moveTo(v,p),i.lineTo(a,h),i.lineTo(l,c),i.closePath(),i.clip();var b=s*u+f*e+o*r-u*e-f*o-s*r,nt=v*u+f*l+a*r-u*l-f*a-v*r,tt=s*a+v*e+o*l-a*e-v*o-s*l,it=s*u*l+f*a*e+v*o*r-v*u*e-f*o*l-s*a*r,rt=p*u+f*c+h*r-u*c-f*h-p*r,d=s*h+p*e+o*c-h*e-p*o-s*c,ut=s*u*c+f*h*e+p*o*r-p*u*e-f*o*c-s*h*r;i.transform(nt/b,rt/b,tt/b,d/b,it/b,ut/b),i.drawImage(n.texture.baseTexture.source,0,0),i.restore()}},n.CanvasBuffer=function(n,t){this.width=n,this.height=t,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=n,this.canvas.height=t},n.CanvasBuffer.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},n.CanvasBuffer.prototype.resize=function(n,t){this.width=this.canvas.width=n,this.height=this.canvas.height=t},n.CanvasGraphics=function(){},n.CanvasGraphics.renderGraphics=function(t,i){for(var r,u,w,s=t.worldAlpha,a="",rt=0;rt<t.graphicsData.length;rt++)if(r=t.graphicsData[rt],u=r.points,i.strokeStyle=a="#"+("00000"+(0|r.lineColor).toString(16)).substr(-6),i.lineWidth=r.lineWidth,r.type===n.Graphics.POLY){for(i.beginPath(),i.moveTo(u[0],u[1]),w=1;w<u.length/2;w++)i.lineTo(u[2*w],u[2*w+1]);u[0]===u[u.length-2]&&u[1]===u[u.length-1]&&i.closePath(),r.fill&&(i.globalAlpha=r.fillAlpha*s,i.fillStyle=a="#"+("00000"+(0|r.fillColor).toString(16)).substr(-6),i.fill()),r.lineWidth&&(i.globalAlpha=r.lineAlpha*s,i.stroke())}else if(r.type===n.Graphics.RECT)(r.fillColor||0===r.fillColor)&&(i.globalAlpha=r.fillAlpha*s,i.fillStyle=a="#"+("00000"+(0|r.fillColor).toString(16)).substr(-6),i.fillRect(u[0],u[1],u[2],u[3])),r.lineWidth&&(i.globalAlpha=r.lineAlpha*s,i.strokeRect(u[0],u[1],u[2],u[3]));else if(r.type===n.Graphics.CIRC)i.beginPath(),i.arc(u[0],u[1],u[2],0,2*Math.PI),i.closePath(),r.fill&&(i.globalAlpha=r.fillAlpha*s,i.fillStyle=a="#"+("00000"+(0|r.fillColor).toString(16)).substr(-6),i.fill()),r.lineWidth&&(i.globalAlpha=r.lineAlpha*s,i.stroke());else if(r.type===n.Graphics.ELIP){var g=r.points,d=2*g[2],k=2*g[3],v=g[0]-d/2,p=g[1]-k/2;i.beginPath();var ut=.5522848,nt=d/2*ut,b=k/2*ut,tt=v+d,it=p+k,y=v+d/2,l=p+k/2;i.moveTo(v,l),i.bezierCurveTo(v,l-b,y-nt,p,y,p),i.bezierCurveTo(y+nt,p,tt,l-b,tt,l),i.bezierCurveTo(tt,l+b,y+nt,it,y,it),i.bezierCurveTo(y-nt,it,v,l+b,v,l),i.closePath(),r.fill&&(i.globalAlpha=r.fillAlpha*s,i.fillStyle=a="#"+("00000"+(0|r.fillColor).toString(16)).substr(-6),i.fill()),r.lineWidth&&(i.globalAlpha=r.lineAlpha*s,i.stroke())}else if(r.type===n.Graphics.RREC){var e=u[0],f=u[1],c=u[2],h=u[3],o=u[4],ft=Math.min(c,h)/2|0;o=o>ft?ft:o,i.beginPath(),i.moveTo(e,f+o),i.lineTo(e,f+h-o),i.quadraticCurveTo(e,f+h,e+o,f+h),i.lineTo(e+c-o,f+h),i.quadraticCurveTo(e+c,f+h,e+c,f+h-o),i.lineTo(e+c,f+o),i.quadraticCurveTo(e+c,f,e+c-o,f),i.lineTo(e+o,f),i.quadraticCurveTo(e,f,e,f+o),i.closePath(),(r.fillColor||0===r.fillColor)&&(i.globalAlpha=r.fillAlpha*s,i.fillStyle=a="#"+("00000"+(0|r.fillColor).toString(16)).substr(-6),i.fill()),r.lineWidth&&(i.globalAlpha=r.lineAlpha*s,i.stroke())}},n.CanvasGraphics.renderGraphicsMask=function(t,i){var it=t.graphicsData.length,d,o,r,v;if(0!==it)for(it>1&&(it=1,window.console.log("Pixi.js warning: masks in canvas can only mask using the first path in the graphics object")),d=0;1>d;d++)if(o=t.graphicsData[d],r=o.points,o.type===n.Graphics.POLY){for(i.beginPath(),i.moveTo(r[0],r[1]),v=1;v<r.length/2;v++)i.lineTo(r[2*v],r[2*v+1]);r[0]===r[r.length-2]&&r[1]===r[r.length-1]&&i.closePath()}else if(o.type===n.Graphics.RECT)i.beginPath(),i.rect(r[0],r[1],r[2],r[3]),i.closePath();else if(o.type===n.Graphics.CIRC)i.beginPath(),i.arc(r[0],r[1],r[2],0,2*Math.PI),i.closePath();else if(o.type===n.Graphics.ELIP){var w=o.points,p=2*w[2],g=2*w[3],l=w[0]-p/2,y=w[1]-g/2;i.beginPath();var rt=.5522848,b=p/2*rt,k=g/2*rt,nt=l+p,tt=y+g,a=l+p/2,s=y+g/2;i.moveTo(l,s),i.bezierCurveTo(l,s-k,a-b,y,a,y),i.bezierCurveTo(a+b,y,nt,s-k,nt,s),i.bezierCurveTo(nt,s+k,a+b,tt,a,tt),i.bezierCurveTo(a-b,tt,l,s+k,l,s),i.closePath()}else if(o.type===n.Graphics.RREC){var f=r[0],u=r[1],h=r[2],c=r[3],e=r[4],ut=Math.min(h,c)/2|0;e=e>ut?ut:e,i.beginPath(),i.moveTo(f,u+e),i.lineTo(f,u+c-e),i.quadraticCurveTo(f,u+c,f+e,u+c),i.lineTo(f+h-e,u+c),i.quadraticCurveTo(f+h,u+c,f+h,u+c-e),i.lineTo(f+h,u+e),i.quadraticCurveTo(f+h,u,f+h-e,u),i.lineTo(f+e,u),i.quadraticCurveTo(f,u,f,u+e),i.closePath()}},n.Graphics=function(){n.DisplayObjectContainer.call(this),this.renderable=!0,this.fillAlpha=1,this.lineWidth=0,this.lineColor="black",this.graphicsData=[],this.tint=16777215,this.blendMode=n.blendModes.NORMAL,this.currentPath={points:[]},this._webGL=[],this.isMask=!1,this.bounds=null,this.boundsPadding=10,this.dirty=!0},n.Graphics.prototype=Object.create(n.DisplayObjectContainer.prototype),n.Graphics.prototype.constructor=n.Graphics,Object.defineProperty(n.Graphics.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(n){this._cacheAsBitmap=n,this._cacheAsBitmap?this._generateCachedSprite():(this.destroyCachedSprite(),this.dirty=!0)}}),n.Graphics.prototype.lineStyle=function(t,i,r){return this.currentPath.points.length||this.graphicsData.pop(),this.lineWidth=t||0,this.lineColor=i||0,this.lineAlpha=arguments.length<3?1:r,this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:n.Graphics.POLY},this.graphicsData.push(this.currentPath),this},n.Graphics.prototype.moveTo=function(t,i){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath=this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:n.Graphics.POLY},this.currentPath.points.push(t,i),this.graphicsData.push(this.currentPath),this},n.Graphics.prototype.lineTo=function(n,t){return this.currentPath.points.push(n,t),this.dirty=!0,this},n.Graphics.prototype.quadraticCurveTo=function(n,t,i,r){var e,o,s,u;0===this.currentPath.points.length&&this.moveTo(0,0),s=20,u=this.currentPath.points,0===u.length&&this.moveTo(0,0);for(var c=u[u.length-2],l=u[u.length-1],f=0,h=1;s>=h;h++)f=h/s,e=c+(n-c)*f,o=l+(t-l)*f,u.push(e+(n+(i-n)*f-e)*f,o+(t+(r-t)*f-o)*f);return this.dirty=!0,this},n.Graphics.prototype.bezierCurveTo=function(n,t,i,r,u,f){0===this.currentPath.points.length&&this.moveTo(0,0);for(var o,h,l,c,a,y=20,s=this.currentPath.points,p=s[s.length-2],w=s[s.length-1],e=0,v=1;y>v;v++)e=v/y,o=1-e,h=o*o,l=h*o,c=e*e,a=c*e,s.push(l*p+3*h*e*n+3*o*c*i+a*u,l*w+3*h*e*t+3*o*c*r+a*f);return this.dirty=!0,this},n.Graphics.prototype.arcTo=function(n,t,i,r,u){0===this.currentPath.points.length&&this.moveTo(n,t);var h=this.currentPath.points,tt=h[h.length-2],nt=h[h.length-1],s=nt-t,o=tt-n,e=r-t,f=i-n,y=Math.abs(s*f-o*e);if(1e-8>y||0===u)h.push(n,t);else{var b=s*s+o*o,k=e*e+f*f,d=s*e+o*f,l=u*Math.sqrt(b)/y,c=u*Math.sqrt(k)/y,w=l*d/b,p=c*d/k,a=l*f+c*o,v=l*e+c*s,it=o*(c+w),rt=s*(c+w),ut=f*(l+p),ft=e*(l+p),g=Math.atan2(rt-v,it-a),et=Math.atan2(ft-v,ut-a);this.arc(a+n,v+t,u,g,et,o*e>f*s)}return this.dirty=!0,this},n.Graphics.prototype.arc=function(n,t,i,r,u,f){var p=n+Math.cos(r)*i,y=t+Math.sin(r)*i,e=this.currentPath.points,s,l;if(((0!==e.length&&e[e.length-2]!==p||e[e.length-1]!==y)&&(this.moveTo(p,y),e=this.currentPath.points),r===u)||(!f&&r>=u?u+=2*Math.PI:f&&u>=r&&(r+=2*Math.PI),s=f?-1*(r-u):u-r,l=Math.abs(s)/(2*Math.PI)*40,0===s))return this;for(var h=s/(2*l),d=2*h,a=Math.cos(h),v=Math.sin(h),c=l-1,g=c%1/c,o=0;c>=o;o++){var nt=o+g*o,w=h+r+d*nt,b=Math.cos(w),k=-Math.sin(w);e.push((a*b+v*k)*i+n,(a*-k+v*b)*i+t)}return this.dirty=!0,this},n.Graphics.prototype.drawPath=function(t){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath=this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:n.Graphics.POLY},this.graphicsData.push(this.currentPath),this.currentPath.points=this.currentPath.points.concat(t),this.dirty=!0,this},n.Graphics.prototype.beginFill=function(n,t){return this.filling=!0,this.fillColor=n||0,this.fillAlpha=arguments.length<2?1:t,this},n.Graphics.prototype.endFill=function(){return this.filling=!1,this.fillColor=null,this.fillAlpha=1,this},n.Graphics.prototype.drawRect=function(t,i,r,u){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[t,i,r,u],type:n.Graphics.RECT},this.graphicsData.push(this.currentPath),this.dirty=!0,this},n.Graphics.prototype.drawRoundedRect=function(t,i,r,u,f){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[t,i,r,u,f],type:n.Graphics.RREC},this.graphicsData.push(this.currentPath),this.dirty=!0,this},n.Graphics.prototype.drawCircle=function(t,i,r){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[t,i,r,r],type:n.Graphics.CIRC},this.graphicsData.push(this.currentPath),this.dirty=!0,this},n.Graphics.prototype.drawEllipse=function(t,i,r,u){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[t,i,r,u],type:n.Graphics.ELIP},this.graphicsData.push(this.currentPath),this.dirty=!0,this},n.Graphics.prototype.clear=function(){return this.lineWidth=0,this.filling=!1,this.dirty=!0,this.clearDirty=!0,this.graphicsData=[],this.bounds=null,this},n.Graphics.prototype.generateTexture=function(){var t=this.getBounds(),i=new n.CanvasBuffer(t.width,t.height),r=n.Texture.fromCanvas(i.canvas);return i.context.translate(-t.x,-t.y),n.CanvasGraphics.renderGraphics(this,i.context),r},n.Graphics.prototype._renderWebGL=function(t){var r,i,u;if(this.visible!==!1&&0!==this.alpha&&this.isMask!==!0){if(this._cacheAsBitmap)return this.dirty&&(this._generateCachedSprite(),n.updateWebGLTexture(this._cachedSprite.texture.baseTexture,t.gl),this.dirty=!1),this._cachedSprite.alpha=this.alpha,n.Sprite.prototype._renderWebGL.call(this._cachedSprite,t),void 0;if((t.spriteBatch.stop(),t.blendModeManager.setBlendMode(this.blendMode),this._mask&&t.maskManager.pushMask(this._mask,t),this._filters&&t.filterManager.pushFilter(this._filterBlock),this.blendMode!==t.spriteBatch.currentBlendMode)&&(t.spriteBatch.currentBlendMode=this.blendMode,r=n.blendModesWebGL[t.spriteBatch.currentBlendMode],t.spriteBatch.gl.blendFunc(r[0],r[1])),n.WebGLGraphics.renderGraphics(this,t),this.children.length){for(t.spriteBatch.start(),i=0,u=this.children.length;u>i;i++)this.children[i]._renderWebGL(t);t.spriteBatch.stop()}this._filters&&t.filterManager.popFilter(),this._mask&&t.maskManager.popMask(this.mask,t),t.drawCount++,t.spriteBatch.start()}},n.Graphics.prototype._renderCanvas=function(t){var r,i,u,f;if(this.visible!==!1&&0!==this.alpha&&this.isMask!==!0){for(r=t.context,i=this.worldTransform,this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,r.globalCompositeOperation=n.blendModesCanvas[t.currentBlendMode]),this._mask&&t.maskManager.pushMask(this._mask,t.context),r.setTransform(i.a,i.c,i.b,i.d,i.tx,i.ty),n.CanvasGraphics.renderGraphics(this,r),u=0,f=this.children.length;f>u;u++)this.children[u]._renderCanvas(t);this._mask&&t.maskManager.popMask(t.context)}},n.Graphics.prototype.getBounds=function(n){var f;this.bounds||this.updateBounds();var s=this.bounds.x,h=this.bounds.width+this.bounds.x,c=this.bounds.y,w=this.bounds.height+this.bounds.y,e=n||this.worldTransform,o=e.a,nt=e.c,g=e.b,d=e.d,k=e.tx,b=e.ty,rt=o*h+g*w+k,it=d*w+nt*h+b,tt=o*s+g*w+k,p=d*w+nt*s+b,y=o*s+g*c+k,v=d*c+nt*s+b,a=o*h+g*c+k,l=d*c+nt*h+b,u=rt,r=it,t=rt,i=it;return t=t>tt?tt:t,t=t>y?y:t,t=t>a?a:t,i=i>p?p:i,i=i>v?v:i,i=i>l?l:i,u=tt>u?tt:u,u=y>u?y:u,u=a>u?a:u,r=p>r?p:r,r=v>r?v:r,r=l>r?l:r,f=this._bounds,f.x=t,f.width=u-t,f.y=i,f.height=r-i,f},n.Graphics.prototype.updateBounds=function(){for(var l,a,u,t,i,h,c,f=1/0,o=-1/0,e=1/0,s=-1/0,v=0;v<this.graphicsData.length;v++){var y=this.graphicsData[v],p=y.type,r=y.lineWidth;if(u=y.points,p===n.Graphics.RECT)t=u[0]-r/2,i=u[1]-r/2,h=u[2]+r,c=u[3]+r,f=f>t?t:f,o=t+h>o?t+h:o,e=e>i?t:e,s=i+c>s?i+c:s;else if(p===n.Graphics.CIRC||p===n.Graphics.ELIP)t=u[0],i=u[1],h=u[2]+r/2,c=u[3]+r/2,f=f>t-h?t-h:f,o=t+h>o?t+h:o,e=e>i-c?i-c:e,s=i+c>s?i+c:s;else for(l=0;l<u.length;l+=2)t=u[l],i=u[l+1],f=f>t-r?t-r:f,o=t+r>o?t+r:o,e=e>i-r?i-r:e,s=i+r>s?i+r:s}a=this.boundsPadding,this.bounds=new n.Rectangle(f-a,e-a,o-f+2*a,s-e+2*a)},n.Graphics.prototype._generateCachedSprite=function(){var t=this.getLocalBounds(),i,r;this._cachedSprite?this._cachedSprite.buffer.resize(t.width,t.height):(i=new n.CanvasBuffer(t.width,t.height),r=n.Texture.fromCanvas(i.canvas),this._cachedSprite=new n.Sprite(r),this._cachedSprite.buffer=i,this._cachedSprite.worldTransform=this.worldTransform),this._cachedSprite.anchor.x=-(t.x/t.width),this._cachedSprite.anchor.y=-(t.y/t.height),this._cachedSprite.buffer.context.translate(-t.x,-t.y),n.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context),this._cachedSprite.alpha=this.alpha},n.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(!0),this._cachedSprite=null},n.Graphics.POLY=0,n.Graphics.RECT=1,n.Graphics.CIRC=2,n.Graphics.ELIP=3,n.Graphics.RREC=4,n.Strip=function(t){n.DisplayObjectContainer.call(this),this.texture=t,this.uvs=new n.Float32Array([0,1,1,1,1,0,0,1]),this.verticies=new n.Float32Array([0,0,100,0,100,100,0,100]),this.colors=new n.Float32Array([1,1,1,1]),this.indices=new n.Uint16Array([0,1,2,3]),this.dirty=!0},n.Strip.prototype=Object.create(n.DisplayObjectContainer.prototype),n.Strip.prototype.constructor=n.Strip,n.Strip.prototype._renderWebGL=function(n){!this.visible||this.alpha<=0||(n.spriteBatch.stop(),this._vertexBuffer||this._initWebGL(n),n.shaderManager.setShader(n.shaderManager.stripShader),this._renderStrip(n),n.spriteBatch.start())},n.Strip.prototype._initWebGL=function(n){var t=n.gl;this._vertexBuffer=t.createBuffer(),this._indexBuffer=t.createBuffer(),this._uvBuffer=t.createBuffer(),this._colorBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this._vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.verticies,t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this._uvBuffer),t.bufferData(t.ARRAY_BUFFER,this.uvs,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this._colorBuffer),t.bufferData(t.ARRAY_BUFFER,this.colors,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW)},n.Strip.prototype._renderStrip=function(t){var i=t.gl,u=t.projection,f=t.offset,r=t.shaderManager.stripShader;i.blendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA),i.uniformMatrix3fv(r.translationMatrix,!1,this.worldTransform.toArray(!0)),i.uniform2f(r.projectionVector,u.x,-u.y),i.uniform2f(r.offsetVector,-f.x,-f.y),i.uniform1f(r.alpha,1),this.dirty?(this.dirty=!1,i.bindBuffer(i.ARRAY_BUFFER,this._vertexBuffer),i.bufferData(i.ARRAY_BUFFER,this.verticies,i.STATIC_DRAW),i.vertexAttribPointer(r.aVertexPosition,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this._uvBuffer),i.bufferData(i.ARRAY_BUFFER,this.uvs,i.STATIC_DRAW),i.vertexAttribPointer(r.aTextureCoord,2,i.FLOAT,!1,0,0),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,this.texture.baseTexture._glTextures[i.id]||n.createWebGLTexture(this.texture.baseTexture,i)),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this._indexBuffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,this.indices,i.STATIC_DRAW)):(i.bindBuffer(i.ARRAY_BUFFER,this._vertexBuffer),i.bufferSubData(i.ARRAY_BUFFER,0,this.verticies),i.vertexAttribPointer(r.aVertexPosition,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this._uvBuffer),i.vertexAttribPointer(r.aTextureCoord,2,i.FLOAT,!1,0,0),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,this.texture.baseTexture._glTextures[i.id]||n.createWebGLTexture(this.texture.baseTexture,i)),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this._indexBuffer)),i.drawElements(i.TRIANGLE_STRIP,this.indices.length,i.UNSIGNED_SHORT,0)},n.Strip.prototype._renderCanvas=function(n){var i=n.context,r=this.worldTransform,ut;n.roundPixels?i.setTransform(r.a,r.c,r.b,r.d,0|r.tx,0|r.ty):i.setTransform(r.a,r.c,r.b,r.d,r.tx,r.ty);var d=this,g=d.verticies,rt=d.uvs,ft=g.length/2;for(this.count++,ut=0;ft-2>ut;ut++){var u=2*ut,y=g[u],a=g[u+2],b=g[u+4],l=g[u+1],c=g[u+3],h=g[u+5],it=(y+a+b)/3,tt=(l+c+h)/3,e=y-it,f=l-tt,t=Math.sqrt(e*e+f*f);y=it+e/t*(t+3),l=tt+f/t*(t+3),e=a-it,f=c-tt,t=Math.sqrt(e*e+f*f),a=it+e/t*(t+3),c=tt+f/t*(t+3),e=b-it,f=h-tt,t=Math.sqrt(e*e+f*f),b=it+e/t*(t+3),h=tt+f/t*(t+3);var v=rt[u]*d.texture.width,k=rt[u+2]*d.texture.width,o=rt[u+4]*d.texture.width,s=rt[u+1]*d.texture.height,p=rt[u+3]*d.texture.height,w=rt[u+5]*d.texture.height;i.save(),i.beginPath(),i.moveTo(y,l),i.lineTo(a,c),i.lineTo(b,h),i.closePath(),i.clip();var nt=v*p+s*o+k*w-p*o-s*k-v*w,et=y*p+s*b+a*w-p*b-s*a-y*w,ot=v*a+y*o+k*b-a*o-y*k-v*b,st=v*p*b+s*a*o+y*k*w-y*p*o-s*k*b-v*a*w,ht=l*p+s*h+c*w-p*h-s*c-l*w,ct=v*c+l*o+k*h-c*o-l*k-v*h,lt=v*p*h+s*c*o+l*k*w-l*p*o-s*k*h-v*c*w;i.transform(et/nt,ht/nt,ot/nt,ct/nt,st/nt,lt/nt),i.drawImage(d.texture.baseTexture.source,0,0),i.restore()}},n.Strip.prototype.onTextureUpdate=function(){this.updateFrame=!0},n.Rope=function(t,i){n.Strip.call(this,t),this.points=i,this.verticies=new n.Float32Array(4*i.length),this.uvs=new n.Float32Array(4*i.length),this.colors=new n.Float32Array(2*i.length),this.indices=new n.Uint16Array(2*i.length),this.refresh()},n.Rope.prototype=Object.create(n.Strip.prototype),n.Rope.prototype.constructor=n.Rope,n.Rope.prototype.refresh=function(){var u=this.points,s,n,r,o,i;if(!(u.length<1)){var t=this.uvs,h=u[0],f=this.indices,e=this.colors;for(this.count-=.2,t[0]=0,t[1]=0,t[2]=0,t[3]=1,e[0]=1,e[1]=1,f[0]=0,f[1]=1,o=u.length,i=1;o>i;i++)s=u[i],n=4*i,r=i/(o-1),i%2?(t[n]=r,t[n+1]=0,t[n+2]=r,t[n+3]=1):(t[n]=r,t[n+1]=0,t[n+2]=r,t[n+3]=1),n=2*i,e[n]=1,e[n+1]=1,n=2*i,f[n]=n,f[n+1]=n+1,h=s}},n.Rope.prototype.updateTransform=function(){var u=this.points,s,e,t;if(!(u.length<1)){e=u[0],t={x:0,y:0},this.count-=.2;for(var i,f,h,c,l,o=this.verticies,a=u.length,r=0;a>r;r++)i=u[r],f=4*r,s=r<u.length-1?u[r+1]:i,t.y=-(s.x-e.x),t.x=s.y-e.y,h=10*(1-r/(a-1)),h>1&&(h=1),c=Math.sqrt(t.x*t.x+t.y*t.y),l=this.texture.height/2,t.x/=c,t.y/=c,t.x*=l,t.y*=l,o[f]=i.x+t.x,o[f+1]=i.y+t.y,o[f+2]=i.x-t.x,o[f+3]=i.y-t.y,e=i;n.DisplayObjectContainer.prototype.updateTransform.call(this)}},n.Rope.prototype.setTexture=function(n){this.texture=n},n.TilingSprite=function(t,i,r){n.Sprite.call(this,t),this._width=i||100,this._height=r||100,this.tileScale=new n.Point(1,1),this.tileScaleOffset=new n.Point(1,1),this.tilePosition=new n.Point(0,0),this.renderable=!0,this.tint=16777215,this.blendMode=n.blendModes.NORMAL},n.TilingSprite.prototype=Object.create(n.Sprite.prototype),n.TilingSprite.prototype.constructor=n.TilingSprite,Object.defineProperty(n.TilingSprite.prototype,"width",{get:function(){return this._width},set:function(n){this._width=n}}),Object.defineProperty(n.TilingSprite.prototype,"height",{get:function(){return this._height},set:function(n){this._height=n}}),n.TilingSprite.prototype.setTexture=function(n){this.texture!==n&&(this.texture=n,this.refreshTexture=!0,this.cachedTint=16777215)},n.TilingSprite.prototype._renderWebGL=function(t){if(this.visible!==!1&&0!==this.alpha){var i,r;for(this._mask&&(t.spriteBatch.stop(),t.maskManager.pushMask(this.mask,t),t.spriteBatch.start()),this._filters&&(t.spriteBatch.flush(),t.filterManager.pushFilter(this._filterBlock)),!this.tilingTexture||this.refreshTexture?(this.generateTilingTexture(!0),this.tilingTexture&&this.tilingTexture.needsUpdate&&(n.updateWebGLTexture(this.tilingTexture.baseTexture,t.gl),this.tilingTexture.needsUpdate=!1)):t.spriteBatch.renderTilingSprite(this),i=0,r=this.children.length;r>i;i++)this.children[i]._renderWebGL(t);t.spriteBatch.stop(),this._filters&&t.filterManager.popFilter(),this._mask&&t.maskManager.popMask(t),t.spriteBatch.start()}},n.TilingSprite.prototype._renderCanvas=function(t){var i,e,o,u,r,f;if(this.visible!==!1&&0!==this.alpha){if(i=t.context,this._mask&&t.maskManager.pushMask(this._mask,i),i.globalAlpha=this.worldAlpha,u=this.worldTransform,i.setTransform(u.a,u.c,u.b,u.d,u.tx,u.ty),!this.__tilePattern||this.refreshTexture){if(this.generateTilingTexture(!1),!this.tilingTexture)return;this.__tilePattern=i.createPattern(this.tilingTexture.baseTexture.source,"repeat")}for(this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,i.globalCompositeOperation=n.blendModesCanvas[t.currentBlendMode]),r=this.tilePosition,f=this.tileScale,r.x%=this.tilingTexture.baseTexture.width,r.y%=this.tilingTexture.baseTexture.height,i.scale(f.x,f.y),i.translate(r.x,r.y),i.fillStyle=this.__tilePattern,i.fillRect(-r.x+this.anchor.x*-this._width,-r.y+this.anchor.y*-this._height,this._width/f.x,this._height/f.y),i.scale(1/f.x,1/f.y),i.translate(-r.x,-r.y),this._mask&&t.maskManager.popMask(t.context),e=0,o=this.children.length;o>e;e++)this.children[e]._renderCanvas(t)}},n.TilingSprite.prototype.getBounds=function(){var ut=this._width,rt=this._height,tt=ut*(1-this.anchor.x),nt=ut*-this.anchor.x,g=rt*(1-this.anchor.y),d=rt*-this.anchor.y,f=this.worldTransform,k=f.a,b=f.c,w=f.b,p=f.d,y=f.tx,v=f.ty,it=k*nt+w*d+y,a=p*d+b*nt+v,l=k*tt+w*d+y,c=p*d+b*tt+v,h=k*tt+w*g+y,s=p*g+b*tt+v,o=k*nt+w*g+y,e=p*g+b*nt+v,r=-1/0,i=-1/0,n=1/0,t=1/0,u;return n=n>it?it:n,n=n>l?l:n,n=n>h?h:n,n=n>o?o:n,t=t>a?a:t,t=t>c?c:t,t=t>s?s:t,t=t>e?e:t,r=it>r?it:r,r=l>r?l:r,r=h>r?h:r,r=o>r?o:r,i=a>i?a:i,i=c>i?c:i,i=s>i?s:i,i=e>i?e:i,u=this._bounds,u.x=n,u.width=r-n,u.y=t,u.height=i-t,this._currentBounds=u,u},n.TilingSprite.prototype.onTextureUpdate=function(){},n.TilingSprite.prototype.generateTilingTexture=function(t){var e;if(this.texture.baseTexture.hasLoaded){var u,f,r=this.texture,i=r.frame,s=i.width!==r.baseTexture.width||i.height!==r.baseTexture.height,o=!1;(t?(u=n.getNextPowerOfTwo(i.width),f=n.getNextPowerOfTwo(i.height),(i.width!==u||i.height!==f)&&(o=!0)):s&&(u=i.width,f=i.height,o=!0),o)?(this.tilingTexture&&this.tilingTexture.isTiling?(e=this.tilingTexture.canvasBuffer,e.resize(u,f),this.tilingTexture.baseTexture.width=u,this.tilingTexture.baseTexture.height=f,this.tilingTexture.needsUpdate=!0):(e=new n.CanvasBuffer(u,f),this.tilingTexture=n.Texture.fromCanvas(e.canvas),this.tilingTexture.canvasBuffer=e,this.tilingTexture.isTiling=!0),e.context.drawImage(r.baseTexture.source,r.crop.x,r.crop.y,r.crop.width,r.crop.height,0,0,u,f),this.tileScaleOffset.x=i.width/u,this.tileScaleOffset.y=i.height/f):(this.tilingTexture&&this.tilingTexture.isTiling&&this.tilingTexture.destroy(!0),this.tileScaleOffset.x=1,this.tileScaleOffset.y=1,this.tilingTexture=r),this.refreshTexture=!1,this.tilingTexture.baseTexture._powerOf2=!0}},t={},t.BoneData=function(n,t){this.name=n,this.parent=t},t.BoneData.prototype={length:0,x:0,y:0,rotation:0,scaleX:1,scaleY:1},t.SlotData=function(n,t){this.name=n,this.boneData=t},t.SlotData.prototype={r:1,g:1,b:1,a:1,attachmentName:null},t.Bone=function(n,t){this.data=n,this.parent=t,this.setToSetupPose()},t.Bone.yDown=!1,t.Bone.prototype={x:0,y:0,rotation:0,scaleX:1,scaleY:1,m00:0,m01:0,worldX:0,m10:0,m11:0,worldY:0,worldRotation:0,worldScaleX:1,worldScaleY:1,updateWorldTransform:function(n,i){var r=this.parent;null!=r?(this.worldX=this.x*r.m00+this.y*r.m01+r.worldX,this.worldY=this.x*r.m10+this.y*r.m11+r.worldY,this.worldScaleX=r.worldScaleX*this.scaleX,this.worldScaleY=r.worldScaleY*this.scaleY,this.worldRotation=r.worldRotation+this.rotation):(this.worldX=this.x,this.worldY=this.y,this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY,this.worldRotation=this.rotation);var u=this.worldRotation*Math.PI/180,f=Math.cos(u),e=Math.sin(u);this.m00=f*this.worldScaleX,this.m10=e*this.worldScaleX,this.m01=-e*this.worldScaleY,this.m11=f*this.worldScaleY,n&&(this.m00=-this.m00,this.m01=-this.m01),i&&(this.m10=-this.m10,this.m11=-this.m11),t.Bone.yDown&&(this.m10=-this.m10,this.m11=-this.m11)},setToSetupPose:function(){var n=this.data;this.x=n.x,this.y=n.y,this.rotation=n.rotation,this.scaleX=n.scaleX,this.scaleY=n.scaleY}},t.Slot=function(n,t,i){this.data=n,this.skeleton=t,this.bone=i,this.setToSetupPose()},t.Slot.prototype={r:1,g:1,b:1,a:1,_attachmentTime:0,attachment:null,setAttachment:function(n){this.attachment=n,this._attachmentTime=this.skeleton.time},setAttachmentTime:function(n){this._attachmentTime=this.skeleton.time-n},getAttachmentTime:function(){return this.skeleton.time-this._attachmentTime},setToSetupPose:function(){var n=this.data;this.r=n.r,this.g=n.g,this.b=n.b,this.a=n.a;for(var i=this.skeleton.data.slots,t=0,r=i.length;r>t;t++)if(i[t]==n){this.setAttachment(n.attachmentName?this.skeleton.getAttachmentBySlotIndex(t,n.attachmentName):null);break}}},t.Skin=function(n){this.name=n,this.attachments={}},t.Skin.prototype={addAttachment:function(n,t,i){this.attachments[n+":"+t]=i},getAttachment:function(n,t){return this.attachments[n+":"+t]},_attachAll:function(n,t){var i,u;for(i in t.attachments){var f=i.indexOf(":"),e=parseInt(i.substring(0,f),10),o=i.substring(f+1),r=n.slots[e];r.attachment&&r.attachment.name==o&&(u=this.getAttachment(e,o),u&&r.setAttachment(u))}}},t.Animation=function(n,t,i){this.name=n,this.timelines=t,this.duration=i},t.Animation.prototype={apply:function(n,t,i){i&&this.duration&&(t%=this.duration);for(var u=this.timelines,r=0,f=u.length;f>r;r++)u[r].apply(n,t,1)},mix:function(n,t,i,r){i&&this.duration&&(t%=this.duration);for(var f=this.timelines,u=0,e=f.length;e>u;u++)f[u].apply(n,t,r)}},t.binarySearch=function(n,t,i){var f=0,r=Math.floor(n.length/i)-2,u;if(!r)return i;for(u=r>>>1;;){if(n[(u+1)*i]<=t?f=u+1:r=u,f==r)return(f+1)*i;u=f+r>>>1}},t.linearSearch=function(n,t,i){for(var r=0,u=n.length-i;u>=r;r+=i)if(n[r]>t)return r;return-1},t.Curves=function(n){this.curves=[],this.curves.length=6*(n-1)},t.Curves.prototype={setLinear:function(n){this.curves[6*n]=0},setStepped:function(n){this.curves[6*n]=-1},setCurve:function(n,t,i,r,u){var o=.1,a=o*o,h=a*o,b=3*o,v=3*a,y=6*a,s=6*h,p=2*-t+r,w=2*-i+u,c=3*(t-r)+1,l=3*(i-u)+1,f=6*n,e=this.curves;e[f]=t*b+p*v+c*h,e[f+1]=i*b+w*v+l*h,e[f+2]=p*y+c*s,e[f+3]=w*y+l*s,e[f+4]=c*s,e[f+5]=l*s},getCurvePercent:function(n,t){var s,h;t=0>t?0:t>1?1:t;var i=6*n,r=this.curves,u=r[i];if(!u)return t;if(-1==u)return 0;for(var o=r[i+1],c=r[i+2],l=r[i+3],v=r[i+4],y=r[i+5],f=u,e=o,a=8;;){if(f>=t)return s=f-u,h=e-o,h+(e-h)*(t-s)/(f-s);if(!a)break;a--,u+=c,o+=l,c+=v,l+=y,f+=u,e+=o}return e+(1-e)*(t-f)/(1-f)}},t.RotateTimeline=function(n){this.curves=new t.Curves(n),this.frames=[],this.frames.length=2*n},t.RotateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(n,t,i){n*=2,this.frames[n]=t,this.frames[n+1]=i},apply:function(n,i,r){var u,f=this.frames,e;if(!(i<f[0])){if(e=n.bones[this.boneIndex],i>=f[f.length-2]){for(u=e.data.rotation+f[f.length-1]-e.rotation;u>180;)u-=360;for(;-180>u;)u+=360;return e.rotation+=u*r,void 0}var o=t.binarySearch(f,i,2),h=f[o-1],c=f[o],s=1-(i-c)/(f[o-2]-c);for(s=this.curves.getCurvePercent(o/2-1,s),u=f[o+1]-h;u>180;)u-=360;for(;-180>u;)u+=360;for(u=e.data.rotation+(h+u*s)-e.rotation;u>180;)u-=360;for(;-180>u;)u+=360;e.rotation+=u*r}}},t.TranslateTimeline=function(n){this.curves=new t.Curves(n),this.frames=[],this.frames.length=3*n},t.TranslateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(n,t,i,r){n*=3,this.frames[n]=t,this.frames[n+1]=i,this.frames[n+2]=r},apply:function(n,i,r){var u=this.frames,f;if(!(i<u[0])){if(f=n.bones[this.boneIndex],i>=u[u.length-3])return f.x+=(f.data.x+u[u.length-2]-f.x)*r,f.y+=(f.data.y+u[u.length-1]-f.y)*r,void 0;var e=t.binarySearch(u,i,3),s=u[e-2],h=u[e-1],c=u[e],o=1-(i-c)/(u[e+-3]-c);o=this.curves.getCurvePercent(e/3-1,o),f.x+=(f.data.x+s+(u[e+1]-s)*o-f.x)*r,f.y+=(f.data.y+h+(u[e+2]-h)*o-f.y)*r}}},t.ScaleTimeline=function(n){this.curves=new t.Curves(n),this.frames=[],this.frames.length=3*n},t.ScaleTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(n,t,i,r){n*=3,this.frames[n]=t,this.frames[n+1]=i,this.frames[n+2]=r},apply:function(n,i,r){var u=this.frames,f;if(!(i<u[0])){if(f=n.bones[this.boneIndex],i>=u[u.length-3])return f.scaleX+=(f.data.scaleX-1+u[u.length-2]-f.scaleX)*r,f.scaleY+=(f.data.scaleY-1+u[u.length-1]-f.scaleY)*r,void 0;var e=t.binarySearch(u,i,3),s=u[e-2],h=u[e-1],c=u[e],o=1-(i-c)/(u[e+-3]-c);o=this.curves.getCurvePercent(e/3-1,o),f.scaleX+=(f.data.scaleX-1+s+(u[e+1]-s)*o-f.scaleX)*r,f.scaleY+=(f.data.scaleY-1+h+(u[e+2]-h)*o-f.scaleY)*r}}},t.ColorTimeline=function(n){this.curves=new t.Curves(n),this.frames=[],this.frames.length=5*n},t.ColorTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length/5},setFrame:function(n,t,i,r,u,f){n*=5,this.frames[n]=t,this.frames[n+1]=i,this.frames[n+2]=r,this.frames[n+3]=u,this.frames[n+4]=f},apply:function(n,i,r){var u=this.frames,f,s;if(!(i<u[0])){if(f=n.slots[this.slotIndex],i>=u[u.length-5])return s=u.length-1,f.r=u[s-3],f.g=u[s-2],f.b=u[s-1],f.a=u[s],void 0;var e=t.binarySearch(u,i,5),p=u[e-4],a=u[e-3],v=u[e-2],w=u[e-1],l=u[e],o=1-(i-l)/(u[e-5]-l);o=this.curves.getCurvePercent(e/5-1,o);var c=p+(u[e+1]-p)*o,h=a+(u[e+2]-a)*o,y=v+(u[e+3]-v)*o,b=w+(u[e+4]-w)*o;1>r?(f.r+=(c-f.r)*r,f.g+=(h-f.g)*r,f.b+=(y-f.b)*r,f.a+=(b-f.a)*r):(f.r=c,f.g=h,f.b=y,f.a=b)}}},t.AttachmentTimeline=function(n){this.curves=new t.Curves(n),this.frames=[],this.frames.length=n,this.attachmentNames=[],this.attachmentNames.length=n},t.AttachmentTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length},setFrame:function(n,t,i){this.frames[n]=t,this.attachmentNames[n]=i},apply:function(n,i){var r=this.frames,f,u;i<r[0]||(f=i>=r[r.length-1]?r.length-1:t.binarySearch(r,i,1)-1,u=this.attachmentNames[f],n.slots[this.slotIndex].setAttachment(u?n.getAttachmentBySlotIndex(this.slotIndex,u):null))}},t.SkeletonData=function(){this.bones=[],this.slots=[],this.skins=[],this.animations=[]},t.SkeletonData.prototype={defaultSkin:null,findBone:function(n){for(var i=this.bones,t=0,r=i.length;r>t;t++)if(i[t].name==n)return i[t];return null},findBoneIndex:function(n){for(var i=this.bones,t=0,r=i.length;r>t;t++)if(i[t].name==n)return t;return-1},findSlot:function(n){for(var i=this.slots,t=0,r=i.length;r>t;t++)if(i[t].name==n)return slot[t];return null},findSlotIndex:function(n){for(var i=this.slots,t=0,r=i.length;r>t;t++)if(i[t].name==n)return t;return-1},findSkin:function(n){for(var i=this.skins,t=0,r=i.length;r>t;t++)if(i[t].name==n)return i[t];return null},findAnimation:function(n){for(var i=this.animations,t=0,r=i.length;r>t;t++)if(i[t].name==n)return i[t];return null}},t.Skeleton=function(n){var i,r,u,f;for(this.data=n,this.bones=[],i=0,r=n.bones.length;r>i;i++)u=n.bones[i],f=u.parent?this.bones[n.bones.indexOf(u.parent)]:null,this.bones.push(new t.Bone(u,f));for(this.slots=[],this.drawOrder=[],i=0,r=n.slots.length;r>i;i++){var e=n.slots[i],s=this.bones[n.bones.indexOf(e.boneData)],o=new t.Slot(e,this,s);this.slots.push(o),this.drawOrder.push(o)}},t.Skeleton.prototype={x:0,y:0,skin:null,r:1,g:1,b:1,a:1,time:0,flipX:!1,flipY:!1,updateWorldTransform:function(){for(var i=this.flipX,r=this.flipY,t=this.bones,n=0,u=t.length;u>n;n++)t[n].updateWorldTransform(i,r)},setToSetupPose:function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},setBonesToSetupPose:function(){for(var t=this.bones,n=0,i=t.length;i>n;n++)t[n].setToSetupPose()},setSlotsToSetupPose:function(){for(var t=this.slots,n=0,i=t.length;i>n;n++)t[n].setToSetupPose(n)},getRootBone:function(){return this.bones.length?this.bones[0]:null},findBone:function(n){for(var i=this.bones,t=0,r=i.length;r>t;t++)if(i[t].data.name==n)return i[t];return null},findBoneIndex:function(n){for(var i=this.bones,t=0,r=i.length;r>t;t++)if(i[t].data.name==n)return t;return-1},findSlot:function(n){for(var i=this.slots,t=0,r=i.length;r>t;t++)if(i[t].data.name==n)return i[t];return null},findSlotIndex:function(n){for(var i=this.slots,t=0,r=i.length;r>t;t++)if(i[t].data.name==n)return t;return-1},setSkinByName:function(n){var t=this.data.findSkin(n);if(!t)throw"Skin not found: "+n;this.setSkin(t)},setSkin:function(n){this.skin&&n&&n._attachAll(this,this.skin),this.skin=n},getAttachmentBySlotName:function(n,t){return this.getAttachmentBySlotIndex(this.data.findSlotIndex(n),t)},getAttachmentBySlotIndex:function(n,t){if(this.skin){var i=this.skin.getAttachment(n,t);if(i)return i}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(n,t):null},setAttachment:function(n,t){for(var u,r,f=this.slots,i=0,e=f.size;e>i;i++)if(u=f[i],u.data.name==n){if(r=null,t&&(r=this.getAttachment(i,t),null==r))throw"Attachment not found: "+t+", for slot: "+n;return u.setAttachment(r),void 0}throw"Slot not found: "+n;},update:function(n){time+=n}},t.AttachmentType={region:0},t.RegionAttachment=function(){this.offset=[],this.offset.length=8,this.uvs=[],this.uvs.length=8},t.RegionAttachment.prototype={x:0,y:0,rotation:0,scaleX:1,scaleY:1,width:0,height:0,rendererObject:null,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,setUVs:function(n,t,i,r,u){var f=this.uvs;u?(f[2]=n,f[3]=r,f[4]=n,f[5]=t,f[6]=i,f[7]=t,f[0]=i,f[1]=r):(f[0]=n,f[1]=r,f[2]=n,f[3]=t,f[4]=i,f[5]=t,f[6]=i,f[7]=r)},updateOffset:function(){var b=this.width/this.regionOriginalWidth*this.scaleX,s=this.height/this.regionOriginalHeight*this.scaleY,u=-this.width/2*this.scaleX+this.regionOffsetX*b,r=-this.height/2*this.scaleY+this.regionOffsetY*s,f=u+this.regionWidth*b,e=r+this.regionHeight*s,o=this.rotation*Math.PI/180,t=Math.cos(o),i=Math.sin(o),c=u*t+this.x,l=u*i,a=r*t+this.y,v=r*i,y=f*t+this.x,p=f*i,w=e*t+this.y,h=e*i,n=this.offset;n[0]=c-v,n[1]=a+l,n[2]=c-h,n[3]=w+l,n[4]=y-h,n[5]=w+p,n[6]=y-v,n[7]=a+p},computeVertices:function(n,t,i,r){n+=i.worldX,t+=i.worldY;var f=i.m00,e=i.m01,o=i.m10,s=i.m11,u=this.offset;r[0]=u[0]*f+u[1]*e+n,r[1]=u[0]*o+u[1]*s+t,r[2]=u[2]*f+u[3]*e+n,r[3]=u[2]*o+u[3]*s+t,r[4]=u[4]*f+u[5]*e+n,r[5]=u[4]*o+u[5]*s+t,r[6]=u[6]*f+u[7]*e+n,r[7]=u[6]*o+u[7]*s+t}},t.AnimationStateData=function(n){this.skeletonData=n,this.animationToMixTime={}},t.AnimationStateData.prototype={defaultMix:0,setMixByName:function(n,t,i){var u=this.skeletonData.findAnimation(n),r;if(!u)throw"Animation not found: "+n;if(r=this.skeletonData.findAnimation(t),!r)throw"Animation not found: "+t;this.setMix(u,r,i)},setMix:function(n,t,i){this.animationToMixTime[n.name+":"+t.name]=i},getMix:function(n,t){var i=this.animationToMixTime[n.name+":"+t.name];return i?i:this.defaultMix}},t.AnimationState=function(n){this.data=n,this.queue=[]},t.AnimationState.prototype={animationSpeed:1,current:null,previous:null,currentTime:0,previousTime:0,currentLoop:!1,previousLoop:!1,mixTime:0,mixDuration:0,update:function(n){if(this.currentTime+=n*this.animationSpeed,this.previousTime+=n,this.mixTime+=n,this.queue.length>0){var t=this.queue[0];this.currentTime>=t.delay&&(this._setAnimation(t.animation,t.loop),this.queue.shift())}},apply:function(n){if(this.current)if(this.previous){this.previous.apply(n,this.previousTime,this.previousLoop);var t=this.mixTime/this.mixDuration;t>=1&&(t=1,this.previous=null),this.current.mix(n,this.currentTime,this.currentLoop,t)}else this.current.apply(n,this.currentTime,this.currentLoop)},clearAnimation:function(){this.previous=null,this.current=null,this.queue.length=0},_setAnimation:function(n,t){this.previous=null,n&&this.current&&(this.mixDuration=this.data.getMix(this.current,n),this.mixDuration>0&&(this.mixTime=0,this.previous=this.current,this.previousTime=this.currentTime,this.previousLoop=this.currentLoop)),this.current=n,this.currentLoop=t,this.currentTime=0},setAnimationByName:function(n,t){var i=this.data.skeletonData.findAnimation(n);if(!i)throw"Animation not found: "+n;this.setAnimation(i,t)},setAnimation:function(n,t){this.queue.length=0,this._setAnimation(n,t)},addAnimationByName:function(n,t,i){var r=this.data.skeletonData.findAnimation(n);if(!r)throw"Animation not found: "+n;this.addAnimation(r,t,i)},addAnimation:function(n,t,i){var r={},u;(r.animation=n,r.loop=t,!i||0>=i)&&(u=this.queue.length?this.queue[this.queue.length-1].animation:this.current,i=null!=u?u.duration-this.data.getMix(u,n)+(i||0):0),r.delay=i,this.queue.push(r)},isComplete:function(){return!this.current||this.currentTime>=this.current.duration}},t.SkeletonJson=function(n){this.attachmentLoader=n},t.SkeletonJson.prototype={scale:1,readSkeletonData:function(n){for(var r,l,nt,s,e,h,v,y,p,o,w,it,b,c,g,a,k,i,u=new t.SkeletonData,tt=n.bones,f=0,d=tt.length;d>f;f++){if(r=tt[f],l=null,r.parent&&(l=u.findBone(r.parent),!l))throw"Parent bone not found: "+r.parent;i=new t.BoneData(r.name,l),i.length=(r.length||0)*this.scale,i.x=(r.x||0)*this.scale,i.y=(r.y||0)*this.scale,i.rotation=r.rotation||0,i.scaleX=r.scaleX||1,i.scaleY=r.scaleY||1,u.bones.push(i)}for(nt=n.slots,f=0,d=nt.length;d>f;f++){if(s=nt[f],i=u.findBone(s.bone),!i)throw"Slot bone not found: "+s.bone;e=new t.SlotData(s.name,i),h=s.color,h&&(e.r=t.SkeletonJson.toColor(h,0),e.g=t.SkeletonJson.toColor(h,1),e.b=t.SkeletonJson.toColor(h,2),e.a=t.SkeletonJson.toColor(h,3)),e.attachmentName=s.attachment,u.slots.push(e)}v=n.skins;for(y in v)if(v.hasOwnProperty(y)){p=v[y],o=new t.Skin(y);for(w in p)if(p.hasOwnProperty(w)){it=u.findSlotIndex(w),b=p[w];for(c in b)b.hasOwnProperty(c)&&(g=this.readAttachment(o,c,b[c]),null!=g&&o.addAttachment(it,c,g))}u.skins.push(o),"default"==o.name&&(u.defaultSkin=o)}a=n.animations;for(k in a)a.hasOwnProperty(k)&&this.readAnimation(k,a[k],u);return u},readAttachment:function(n,i,r){var f,u;if(i=r.name||i,f=t.AttachmentType[r.type||"region"],f==t.AttachmentType.region)return u=new t.RegionAttachment,u.x=(r.x||0)*this.scale,u.y=(r.y||0)*this.scale,u.scaleX=r.scaleX||1,u.scaleY=r.scaleY||1,u.rotation=r.rotation||0,u.width=(r.width||32)*this.scale,u.height=(r.height||32)*this.scale,u.updateOffset(),u.rendererObject={},u.rendererObject.name=i,u.rendererObject.scale={},u.rendererObject.scale.x=u.scaleX,u.rendererObject.scale.y=u.scaleY,u.rendererObject.rotation=-u.rotation*Math.PI/180,u;throw"Unknown attachment type: "+f;},readAnimation:function(n,i,r){var s,u,h,f,o,e,l,y=[],c=0,nt=i.bones,a,p,w,b,it,rt,k,v,d,tt;for(a in nt)if(nt.hasOwnProperty(a)){if(p=r.findBoneIndex(a),-1==p)throw"Bone not found: "+a;w=nt[a];for(h in w)if(w.hasOwnProperty(h))if(o=w[h],"rotate"==h){for(u=new t.RotateTimeline(o.length),u.boneIndex=p,s=0,e=0,l=o.length;l>e;e++)f=o[e],u.setFrame(s,f.time,f.angle),t.SkeletonJson.readCurve(u,s,f),s++;y.push(u),c=Math.max(c,u.frames[2*u.getFrameCount()-2])}else{if("translate"!=h&&"scale"!=h)throw"Invalid timeline type for a bone: "+h+" ("+a+")";for(b=1,"scale"==h?u=new t.ScaleTimeline(o.length):(u=new t.TranslateTimeline(o.length),b=this.scale),u.boneIndex=p,s=0,e=0,l=o.length;l>e;e++)f=o[e],it=(f.x||0)*b,rt=(f.y||0)*b,u.setFrame(s,f.time,it,rt),t.SkeletonJson.readCurve(u,s,f),s++;y.push(u),c=Math.max(c,u.frames[3*u.getFrameCount()-3])}}k=i.slots;for(v in k)if(k.hasOwnProperty(v)){d=k[v],tt=r.findSlotIndex(v);for(h in d)if(d.hasOwnProperty(h))if(o=d[h],"color"==h){for(u=new t.ColorTimeline(o.length),u.slotIndex=tt,s=0,e=0,l=o.length;l>e;e++){f=o[e];var g=f.color,ft=t.SkeletonJson.toColor(g,0),et=t.SkeletonJson.toColor(g,1),ut=t.SkeletonJson.toColor(g,2),ot=t.SkeletonJson.toColor(g,3);u.setFrame(s,f.time,ft,et,ut,ot),t.SkeletonJson.readCurve(u,s,f),s++}y.push(u),c=Math.max(c,u.frames[5*u.getFrameCount()-5])}else{if("attachment"!=h)throw"Invalid timeline type for a slot: "+h+" ("+v+")";for(u=new t.AttachmentTimeline(o.length),u.slotIndex=tt,s=0,e=0,l=o.length;l>e;e++)f=o[e],u.setFrame(s++,f.time,f.name);y.push(u),c=Math.max(c,u.frames[u.getFrameCount()-1])}}r.animations.push(new t.Animation(n,y,c))}},t.SkeletonJson.readCurve=function(n,t,i){var r=i.curve;r&&("stepped"==r?n.curves.setStepped(t):r instanceof Array&&n.curves.setCurve(t,r[0],r[1],r[2],r[3]))},t.SkeletonJson.toColor=function(n,t){if(8!=n.length)throw"Color hexidecimal length must be 8, recieved: "+n;return parseInt(n.substr(2*t,2),16)/255},t.Atlas=function(n,i){var e,r,u,o,f,s,h,c,l,a;for(this.textureLoader=i,this.pages=[],this.regions=[],e=new t.AtlasReader(n),r=[],r.length=4,u=null;;){if(o=e.readLine(),null==o)break;(o=e.trim(o),o.length)?u?(f=new t.AtlasRegion,f.name=o,f.page=u,f.rotate="true"==e.readValue(),e.readTuple(r),s=parseInt(r[0],10),h=parseInt(r[1],10),e.readTuple(r),c=parseInt(r[0],10),l=parseInt(r[1],10),f.u=s/u.width,f.v=h/u.height,f.rotate?(f.u2=(s+l)/u.width,f.v2=(h+c)/u.height):(f.u2=(s+c)/u.width,f.v2=(h+l)/u.height),f.x=s,f.y=h,f.width=Math.abs(c),f.height=Math.abs(l),4==e.readTuple(r)&&(f.splits=[parseInt(r[0],10),parseInt(r[1],10),parseInt(r[2],10),parseInt(r[3],10)],4==e.readTuple(r)&&(f.pads=[parseInt(r[0],10),parseInt(r[1],10),parseInt(r[2],10),parseInt(r[3],10)],e.readTuple(r))),f.originalWidth=parseInt(r[0],10),f.originalHeight=parseInt(r[1],10),e.readTuple(r),f.offsetX=parseInt(r[0],10),f.offsetY=parseInt(r[1],10),f.index=parseInt(e.readValue(),10),this.regions.push(f)):(u=new t.AtlasPage,u.name=o,u.format=t.Atlas.Format[e.readValue()],e.readTuple(r),u.minFilter=t.Atlas.TextureFilter[r[0]],u.magFilter=t.Atlas.TextureFilter[r[1]],a=e.readValue(),u.uWrap=t.Atlas.TextureWrap.clampToEdge,u.vWrap=t.Atlas.TextureWrap.clampToEdge,"x"==a?u.uWrap=t.Atlas.TextureWrap.repeat:"y"==a?u.vWrap=t.Atlas.TextureWrap.repeat:"xy"==a&&(u.uWrap=u.vWrap=t.Atlas.TextureWrap.repeat),i.load(u,o),this.pages.push(u)):u=null}},t.Atlas.prototype={findRegion:function(n){for(var i=this.regions,t=0,r=i.length;r>t;t++)if(i[t].name==n)return i[t];return null},dispose:function(){for(var t=this.pages,n=0,i=t.length;i>n;n++)this.textureLoader.unload(t[n].rendererObject)},updateUVs:function(n){for(var t,r=this.regions,i=0,u=r.length;u>i;i++)t=r[i],t.page==n&&(t.u=t.x/n.width,t.v=t.y/n.height,t.rotate?(t.u2=(t.x+t.height)/n.width,t.v2=(t.y+t.width)/n.height):(t.u2=(t.x+t.width)/n.width,t.v2=(t.y+t.height)/n.height))}},t.Atlas.Format={alpha:0,intensity:1,luminanceAlpha:2,rgb565:3,rgba4444:4,rgb888:5,rgba8888:6},t.Atlas.TextureFilter={nearest:0,linear:1,mipMap:2,mipMapNearestNearest:3,mipMapLinearNearest:4,mipMapNearestLinear:5,mipMapLinearLinear:6},t.Atlas.TextureWrap={mirroredRepeat:0,clampToEdge:1,repeat:2},t.AtlasPage=function(){},t.AtlasPage.prototype={name:null,format:null,minFilter:null,magFilter:null,uWrap:null,vWrap:null,rendererObject:null,width:0,height:0},t.AtlasRegion=function(){},t.AtlasRegion.prototype={page:null,name:null,x:0,y:0,width:0,height:0,u:0,v:0,u2:0,v2:0,offsetX:0,offsetY:0,originalWidth:0,originalHeight:0,index:0,rotate:!1,splits:null,pads:null},t.AtlasReader=function(n){this.lines=n.split(/\r\n|\r|\n/)},t.AtlasReader.prototype={index:0,trim:function(n){return n.replace(/^\s+|\s+$/g,"")},readLine:function(){return this.index>=this.lines.length?null:this.lines[this.index++]},readValue:function(){var n=this.readLine(),t=n.indexOf(":");if(-1==t)throw"Invalid line: "+n;return this.trim(n.substring(t+1))},readTuple:function(n){var i=this.readLine(),f=i.indexOf(":"),t,r,u;if(-1==f)throw"Invalid line: "+i;for(t=0,r=f+1;3>t;t++){if(u=i.indexOf(",",r),-1==u){if(!t)throw"Invalid line: "+i;break}n[t]=this.trim(i.substr(r,u-r)),r=u+1}return n[t]=this.trim(i.substring(r)),t+1}},t.AtlasAttachmentLoader=function(n){this.atlas=n},t.AtlasAttachmentLoader.prototype={newAttachment:function(n,i,r){var u,f;switch(i){case t.AttachmentType.region:if(u=this.atlas.findRegion(r),!u)throw"Region not found in atlas: "+r+" ("+i+")";return f=new t.RegionAttachment(r),f.rendererObject=u,f.setUVs(u.u,u.v,u.u2,u.v2,u.rotate),f.regionOffsetX=u.offsetX,f.regionOffsetY=u.offsetY,f.regionWidth=u.width,f.regionHeight=u.height,f.regionOriginalWidth=u.originalWidth,f.regionOriginalHeight=u.originalHeight,f}throw"Unknown attachment type: "+i;}},t.Bone.yDown=!0,n.AnimCache={},n.Spine=function(i){var r,s,h,o;if(n.DisplayObjectContainer.call(this),this.spineData=n.AnimCache[i],!this.spineData)throw new Error("Spine data must be preloaded using PIXI.SpineLoader or PIXI.AssetLoader: "+i);for(this.skeleton=new t.Skeleton(this.spineData),this.skeleton.updateWorldTransform(),this.stateData=new t.AnimationStateData(this.spineData),this.state=new t.AnimationState(this.stateData),this.slotContainers=[],r=0,s=this.skeleton.drawOrder.length;s>r;r++){var u=this.skeleton.drawOrder[r],f=u.attachment,e=new n.DisplayObjectContainer;(this.slotContainers.push(e),this.addChild(e),f instanceof t.RegionAttachment)&&(h=f.rendererObject.name,o=this.createSprite(u,f.rendererObject),u.currentSprite=o,u.currentSpriteName=h,e.addChild(o))}},n.Spine.prototype=Object.create(n.DisplayObjectContainer.prototype),n.Spine.prototype.constructor=n.Spine,n.Spine.prototype.updateTransform=function(){var s,e,c,f;this.lastTime=this.lastTime||Date.now(),s=.001*(Date.now()-this.lastTime),this.lastTime=Date.now(),this.state.update(s),this.state.apply(this.skeleton),this.skeleton.updateWorldTransform();for(var h=this.skeleton.drawOrder,o=0,l=h.length;l>o;o++){var i=h[o],r=i.attachment,u=this.slotContainers[o];r instanceof t.RegionAttachment?(r.rendererObject&&(!i.currentSpriteName||i.currentSpriteName!=r.name)&&(e=r.rendererObject.name,(void 0!==i.currentSprite&&(i.currentSprite.visible=!1),i.sprites=i.sprites||{},void 0!==i.sprites[e])?i.sprites[e].visible=!0:(c=this.createSprite(i,r.rendererObject),u.addChild(c)),i.currentSprite=i.sprites[e],i.currentSpriteName=e),u.visible=!0,f=i.bone,u.position.x=f.worldX+r.x*f.m00+r.y*f.m01,u.position.y=f.worldY+r.x*f.m10+r.y*f.m11,u.scale.x=f.worldScaleX,u.scale.y=f.worldScaleY,u.rotation=-(i.bone.worldRotation*Math.PI/180),u.alpha=i.a,i.currentSprite.tint=n.rgb2hex([i.r,i.g,i.b])):u.visible=!1}n.DisplayObjectContainer.prototype.updateTransform.call(this)},n.Spine.prototype.createSprite=function(t,i){var u=n.TextureCache[i.name]?i.name:i.name+".png",r=new n.Sprite(n.Texture.fromFrame(u));return r.scale=i.scale,r.rotation=i.rotation,r.anchor.x=r.anchor.y=.5,t.sprites=t.sprites||{},t.sprites[i.name]=r,r},n.BaseTextureCache={},n.texturesToUpdate=[],n.texturesToDestroy=[],n.BaseTextureCacheIdGenerator=0,n.BaseTexture=function(t,i){if(n.EventTarget.call(this),this.width=100,this.height=100,this.scaleMode=i||n.scaleModes.DEFAULT,this.hasLoaded=!1,this.source=t,this.id=n.BaseTextureCacheIdGenerator++,this.premultipliedAlpha=!0,this._glTextures=[],this._dirty=[],t){if((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height)this.hasLoaded=!0,this.width=this.source.width,this.height=this.source.height,n.texturesToUpdate.push(this);else{var r=this;this.source.onload=function(){r.hasLoaded=!0,r.width=r.source.width,r.height=r.source.height;for(var n=0;n<r._glTextures.length;n++)r._dirty[n]=!0;r.dispatchEvent({type:"loaded",content:r})},this.source.onerror=function(){r.dispatchEvent({type:"error",content:r})}}this.imageUrl=null,this._powerOf2=!1}},n.BaseTexture.prototype.constructor=n.BaseTexture,n.BaseTexture.prototype.destroy=function(){this.imageUrl?(delete n.BaseTextureCache[this.imageUrl],delete n.TextureCache[this.imageUrl],this.imageUrl=null,this.source.src=null):this.source&&this.source._pixiId&&delete n.BaseTextureCache[this.source._pixiId],this.source=null,n.texturesToDestroy.push(this)},n.BaseTexture.prototype.updateSourceImage=function(n){this.hasLoaded=!1,this.source.src=null,this.source.src=n},n.BaseTexture.fromImage=function(t,i,r){var u=n.BaseTextureCache[t],f;return(void 0===i&&-1===t.indexOf("data:")&&(i=!0),u)||(f=new Image,i&&(f.crossOrigin=""),f.src=t,u=new n.BaseTexture(f,r),u.imageUrl=t,n.BaseTextureCache[t]=u),u},n.BaseTexture.fromCanvas=function(t,i){t._pixiId||(t._pixiId="canvas_"+n.TextureCacheIdGenerator++);var r=n.BaseTextureCache[t._pixiId];return r||(r=new n.BaseTexture(t,i),n.BaseTextureCache[t._pixiId]=r),r},n.TextureCache={},n.FrameCache={},n.TextureCacheIdGenerator=0,n.Texture=function(t,i){if(n.EventTarget.call(this),this.noFrame=!1,i||(this.noFrame=!0,i=new n.Rectangle(0,0,1,1)),t instanceof n.Texture&&(t=t.baseTexture),this.baseTexture=t,this.frame=i,this.trim=null,this.valid=!1,this.scope=this,this._uvs=null,this.width=0,this.height=0,this.crop=new n.Rectangle(0,0,1,1),t.hasLoaded)this.noFrame&&(i=new n.Rectangle(0,0,t.width,t.height)),this.setFrame(i);else{var r=this;t.addEventListener("loaded",function(){r.onBaseTextureLoaded()})}},n.Texture.prototype.constructor=n.Texture,n.Texture.prototype.onBaseTextureLoaded=function(){var t=this.baseTexture;t.removeEventListener("loaded",this.onLoaded),this.noFrame&&(this.frame=new n.Rectangle(0,0,t.width,t.height)),this.setFrame(this.frame),this.scope.dispatchEvent({type:"update",content:this})},n.Texture.prototype.destroy=function(n){n&&this.baseTexture.destroy(),this.valid=!1},n.Texture.prototype.setFrame=function(t){if(this.noFrame=!1,this.frame=t,this.width=t.width,this.height=t.height,this.crop.x=t.x,this.crop.y=t.y,this.crop.width=t.width,this.crop.height=t.height,!this.trim&&(t.x+t.width>this.baseTexture.width||t.y+t.height>this.baseTexture.height))throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.valid=t&&t.width&&t.height&&this.baseTexture.source&&this.baseTexture.hasLoaded,this.trim&&(this.width=this.trim.width,this.height=this.trim.height,this.frame.width=this.trim.width,this.frame.height=this.trim.height),this.valid&&n.Texture.frameUpdates.push(this)},n.Texture.prototype._updateWebGLuvs=function(){this._uvs||(this._uvs=new n.TextureUvs);var t=this.crop,i=this.baseTexture.width,r=this.baseTexture.height;this._uvs.x0=t.x/i,this._uvs.y0=t.y/r,this._uvs.x1=(t.x+t.width)/i,this._uvs.y1=t.y/r,this._uvs.x2=(t.x+t.width)/i,this._uvs.y2=(t.y+t.height)/r,this._uvs.x3=t.x/i,this._uvs.y3=(t.y+t.height)/r},n.Texture.fromImage=function(t,i,r){var u=n.TextureCache[t];return u||(u=new n.Texture(n.BaseTexture.fromImage(t,i,r)),n.TextureCache[t]=u),u},n.Texture.fromFrame=function(t){var i=n.TextureCache[t];if(!i)throw new Error('The frameId "'+t+'" does not exist in the texture cache ');return i},n.Texture.fromCanvas=function(t,i){var r=n.BaseTexture.fromCanvas(t,i);return new n.Texture(r)},n.Texture.addTextureToCache=function(t,i){n.TextureCache[i]=t},n.Texture.removeTextureFromCache=function(t){var i=n.TextureCache[t];return delete n.TextureCache[t],delete n.BaseTextureCache[t],i},n.Texture.frameUpdates=[],n.TextureUvs=function(){this.x0=0,this.y0=0,this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.x3=0,this.y3=0},n.RenderTexture=function(t,i,r,u){if(n.EventTarget.call(this),this.width=t||100,this.height=i||100,this.frame=new n.Rectangle(0,0,this.width,this.height),this.crop=new n.Rectangle(0,0,this.width,this.height),this.baseTexture=new n.BaseTexture,this.baseTexture.width=this.width,this.baseTexture.height=this.height,this.baseTexture._glTextures=[],this.baseTexture.scaleMode=u||n.scaleModes.DEFAULT,this.baseTexture.hasLoaded=!0,this.renderer=r||n.defaultRenderer,this.renderer.type===n.WEBGL_RENDERER){var f=this.renderer.gl;this.textureBuffer=new n.FilterTexture(f,this.width,this.height,this.baseTexture.scaleMode),this.baseTexture._glTextures[f.id]=this.textureBuffer.texture,this.render=this.renderWebGL,this.projection=new n.Point(this.width/2,-this.height/2)}else this.render=this.renderCanvas,this.textureBuffer=new n.CanvasBuffer(this.width,this.height),this.baseTexture.source=this.textureBuffer.canvas;this.valid=!0,n.Texture.frameUpdates.push(this)},n.RenderTexture.prototype=Object.create(n.Texture.prototype),n.RenderTexture.prototype.constructor=n.RenderTexture,n.RenderTexture.prototype.resize=function(t,i,r){(t!==this.width||i!==this.height)&&(this.width=this.frame.width=this.crop.width=t,this.height=this.frame.height=this.crop.height=i,r&&(this.baseTexture.width=this.width,this.baseTexture.height=this.height),this.renderer.type===n.WEBGL_RENDERER&&(this.projection.x=this.width/2,this.projection.y=-this.height/2),this.textureBuffer.resize(this.width,this.height))},n.RenderTexture.prototype.clear=function(){this.renderer.type===n.WEBGL_RENDERER&&this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer),this.textureBuffer.clear()},n.RenderTexture.prototype.renderWebGL=function(t,i,r){var u=this.renderer.gl,e,o,f,s;for(u.colorMask(!0,!0,!0,!0),u.viewport(0,0,this.width,this.height),u.bindFramebuffer(u.FRAMEBUFFER,this.textureBuffer.frameBuffer),r&&this.textureBuffer.clear(),e=t.children,o=t.worldTransform,t.worldTransform=n.RenderTexture.tempMatrix,t.worldTransform.d=-1,t.worldTransform.ty=-2*this.projection.y,i&&(t.worldTransform.tx=i.x,t.worldTransform.ty-=i.y),f=0,s=e.length;s>f;f++)e[f].updateTransform();n.WebGLRenderer.updateTextures(),this.renderer.spriteBatch.dirty=!0,this.renderer.renderDisplayObject(t,this.projection,this.textureBuffer.frameBuffer),t.worldTransform=o,this.renderer.spriteBatch.dirty=!0},n.RenderTexture.prototype.renderCanvas=function(t,i,r){var e=t.children,s=t.worldTransform,u,o,f;for(t.worldTransform=n.RenderTexture.tempMatrix,i?(t.worldTransform.tx=i.x,t.worldTransform.ty=i.y):(t.worldTransform.tx=0,t.worldTransform.ty=0),u=0,o=e.length;o>u;u++)e[u].updateTransform();r&&this.textureBuffer.clear(),f=this.textureBuffer.context,this.renderer.renderDisplayObject(t,f),f.setTransform(1,0,0,1,0,0),t.worldTransform=s},n.RenderTexture.tempMatrix=new n.Matrix,n.AssetLoader=function(t,i){n.EventTarget.call(this),this.assetURLs=t,this.crossorigin=i,this.loadersByType={jpg:n.ImageLoader,jpeg:n.ImageLoader,png:n.ImageLoader,gif:n.ImageLoader,webp:n.ImageLoader,json:n.JsonLoader,atlas:n.AtlasLoader,anim:n.SpineLoader,xml:n.BitmapFontLoader,fnt:n.BitmapFontLoader}},n.AssetLoader.prototype.constructor=n.AssetLoader,n.AssetLoader.prototype._getDataType=function(n){var i="data:",f=n.slice(0,i.length).toLowerCase(),r,u,t;return f===i?(r=n.slice(i.length),u=r.indexOf(","),-1===u)?null:(t=r.slice(0,u).split(";")[0],t&&"text/plain"!==t.toLowerCase()?t.split("/").pop().toLowerCase():"txt"):null},n.AssetLoader.prototype.load=function(){function f(n){e.onAssetLoaded(n.content)}var e=this,t,i,n,r,u;for(this.loadCount=this.assetURLs.length,t=0;t<this.assetURLs.length;t++){if(i=this.assetURLs[t],n=this._getDataType(i),n||(n=i.split("?").shift().split(".").pop().toLowerCase()),r=this.loadersByType[n],!r)throw new Error(n+" is an unsupported file type");u=new r(i,this.crossorigin),u.addEventListener("loaded",f),u.load()}},n.AssetLoader.prototype.onAssetLoaded=function(n){this.loadCount--,this.dispatchEvent({type:"onProgress",content:this,loader:n}),this.onProgress&&this.onProgress(n),this.loadCount||(this.dispatchEvent({type:"onComplete",content:this}),this.onComplete&&this.onComplete())},n.JsonLoader=function(t,i){n.EventTarget.call(this),this.url=t,this.crossorigin=i,this.baseUrl=t.replace(/[^\/]*$/,""),this.loaded=!1},n.JsonLoader.prototype.constructor=n.JsonLoader,n.JsonLoader.prototype.load=function(){var n=this;window.XDomainRequest&&n.crossorigin?(this.ajaxRequest=new window.XDomainRequest,this.ajaxRequest.timeout=3e3,this.ajaxRequest.onerror=function(){n.onError()},this.ajaxRequest.ontimeout=function(){n.onError()},this.ajaxRequest.onprogress=function(){}):this.ajaxRequest=window.XMLHttpRequest?new window.XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP"),this.ajaxRequest.onload=function(){n.onJSONLoaded()},this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.send()},n.JsonLoader.prototype.onJSONLoaded=function(){var r,i,e,o,s,h;if(!this.ajaxRequest.responseText)return this.onError(),void 0;if(this.json=JSON.parse(this.ajaxRequest.responseText),this.json.frames){var c=this,l=this.baseUrl+this.json.meta.image,f=new n.ImageLoader(l,this.crossorigin),u=this.json.frames;this.texture=f.texture.baseTexture,f.addEventListener("loaded",function(){c.onLoaded()});for(r in u)i=u[r].frame,i&&(n.TextureCache[r]=new n.Texture(this.texture,{x:i.x,y:i.y,width:i.w,height:i.h}),n.TextureCache[r].crop=new n.Rectangle(i.x,i.y,i.w,i.h),u[r].trimmed)&&(e=u[r].sourceSize,o=u[r].spriteSourceSize,n.TextureCache[r].trim=new n.Rectangle(o.x,o.y,e.w,e.h));f.load()}else this.json.bones?(s=new t.SkeletonJson,h=s.readSkeletonData(this.json),n.AnimCache[this.url]=h,this.onLoaded()):this.onLoaded()},n.JsonLoader.prototype.onLoaded=function(){this.loaded=!0,this.dispatchEvent({type:"loaded",content:this})},n.JsonLoader.prototype.onError=function(){this.dispatchEvent({type:"error",content:this})},n.AtlasLoader=function(t,i){n.EventTarget.call(this),this.url=t,this.baseUrl=t.replace(/[^\/]*$/,""),this.crossorigin=i,this.loaded=!1},n.AtlasLoader.constructor=n.AtlasLoader,n.AtlasLoader.prototype.load=function(){this.ajaxRequest=new n.AjaxRequest,this.ajaxRequest.onreadystatechange=this.onAtlasLoaded.bind(this),this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/json"),this.ajaxRequest.send(null)},n.AtlasLoader.prototype.onAtlasLoaded=function(){var e,h,a,s,o;if(4===this.ajaxRequest.readyState)if(200===this.ajaxRequest.status||-1===window.location.href.indexOf("http")){this.atlas={meta:{image:[]},frames:[]};for(var u=this.ajaxRequest.responseText.split(/\r?\n/),f=-3,c=0,i=null,l=!1,t=0,r=0,v=this.onLoaded.bind(this),t=0;t<u.length;t++)(u[t]=u[t].replace(/^\s+|\s+$/g,""),""===u[t]&&(l=t+1),u[t].length>0)&&(l===t?(this.atlas.meta.image.push(u[t]),c=this.atlas.meta.image.length-1,this.atlas.frames.push({}),f=-3):f>0&&(f%7==1?(null!=i&&(this.atlas.frames[c][i.name]=i),i={name:u[t],frame:{}}):(e=u[t].split(" "),f%7==3?(i.frame.x=Number(e[1].replace(",","")),i.frame.y=Number(e[2])):f%7==4?(i.frame.w=Number(e[1].replace(",","")),i.frame.h=Number(e[2])):f%7==5&&(h={x:0,y:0,w:Number(e[1].replace(",","")),h:Number(e[2])},h.w>i.frame.w||h.h>i.frame.h?(i.trimmed=!0,i.realSize=h):i.trimmed=!1))),f++);if(null!=i&&(this.atlas.frames[c][i.name]=i),this.atlas.meta.image.length>0){for(this.images=[],r=0;r<this.atlas.meta.image.length;r++){a=this.baseUrl+this.atlas.meta.image[r],s=this.atlas.frames[r],this.images.push(new n.ImageLoader(a,this.crossorigin));for(t in s)o=s[t].frame,o&&(n.TextureCache[t]=new n.Texture(this.images[r].texture.baseTexture,{x:o.x,y:o.y,width:o.w,height:o.h}),s[t].trimmed&&(n.TextureCache[t].realSize=s[t].realSize,n.TextureCache[t].trim.x=0,n.TextureCache[t].trim.y=0))}for(this.currentImageId=0,r=0;r<this.images.length;r++)this.images[r].addEventListener("loaded",v);this.images[this.currentImageId].load()}else this.onLoaded()}else this.onError()},n.AtlasLoader.prototype.onLoaded=function(){this.images.length-1>this.currentImageId?(this.currentImageId++,this.images[this.currentImageId].load()):(this.loaded=!0,this.dispatchEvent({type:"loaded",content:this}))},n.AtlasLoader.prototype.onError=function(){this.dispatchEvent({type:"error",content:this})},n.SpriteSheetLoader=function(t,i){n.EventTarget.call(this),this.url=t,this.crossorigin=i,this.baseUrl=t.replace(/[^\/]*$/,""),this.texture=null,this.frames={}},n.SpriteSheetLoader.prototype.constructor=n.SpriteSheetLoader,n.SpriteSheetLoader.prototype.load=function(){var t=this,i=new n.JsonLoader(this.url,this.crossorigin);i.addEventListener("loaded",function(n){t.json=n.content.json,t.onLoaded()}),i.load()},n.SpriteSheetLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})},n.ImageLoader=function(t,i){n.EventTarget.call(this),this.texture=n.Texture.fromImage(t,i),this.frames=[]},n.ImageLoader.prototype.constructor=n.ImageLoader,n.ImageLoader.prototype.load=function(){if(this.texture.baseTexture.hasLoaded)this.onLoaded();else{var n=this;this.texture.baseTexture.addEventListener("loaded",function(){n.onLoaded()})}},n.ImageLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})},n.ImageLoader.prototype.loadFramedSpriteSheet=function(t,i,r){var u,e,s;this.frames=[];for(var h=Math.floor(this.texture.width/t),c=Math.floor(this.texture.height/i),o=0,f=0;c>f;f++)for(u=0;h>u;u++,o++)e=new n.Texture(this.texture,{x:u*t,y:f*i,width:t,height:i}),this.frames.push(e),r&&(n.TextureCache[r+"-"+o]=e);this.texture.baseTexture.hasLoaded?this.onLoaded():(s=this,this.texture.baseTexture.addEventListener("loaded",function(){s.onLoaded()}))},n.BitmapFontLoader=function(t,i){n.EventTarget.call(this),this.url=t,this.crossorigin=i,this.baseUrl=t.replace(/[^\/]*$/,""),this.texture=null},n.BitmapFontLoader.prototype.constructor=n.BitmapFontLoader,n.BitmapFontLoader.prototype.load=function(){this.ajaxRequest=new n.AjaxRequest;var t=this;this.ajaxRequest.onreadystatechange=function(){t.onXMLLoaded()},this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/xml"),this.ajaxRequest.send(null)},n.BitmapFontLoader.prototype.onXMLLoaded=function(){var r,l,s,h,e,i,t,o,a,f,v;if(4===this.ajaxRequest.readyState&&(200===this.ajaxRequest.status||-1===window.location.protocol.indexOf("http"))){r=this.ajaxRequest.responseXML,(!r||/MSIE 9/i.test(navigator.userAgent)||navigator.isCocoonJS)&&("function"==typeof window.DOMParser?(l=new DOMParser,r=l.parseFromString(this.ajaxRequest.responseText,"text/xml")):(s=document.createElement("div"),s.innerHTML=this.ajaxRequest.responseText,r=s)),h=this.baseUrl+r.getElementsByTagName("page")[0].getAttribute("file"),e=new n.ImageLoader(h,this.crossorigin),this.texture=e.texture.baseTexture;var u={},c=r.getElementsByTagName("info")[0],y=r.getElementsByTagName("common")[0];for(u.font=c.getAttribute("face"),u.size=parseInt(c.getAttribute("size"),10),u.lineHeight=parseInt(y.getAttribute("lineHeight"),10),u.chars={},i=r.getElementsByTagName("char"),t=0;t<i.length;t++)o=parseInt(i[t].getAttribute("id"),10),a=new n.Rectangle(parseInt(i[t].getAttribute("x"),10),parseInt(i[t].getAttribute("y"),10),parseInt(i[t].getAttribute("width"),10),parseInt(i[t].getAttribute("height"),10)),u.chars[o]={xOffset:parseInt(i[t].getAttribute("xoffset"),10),yOffset:parseInt(i[t].getAttribute("yoffset"),10),xAdvance:parseInt(i[t].getAttribute("xadvance"),10),kerning:{},texture:n.TextureCache[o]=new n.Texture(this.texture,a)};for(f=r.getElementsByTagName("kerning"),t=0;t<f.length;t++){var w=parseInt(f[t].getAttribute("first"),10),b=parseInt(f[t].getAttribute("second"),10),p=parseInt(f[t].getAttribute("amount"),10);u.chars[b].kerning[w]=p}n.BitmapText.fonts[u.font]=u,v=this,e.addEventListener("loaded",function(){v.onLoaded()}),e.load()}},n.BitmapFontLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})},n.SpineLoader=function(t,i){n.EventTarget.call(this),this.url=t,this.crossorigin=i,this.loaded=!1},n.SpineLoader.prototype.constructor=n.SpineLoader,n.SpineLoader.prototype.load=function(){var t=this,i=new n.JsonLoader(this.url,this.crossorigin);i.addEventListener("loaded",function(n){t.json=n.content.json,t.onLoaded()}),i.load()},n.SpineLoader.prototype.onLoaded=function(){this.loaded=!0,this.dispatchEvent({type:"loaded",content:this})},n.AbstractFilter=function(n,t){this.passes=[this],this.shaders=[],this.dirty=!0,this.padding=0,this.uniforms=t||{},this.fragmentSrc=n||[]},n.AlphaMaskFilter=function(t){n.AbstractFilter.call(this),this.passes=[this],t.baseTexture._powerOf2=!0,this.uniforms={mask:{type:"sampler2D",value:t},mapDimensions:{type:"2f",value:{x:1,y:5112}},dimensions:{type:"4fv",value:[0,0,0,0]}},t.baseTexture.hasLoaded?(this.uniforms.mask.value.x=t.width,this.uniforms.mask.value.y=t.height):(this.boundLoadedFunction=this.onTextureLoaded.bind(this),t.baseTexture.on("loaded",this.boundLoadedFunction)),this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D mask;","uniform sampler2D uSampler;","uniform vec2 offset;","uniform vec4 dimensions;","uniform vec2 mapDimensions;","void main(void) {","   vec2 mapCords = vTextureCoord.xy;","   mapCords += (dimensions.zw + offset)/ dimensions.xy ;","   mapCords.y *= -1.0;","   mapCords.y += 1.0;","   mapCords *= dimensions.xy / mapDimensions;","   vec4 original =  texture2D(uSampler, vTextureCoord);","   float maskAlpha =  texture2D(mask, mapCords).r;","   original *= maskAlpha;","   gl_FragColor =  original;","}"]},n.AlphaMaskFilter.prototype=Object.create(n.AbstractFilter.prototype),n.AlphaMaskFilter.prototype.constructor=n.AlphaMaskFilter,n.AlphaMaskFilter.prototype.onTextureLoaded=function(){this.uniforms.mapDimensions.value.x=this.uniforms.mask.value.width,this.uniforms.mapDimensions.value.y=this.uniforms.mask.value.height,this.uniforms.mask.value.baseTexture.off("loaded",this.boundLoadedFunction)},Object.defineProperty(n.AlphaMaskFilter.prototype,"map",{get:function(){return this.uniforms.mask.value},set:function(n){this.uniforms.mask.value=n}}),n.ColorMatrixFilter=function(){n.AbstractFilter.call(this),this.passes=[this],this.uniforms={matrix:{type:"mat4",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float invert;","uniform mat4 matrix;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * matrix;","}"]},n.ColorMatrixFilter.prototype=Object.create(n.AbstractFilter.prototype),n.ColorMatrixFilter.prototype.constructor=n.ColorMatrixFilter,Object.defineProperty(n.ColorMatrixFilter.prototype,"matrix",{get:function(){return this.uniforms.matrix.value},set:function(n){this.uniforms.matrix.value=n}}),n.GrayFilter=function(){n.AbstractFilter.call(this),this.passes=[this],this.uniforms={gray:{type:"1f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform float gray;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(0.2126*gl_FragColor.r + 0.7152*gl_FragColor.g + 0.0722*gl_FragColor.b), gray);","}"]},n.GrayFilter.prototype=Object.create(n.AbstractFilter.prototype),n.GrayFilter.prototype.constructor=n.GrayFilter,Object.defineProperty(n.GrayFilter.prototype,"gray",{get:function(){return this.uniforms.gray.value},set:function(n){this.uniforms.gray.value=n}}),n.DisplacementFilter=function(t){n.AbstractFilter.call(this),this.passes=[this],t.baseTexture._powerOf2=!0,this.uniforms={displacementMap:{type:"sampler2D",value:t},scale:{type:"2f",value:{x:30,y:30}},offset:{type:"2f",value:{x:0,y:0}},mapDimensions:{type:"2f",value:{x:1,y:5112}},dimensions:{type:"4fv",value:[0,0,0,0]}},t.baseTexture.hasLoaded?(this.uniforms.mapDimensions.value.x=t.width,this.uniforms.mapDimensions.value.y=t.height):(this.boundLoadedFunction=this.onTextureLoaded.bind(this),t.baseTexture.on("loaded",this.boundLoadedFunction)),this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D displacementMap;","uniform sampler2D uSampler;","uniform vec2 scale;","uniform vec2 offset;","uniform vec4 dimensions;","uniform vec2 mapDimensions;","void main(void) {","   vec2 mapCords = vTextureCoord.xy;","   mapCords += (dimensions.zw + offset)/ dimensions.xy ;","   mapCords.y *= -1.0;","   mapCords.y += 1.0;","   vec2 matSample = texture2D(displacementMap, mapCords).xy;","   matSample -= 0.5;","   matSample *= scale;","   matSample /= mapDimensions;","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x + matSample.x, vTextureCoord.y + matSample.y));","   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb, 1.0);","   vec2 cord = vTextureCoord;","}"]},n.DisplacementFilter.prototype=Object.create(n.AbstractFilter.prototype),n.DisplacementFilter.prototype.constructor=n.DisplacementFilter,n.DisplacementFilter.prototype.onTextureLoaded=function(){this.uniforms.mapDimensions.value.x=this.uniforms.displacementMap.value.width,this.uniforms.mapDimensions.value.y=this.uniforms.displacementMap.value.height,this.uniforms.displacementMap.value.baseTexture.off("loaded",this.boundLoadedFunction)},Object.defineProperty(n.DisplacementFilter.prototype,"map",{get:function(){return this.uniforms.displacementMap.value},set:function(n){this.uniforms.displacementMap.value=n}}),Object.defineProperty(n.DisplacementFilter.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(n){this.uniforms.scale.value=n}}),Object.defineProperty(n.DisplacementFilter.prototype,"offset",{get:function(){return this.uniforms.offset.value},set:function(n){this.uniforms.offset.value=n}}),n.PixelateFilter=function(){n.AbstractFilter.call(this),this.passes=[this],this.uniforms={invert:{type:"1f",value:0},dimensions:{type:"4fv",value:new Float32Array([1e4,100,10,10])},pixelSize:{type:"2f",value:{x:10,y:10}}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec2 testDim;","uniform vec4 dimensions;","uniform vec2 pixelSize;","uniform sampler2D uSampler;","void main(void) {","   vec2 coord = vTextureCoord;","   vec2 size = dimensions.xy/pixelSize;","   vec2 color = floor( ( vTextureCoord * size ) ) / size + pixelSize/dimensions.xy * 0.5;","   gl_FragColor = texture2D(uSampler, color);","}"]},n.PixelateFilter.prototype=Object.create(n.AbstractFilter.prototype),n.PixelateFilter.prototype.constructor=n.PixelateFilter,Object.defineProperty(n.PixelateFilter.prototype,"size",{get:function(){return this.uniforms.pixelSize.value},set:function(n){this.dirty=!0,this.uniforms.pixelSize.value=n}}),n.BlurXFilter=function(){n.AbstractFilter.call(this),this.passes=[this],this.uniforms={blur:{type:"1f",value:1/512}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","   vec4 sum = vec4(0.0);","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 4.0*blur, vTextureCoord.y)) * 0.05;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 3.0*blur, vTextureCoord.y)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 2.0*blur, vTextureCoord.y)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - blur, vTextureCoord.y)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + blur, vTextureCoord.y)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 2.0*blur, vTextureCoord.y)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 3.0*blur, vTextureCoord.y)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 4.0*blur, vTextureCoord.y)) * 0.05;","   gl_FragColor = sum;","}"]},n.BlurXFilter.prototype=Object.create(n.AbstractFilter.prototype),n.BlurXFilter.prototype.constructor=n.BlurXFilter,Object.defineProperty(n.BlurXFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(n){this.dirty=!0,this.uniforms.blur.value=1/7e3*n}}),n.BlurYFilter=function(){n.AbstractFilter.call(this),this.passes=[this],this.uniforms={blur:{type:"1f",value:1/512}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","   vec4 sum = vec4(0.0);","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 4.0*blur)) * 0.05;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 3.0*blur)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 2.0*blur)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - blur)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + blur)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 2.0*blur)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 3.0*blur)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 4.0*blur)) * 0.05;","   gl_FragColor = sum;","}"]},n.BlurYFilter.prototype=Object.create(n.AbstractFilter.prototype),n.BlurYFilter.prototype.constructor=n.BlurYFilter,Object.defineProperty(n.BlurYFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(n){this.uniforms.blur.value=1/7e3*n}}),n.BlurFilter=function(){this.blurXFilter=new n.BlurXFilter,this.blurYFilter=new n.BlurYFilter,this.passes=[this.blurXFilter,this.blurYFilter]},Object.defineProperty(n.BlurFilter.prototype,"blur",{get:function(){return this.blurXFilter.blur},set:function(n){this.blurXFilter.blur=this.blurYFilter.blur=n}}),Object.defineProperty(n.BlurFilter.prototype,"blurX",{get:function(){return this.blurXFilter.blur},set:function(n){this.blurXFilter.blur=n}}),Object.defineProperty(n.BlurFilter.prototype,"blurY",{get:function(){return this.blurYFilter.blur},set:function(n){this.blurYFilter.blur=n}}),n.InvertFilter=function(){n.AbstractFilter.call(this),this.passes=[this],this.uniforms={invert:{type:"1f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float invert;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix( (vec3(1)-gl_FragColor.rgb) * gl_FragColor.a, gl_FragColor.rgb, 1.0 - invert);","}"]},n.InvertFilter.prototype=Object.create(n.AbstractFilter.prototype),n.InvertFilter.prototype.constructor=n.InvertFilter,Object.defineProperty(n.InvertFilter.prototype,"invert",{get:function(){return this.uniforms.invert.value},set:function(n){this.uniforms.invert.value=n}}),n.SepiaFilter=function(){n.AbstractFilter.call(this),this.passes=[this],this.uniforms={sepia:{type:"1f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float sepia;","uniform sampler2D uSampler;","const mat3 sepiaMatrix = mat3(0.3588, 0.7044, 0.1368, 0.2990, 0.5870, 0.1140, 0.2392, 0.4696, 0.0912);","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb * sepiaMatrix, sepia);","}"]},n.SepiaFilter.prototype=Object.create(n.AbstractFilter.prototype),n.SepiaFilter.prototype.constructor=n.SepiaFilter,Object.defineProperty(n.SepiaFilter.prototype,"sepia",{get:function(){return this.uniforms.sepia.value},set:function(n){this.uniforms.sepia.value=n}}),n.TwistFilter=function(){n.AbstractFilter.call(this),this.passes=[this],this.uniforms={radius:{type:"1f",value:.5},angle:{type:"1f",value:5},offset:{type:"2f",value:{x:.5,y:.5}}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec4 dimensions;","uniform sampler2D uSampler;","uniform float radius;","uniform float angle;","uniform vec2 offset;","void main(void) {","   vec2 coord = vTextureCoord - offset;","   float distance = length(coord);","   if (distance < radius) {","       float ratio = (radius - distance) / radius;","       float angleMod = ratio * ratio * angle;","       float s = sin(angleMod);","       float c = cos(angleMod);","       coord = vec2(coord.x * c - coord.y * s, coord.x * s + coord.y * c);","   }","   gl_FragColor = texture2D(uSampler, coord+offset);","}"]},n.TwistFilter.prototype=Object.create(n.AbstractFilter.prototype),n.TwistFilter.prototype.constructor=n.TwistFilter,Object.defineProperty(n.TwistFilter.prototype,"offset",{get:function(){return this.uniforms.offset.value},set:function(n){this.dirty=!0,this.uniforms.offset.value=n}}),Object.defineProperty(n.TwistFilter.prototype,"radius",{get:function(){return this.uniforms.radius.value},set:function(n){this.dirty=!0,this.uniforms.radius.value=n}}),Object.defineProperty(n.TwistFilter.prototype,"angle",{get:function(){return this.uniforms.angle.value},set:function(n){this.dirty=!0,this.uniforms.angle.value=n}}),n.ColorStepFilter=function(){n.AbstractFilter.call(this),this.passes=[this],this.uniforms={step:{type:"1f",value:5}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform float step;","void main(void) {","   vec4 color = texture2D(uSampler, vTextureCoord);","   color = floor(color * step) / step;","   gl_FragColor = color;","}"]},n.ColorStepFilter.prototype=Object.create(n.AbstractFilter.prototype),n.ColorStepFilter.prototype.constructor=n.ColorStepFilter,Object.defineProperty(n.ColorStepFilter.prototype,"step",{get:function(){return this.uniforms.step.value},set:function(n){this.uniforms.step.value=n}}),n.DotScreenFilter=function(){n.AbstractFilter.call(this),this.passes=[this],this.uniforms={scale:{type:"1f",value:1},angle:{type:"1f",value:5},dimensions:{type:"4fv",value:[0,0,0,0]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec4 dimensions;","uniform sampler2D uSampler;","uniform float angle;","uniform float scale;","float pattern() {","   float s = sin(angle), c = cos(angle);","   vec2 tex = vTextureCoord * dimensions.xy;","   vec2 point = vec2(","       c * tex.x - s * tex.y,","       s * tex.x + c * tex.y","   ) * scale;","   return (sin(point.x) * sin(point.y)) * 4.0;","}","void main() {","   vec4 color = texture2D(uSampler, vTextureCoord);","   float average = (color.r + color.g + color.b) / 3.0;","   gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);","}"]},n.DotScreenFilter.prototype=Object.create(n.AbstractFilter.prototype),n.DotScreenFilter.prototype.constructor=n.DotScreenFilter,Object.defineProperty(n.DotScreenFilter.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(n){this.dirty=!0,this.uniforms.scale.value=n}}),Object.defineProperty(n.DotScreenFilter.prototype,"angle",{get:function(){return this.uniforms.angle.value},set:function(n){this.dirty=!0,this.uniforms.angle.value=n}}),n.CrossHatchFilter=function(){n.AbstractFilter.call(this),this.passes=[this],this.uniforms={blur:{type:"1f",value:1/512}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","    float lum = length(texture2D(uSampler, vTextureCoord.xy).rgb);","    gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);","    if (lum < 1.00) {","        if (mod(gl_FragCoord.x + gl_FragCoord.y, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.75) {","        if (mod(gl_FragCoord.x - gl_FragCoord.y, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.50) {","        if (mod(gl_FragCoord.x + gl_FragCoord.y - 5.0, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.3) {","        if (mod(gl_FragCoord.x - gl_FragCoord.y - 5.0, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","}"]},n.CrossHatchFilter.prototype=Object.create(n.AbstractFilter.prototype),n.CrossHatchFilter.prototype.constructor=n.BlurYFilter,Object.defineProperty(n.CrossHatchFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(n){this.uniforms.blur.value=1/7e3*n}}),n.RGBSplitFilter=function(){n.AbstractFilter.call(this),this.passes=[this],this.uniforms={red:{type:"2f",value:{x:20,y:20}},green:{type:"2f",value:{x:-20,y:20}},blue:{type:"2f",value:{x:20,y:-20}},dimensions:{type:"4fv",value:[0,0,0,0]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec2 red;","uniform vec2 green;","uniform vec2 blue;","uniform vec4 dimensions;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor.r = texture2D(uSampler, vTextureCoord + red/dimensions.xy).r;","   gl_FragColor.g = texture2D(uSampler, vTextureCoord + green/dimensions.xy).g;","   gl_FragColor.b = texture2D(uSampler, vTextureCoord + blue/dimensions.xy).b;","   gl_FragColor.a = texture2D(uSampler, vTextureCoord).a;","}"]},n.RGBSplitFilter.prototype=Object.create(n.AbstractFilter.prototype),n.RGBSplitFilter.prototype.constructor=n.RGBSplitFilter,Object.defineProperty(n.RGBSplitFilter.prototype,"angle",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(n){this.uniforms.blur.value=1/7e3*n}}),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=n),exports.PIXI=n):"undefined"!=typeof define&&define.amd?define(n):f.PIXI=n}).call(this)